import{c as S,g as N,s as Lt,I as J,d as ne,i as P,h as w,o as b,j as c,n as A,k as L,p as G,v as _e,t as E,G as _,M as ae,r as V,A as Re,B as Ne,F as O,l as H,z,D as dt,N as Mt,C as xe,O as He,P as Et,Q as Ie,J as Ot,e as D,b as se,w as Pe,u as q,a as We,S as _t,q as At}from"./index-nRnvFK1u.js";import{h as $e,g as Rt,r as ut,i as ct,c as ft,j as Te,k as Nt,v as Tt,s as Dt,l as ht,m as vt,e as Ft,_ as oe,n as zt,o as Ue,t as Ve,p as Ht,C as It,R as Pt,u as Wt,U as Be,X as Ut}from"./headers-DYs70Zq5.js";import{u as Vt}from"./settings-CYlGyulm.js";import{D as Bt}from"./download-9HIJm8_8.js";import{c as De}from"./createLucideIcon-vycDanqW.js";import{a as qt,F as jt}from"./folder-open-Cm0hPA5M.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=De("Maximize2Icon",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=De("Minimize2Icon",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=De("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);var Le={exports:{}},Kt=Le.exports,qe;function Xt(){return qe||(qe=1,(function(e,t){(function(l,a){a()})(Kt,function(){function l(i,d){return typeof d>"u"?d={autoBom:!1}:typeof d!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function a(i,d,h){var p=new XMLHttpRequest;p.open("GET",i),p.responseType="blob",p.onload=function(){u(p.response,d,h)},p.onerror=function(){console.error("could not download file")},p.send()}function r(i){var d=new XMLHttpRequest;d.open("HEAD",i,!1);try{d.send()}catch{}return 200<=d.status&&299>=d.status}function o(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(d)}}var n=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof $e=="object"&&$e.global===$e?$e:void 0,s=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=n.saveAs||(typeof window!="object"||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(i,d,h){var p=n.URL||n.webkitURL,v=document.createElement("a");d=d||i.name||"download",v.download=d,v.rel="noopener",typeof i=="string"?(v.href=i,v.origin===location.origin?o(v):r(v.href)?a(i,d,h):o(v,v.target="_blank")):(v.href=p.createObjectURL(i),setTimeout(function(){p.revokeObjectURL(v.href)},4e4),setTimeout(function(){o(v)},0))}:"msSaveOrOpenBlob"in navigator?function(i,d,h){if(d=d||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(l(i,h),d);else if(r(i))a(i,d,h);else{var p=document.createElement("a");p.href=i,p.target="_blank",setTimeout(function(){o(p)})}}:function(i,d,h,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof i=="string")return a(i,d,h);var v=i.type==="application/octet-stream",f=/constructor/i.test(n.HTMLElement)||n.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||v&&f||s)&&typeof FileReader<"u"){var C=new FileReader;C.onloadend=function(){var m=C.result;m=g?m:m.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=m:location=m,p=null},C.readAsDataURL(i)}else{var x=n.URL||n.webkitURL,y=x.createObjectURL(i);p?p.location=y:location.href=y,p=null,setTimeout(function(){x.revokeObjectURL(y)},4e4)}});n.saveAs=u.saveAs=u,e.exports=u})})(Le)),Le.exports}var Qt=Xt();const Ae=Rt(Qt),je=new Map;function Zt(e,t,l){const a=je.get(e)?.deref();if(a)return a;const r=N(null);return en(e,t,l).then(o=>{o&&(r.value=o)}).catch(()=>{}),je.set(e,new WeakRef(r)),r}async function en(e,t,l){const a=await t.loadFileContent(e),r=ut(e,a.buffer),o=await ft(r),n=await l.findByName(yt(e)),s=Ft(n,o,r);if(s)return{headers:s.headers,datFile:r}}function tn(e,t,l,a,r){const o=ut(e,t.buffer),n={headers:N(o.rowLength?[{name:null,offset:0,length:o.rowLength,type:ct()}]:[]),datFile:o,name:yt(e),path:e,columnStats:N([]),columnSelection:N(new Array(o.rowLength).fill(!1)),editHeader:N(null),selectedRow:N(null),rowSorting:N(null),scrollPos:Lt({x:0,y:0}),referencedTables:r.run(()=>S(()=>{const s=new Map;s.set(n.name,N({headers:n.headers.value,datFile:n.datFile}));for(const u of n.headers.value){if(!u.type.key?.table||s.has(u.type.key.table))continue;const i=n.path.replace(`/${n.name}.`,`/${u.type.key.table}.`);s.set(u.type.key.table,Zt(i,l,a))}return s}))};return ft(n.datFile).then(async s=>{n.columnStats.value=s,await pt(n,a)}),n}async function pt(e,t){e.editHeader.value=null,e.headers.value=e.datFile.rowLength?[{name:null,offset:0,length:e.datFile.rowLength,type:ct()}]:[];const l=await t.findByName(e.name);try{nn(l,e)}catch(a){window.alert(`WARN: ${a.message}`)}finally{J(e.headers)}}function nn(e,t){let l=0;for(const a of e){const r=a.length||Nt(a,t.datFile);if(a.name==null){l+=r;continue}const o={...a,length:r,offset:l};if(!(a.length?t.datFile.rowLength-o.offset>=o.length:Tt(o,t.columnStats.value)))throw new Error("The schema is invalid.");Dt(o,t.columnSelection.value);const s=ht(t.columnSelection.value,t.headers.value);Object.assign(s,o),vt(t.columnSelection.value),l+=r}}function we(e,t){const l=e.filter(({type:a})=>a.boolean||a.decimal||a.integer||a.key||a.string).map((a,r)=>({name:a.name||`Unknown${r+1}`,data:Te(a,t)}));return l.unshift({name:"_rid",data:Array(t.rowCount).fill(void 0).map((a,r)=>r)}),Array(t.rowCount).fill(void 0).map((a,r)=>Object.fromEntries(l.map(o=>[o.name,o.data[r]])))}function yt(e){return e.match(/[^/]+(?=\..+$)/)[0]}async function Se(e,t){await t.saveHeaders(e.name,e.headers.value)}async function rn(e,t){await t.removeHeaders(e.name)}const an=ne({setup(){const e=P("bundle-index"),t=P("dat-schemas"),l=N(localStorage.getItem("POE_PATCH_VER")||""),a=N();l.value&&!e.isLoaded&&o(),t.isLoaded||t.fetchSchema(),n();async function r(s){const u=s.target.files[0],i=new Uint8Array(await u.arrayBuffer()),d=u.name;mt({id:`file@${d}`,title:d,type:St,args:{fileContent:i,fullPath:d}})}async function o(){try{await e.loader.setPatch(l.value),await e.loadIndex(),localStorage.setItem("POE_PATCH_VER",l.value)}catch(s){throw window.alert(s.message),s}}async function n(){const u=await(await fetch("https://poe-versions.obsoleet.org")).json();a.value=u}return{index:e,poePatch:l,latestPoEPatch:a,isCdnImportRunning:S(()=>e.loader.progress.value!=null),isFetchingSchema:S(()=>t.isLoading),handleFile:r,cdnImport:o}}}),on="_input_16vaf_2",ln="_label_16vaf_20",sn="_importVariant_16vaf_26",dn={input:on,label:ln,importVariant:sn},un={class:"p-4 overflow-auto border-l flex-1 text-base"},cn={class:"flex gap-x-4 items-baseline mt-4"},fn={class:"inline-flex items-baseline pb-2"},hn={style:{width:"200px"},class:"my-1"},vn={style:{width:"100px"},class:"m-1"},pn={style:{width:"220px"},class:"my-1"},yn=["disabled","loading"],mn={key:0},gn={class:"px-1 border border-gray-300 rounded"},bn={class:"px-1 border border-gray-300 rounded"},wn={key:0,class:"text-red-600"},kn={class:"flex gap-x-4 items-baseline mt-4 border-b pb-3"},xn={class:"flex items-baseline"},Sn={class:"mt-3 flex gap-x-2 items-center"},Cn={key:0,class:"codicon codicon-loading animate-spin"},$n={key:1,class:"codicon codicon-check"},Ln={key:0},Mn={key:1};function En(e,t,l,a,r,o){return b(),w("div",un,[c("div",cn,[c("div",{class:A(e.$style.importVariant)},"1",2),c("div",null,[t[7]||(t[7]=c("div",{class:"max-w-xl mb-4 font-semibold"},"Useful when a new league is released. While the update is still downloading, you can review files and fix schema directly from the update servers.",-1)),c("div",fn,[c("div",hn,[c("input",{value:"patch(-poe2).poecdn.com/",readonly:"",class:A(e.$style.input)},null,2),c("label",{class:A(e.$style.label)},"Patch CDN",2)]),c("div",vn,[G(c("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>e.poePatch=n),placeholder:"x.x.x.x.x",class:A(e.$style.input)},null,2),[[_e,e.poePatch,void 0,{trim:!0}]]),c("label",{class:A(e.$style.label)},"Patch #",2)]),c("div",pn,[c("input",{value:"/Bundles2/_.index.bin",readonly:"",class:A(e.$style.input)},null,2),c("label",{class:A(e.$style.label)},"Index",2)]),c("button",{class:"ml-1 py-1 px-3 bg-blue-600 text-white hover:bg-blue-800",onClick:t[1]||(t[1]=(...n)=>e.cdnImport&&e.cdnImport(...n)),disabled:e.isCdnImportRunning,loading:e.isCdnImportRunning},E(e.isCdnImportRunning?"Wait...":"Import"),9,yn)]),e.latestPoEPatch?(b(),w("div",mn,[c("p",null,[t[3]||(t[3]=_(" Latest PoE patch is ",-1)),c("code",gn,E(e.latestPoEPatch.poe),1),t[4]||(t[4]=_(", and version ",-1)),c("code",bn,E(e.latestPoEPatch.poe2),1),t[5]||(t[5]=_(" for PoE2. ",-1))]),e.index.isLoaded&&e.index.loader.patchVersion!==e.latestPoEPatch.poe&&e.index.loader.patchVersion!==e.latestPoEPatch.poe2?(b(),w("p",wn,[...t[6]||(t[6]=[_(" You can continue to work with cached files.",-1),c("br",null,null,-1),_("But don't delay updating the patch version, otherwise you may experience download errors. ",-1)])])):L("",!0)])):L("",!0)])]),c("div",kn,[c("div",{class:A(e.$style.importVariant)},"2",2),c("div",xn,[t[8]||(t[8]=c("span",{class:"pr-2"},"or just",-1)),t[9]||(t[9]=c("label",{class:"bg-gray-100 py-1 px-2 cursor-pointer hover:bg-gray-300",style:{width:"200px"},for:"import-local-file"},"Pick a local dat file",-1)),c("input",{class:"hidden",id:"import-local-file",type:"file",accept:".datc64",onInput:t[2]||(t[2]=(...n)=>e.handleFile&&e.handleFile(...n))},null,32)])]),c("div",Sn,[e.isFetchingSchema?(b(),w("i",Cn)):(b(),w("i",$n)),c("div",null,[e.isFetchingSchema?(b(),w("span",Ln," Downloading schema from ")):(b(),w("span",Mn," Downloaded schema from ")),t[10]||(t[10]=c("a",{href:"https://github.com/poe-tool-dev/dat-schema",class:"underline",target:"_blank"},"github.com/poe-tool-dev/dat-schema",-1))])])])}const On={$style:dn},_n=oe(an,[["render",En],["__cssModules",On]]),An=N("poe-dat-viewer@import");function Rn(e){An.value=e}const Oe=N([{id:"poe-dat-viewer@import",title:"Import",type:_n,args:void 0,kaScope:ae(!0),kaState:void 0}]);function mt(e){Oe.value.find(l=>l.id===e.id)||Oe.value.push({id:e.id,title:e.title,type:e.type,args:e.args,kaScope:ae(!0),kaState:void 0}),Rn(e.id),J(Oe)}const Nn=ne({props:{args:{type:Object,required:!0}},setup(e){return{text:S(()=>{const{name:t,headers:l}=e.args;let a="";for(const r of l){if(r.name==null)break;let o="";if(r.type.boolean?o="bool":r.type.string?o="string":r.type.integer?.size===1?o=r.type.integer.unsigned?"u8":"i8":r.type.integer?.size===2?o=r.type.integer.unsigned?"u16":"i16":r.type.integer?.size===4?o=r.type.integer.unsigned?"u32":"i32":r.type.integer?.size===8?o=r.type.integer.unsigned?"u64":"i64":r.type.decimal?.size===4?o="f32":r.type.decimal?.size===8?o="f64":r.type.key&&(o=r.type.key.foreign?r.type.key.table??"rid":t),r.type.array)a+=`  ${r.name||"_"}: [${o||"_"}]
`;else if(o)a+=`  ${r.name||"_"}: ${o}
`;else break}return`type ${t} {
${a}}
`})}}}),Tn={class:"p-4 overflow-auto border-l flex-1 text-base"};function Dn(e,t,l,a,r,o){return b(),w("div",Tn,[c("pre",null,E(e.text),1)])}const Fn=oe(Nn,[["render",Dn]]),zn=ne({name:"ViewerActions",setup(){const e=P("viewer"),t=P("dat-schemas"),l=V(!1),a=V(null),r=S(()=>zt(e.columnSelection.value).map(v=>v.map(f=>String(f)).join(" ")));function o(v){a.value&&!a.value.contains(v.target)&&(l.value=!1)}Re(()=>{document.addEventListener("click",o)}),Ne(()=>{document.removeEventListener("click",o)});function n(){const{editHeader:v,columnSelection:f,headers:g}=e;v.value=ht(f.value,g.value),vt(f.value),J(g),J(f),Se(e,t)}function s(){const v=we(e.headers.value,e.datFile);Ae.saveAs(new File([JSON.stringify(v,null,2)],`${e.name}.json`,{type:"application/json;charset=utf-8"})),l.value=!1}function u(){const v=we(e.headers.value,e.datFile);if(v.length===0)return;const f=Object.keys(v[0]),g=[f.join(","),...v.map(C=>f.map(x=>{const y=C[x];return y==null?"":typeof y=="string"?`"${y.replace(/"/g,'""')}"`:Array.isArray(y)?`"${JSON.stringify(y).replace(/"/g,'""')}"`:String(y)}).join(","))];Ae.saveAs(new File([g.join(`
`)],`${e.name}.csv`,{type:"text/csv;charset=utf-8"})),l.value=!1}async function i(){const v=we(e.headers.value,e.datFile);await navigator.clipboard.writeText(JSON.stringify(v,null,2)),l.value=!1}function d(){if(e.selectedRow.value===null)return;const f=we(e.headers.value,e.datFile)[e.selectedRow.value];f&&navigator.clipboard.writeText(JSON.stringify(f,null,2))}function h(){mt({id:"poe-dat-viewer@show-schema",title:"Schema",type:Fn,args:{name:e.name,headers:JSON.parse(JSON.stringify(e.headers.value))}})}async function p(){await rn(e,t),await pt(e,t)}return{rowSorting:e.rowSorting,selectedRow:e.selectedRow,selections:r,showExportMenu:l,exportDropdownRef:a,defineColumn:n,exportDataJson:s,exportDataCsv:u,copyAllToClipboard:i,copySelectedRow:d,showSchema:h,restoreSchema:p}}}),Hn="_bar_1e38q_2",In={bar:Hn},Pn={class:"flex items-center gap-2"},Wn={key:0,class:"self-center px-1.5 italic text-dark-500"},Un=["textContent"],Vn={key:3,class:"ml-2 flex items-center gap-2 border-l border-dark-600 pl-2"},Bn={class:"text-dark-400"},qn={class:"flex gap-x-1"},jn={ref:"exportDropdownRef",class:"relative"},Gn={key:0,class:"absolute right-0 top-full z-10 mt-1 w-48 rounded-lg border border-dark-600 bg-dark-800 py-1 shadow-lg"};function Jn(e,t,l,a,r,o){return b(),w("div",{class:A(e.$style.bar)},[c("div",Pn,[e.selections.length===0?(b(),w("div",Wn,"No bytes selected")):e.selections.length===1?(b(),w("button",{key:1,class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[0]||(t[0]=(...n)=>e.defineColumn&&e.defineColumn(...n))},[...t[9]||(t[9]=[c("i",{class:"codicon codicon-add"},null,-1),_(" Define column ",-1)])])):e.selections.length>1?(b(),w(O,{key:2},[t[10]||(t[10]=c("div",{class:"mr-1 self-center px-1.5 text-dark-400"},"Selections",-1)),(b(!0),w(O,null,H(e.selections,n=>(b(),w("div",{class:"mr-1 flex items-center rounded bg-dark-700 px-1.5 font-mono text-dark-200",textContent:E(n)},null,8,Un))),256))],64)):L("",!0),e.selectedRow!==null?(b(),w("div",Vn,[c("span",Bn,"Row "+E(e.selectedRow),1),c("button",{class:"flex items-center gap-x-1 rounded bg-dark-700 px-2 py-0.5 text-xs hover:bg-dark-600 hover:text-dark-100",title:"Copy row data (Ctrl+C)",onClick:t[1]||(t[1]=(...n)=>e.copySelectedRow&&e.copySelectedRow(...n))},[...t[11]||(t[11]=[c("i",{class:"codicon codicon-copy"},null,-1),_(" Copy Row ",-1)])])])):L("",!0)]),c("div",qn,[e.rowSorting?(b(),w("button",{key:0,class:"rounded border border-dark-500 bg-dark-600 px-1.5 hover:bg-dark-500",onClick:t[2]||(t[2]=n=>e.rowSorting=null)}," Clear sorting ")):L("",!0),c("button",{class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[3]||(t[3]=(...n)=>e.restoreSchema&&e.restoreSchema(...n))},[...t[12]||(t[12]=[c("i",{class:"codicon codicon-discard"},null,-1),_(" Restore schema ",-1)])]),c("button",{class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[4]||(t[4]=(...n)=>e.showSchema&&e.showSchema(...n))},[...t[13]||(t[13]=[c("i",{class:"codicon codicon-json"},null,-1),_(" Show schema ",-1)])]),c("div",jn,[c("button",{class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[5]||(t[5]=n=>e.showExportMenu=!e.showExportMenu)},[...t[14]||(t[14]=[c("i",{class:"codicon codicon-database"},null,-1),_(" Export ",-1),c("i",{class:"codicon codicon-chevron-down text-xs"},null,-1)])]),e.showExportMenu?(b(),w("div",Gn,[c("button",{class:"flex w-full items-center gap-2 px-3 py-2 text-left text-sm text-dark-200 hover:bg-dark-700",onClick:t[6]||(t[6]=(...n)=>e.exportDataJson&&e.exportDataJson(...n))},[...t[15]||(t[15]=[c("i",{class:"codicon codicon-json"},null,-1),_(" Export as JSON ",-1)])]),c("button",{class:"flex w-full items-center gap-2 px-3 py-2 text-left text-sm text-dark-200 hover:bg-dark-700",onClick:t[7]||(t[7]=(...n)=>e.exportDataCsv&&e.exportDataCsv(...n))},[...t[16]||(t[16]=[c("i",{class:"codicon codicon-table"},null,-1),_(" Export as CSV ",-1)])]),t[18]||(t[18]=c("div",{class:"my-1 border-t border-dark-700"},null,-1)),c("button",{class:"flex w-full items-center gap-2 px-3 py-2 text-left text-sm text-dark-200 hover:bg-dark-700",onClick:t[8]||(t[8]=(...n)=>e.copyAllToClipboard&&e.copyAllToClipboard(...n))},[...t[17]||(t[17]=[c("i",{class:"codicon codicon-copy"},null,-1),_(" Copy all to clipboard ",-1)])])])):L("",!0)],512)])],2)}const Yn={$style:In},Kn=oe(zn,[["render",Jn],["__cssModules",Yn]]);function Xn(e,t,l){const a=Te(e,l),r=Array.from({length:l.rowCount},(o,n)=>n);return e.type.array?r.sort((o,n)=>{const s=a[o];return(a[n].length-s.length)*t}):e.type.boolean?r.sort((o,n)=>{const s=Number(a[o]),u=Number(a[n]);return(s-u)*t}):e.type.string?r.sort((o,n)=>{const s=a[o],u=a[n];return s.localeCompare(u)*t}):e.type.integer||e.type.decimal?r.sort((o,n)=>{const s=a[o];return(a[n]-s)*t}):e.type.key&&(e.type.key.foreign?r.sort((o,n)=>{const s=a[o];return((a[n]||0)-(s||0))*t}):r.sort((o,n)=>{const s=Number(a[o]);return(Number(a[n])-s)*t})),r}const Qn={number:"#4ade80",boolean:"#60a5fa",string:"#fbbf24",null:"#f87171",key:"#a78bfa",muted:"#64748b",hex:"#94a3b8"},Zn={number:"#16a34a",boolean:"#2563eb",string:"#d97706",null:"#dc2626",key:"#7c3aed",muted:"#94a3b8",hex:"#64748b"};function Fe(){return gt()?Qn:Zn}function er(e,t,l){t.text=String(e),t.color=l.number}function tr(e,t,l){t.text=e.toLocaleString(void 0,{maximumFractionDigits:6,minimumFractionDigits:1}),t.color=l.number}function nr(e,t,l){t.text=`[${e.join(", ")}]`,t.color=l.number}function rr(e,t,l){t.text=`[${e.map(a=>a.toLocaleString(void 0,{maximumFractionDigits:6,minimumFractionDigits:1})).join(", ")}]`,t.color=l.number}function ar(e,t,l){t.text=String(e),t.color=l.boolean}function or(e,t,l){t.text=`[${e.join(", ")}]`,t.color=l.boolean}function lr(e,t,l){e===""?(t.text="empty",t.color=l.muted):(t.text=String(e),t.color=l.string)}function ir(e,t,l){t.text=`[${e.map(a=>JSON.stringify(a)).join(", ")}]`,t.color=l.string}function Ge(e,t,l){e===null?(t.text="<null, self>",t.color=l.null):(t.text=`<${e}, self>`,t.color=l.key)}function sr(e,t,l){t.text=`[${e.map(a=>`<${a}, self>`).join(", ")}]`,t.color=l.key}function Je(e,t,l){e===null?(t.text="<null>",t.color=l.null):(t.text=`<${e}>`,t.color=l.key)}function dr(e,t,l){t.text=`[${e.map(a=>`<${a}>`).join(", ")}]`,t.color=l.key}function Ye(e,t,l,a,r){const o=Fe(),n=Ue(t,l);if(r?.header.type.array)throw new Error("Can't show array of arrays.");const s=r&&Ue(r.header,r.datFile),u={text:"",color:""},i=(()=>{const p=r!=null?r.header.type:t.type;if(t.type.array){if(p.boolean)return or;if(p.string)return ir;if(p.integer)return nr;if(p.decimal)return rr;if(p.key?.foreign)return dr;if(p.key)return sr}else{if(p.boolean)return ar;if(p.string)return lr;if(p.integer)return er;if(p.decimal)return tr;if(p.key?.foreign)return Je;if(p.key)return Ge}throw new Error("never")})();let d=0,h="";for(const p of a){let v=n(p);r?t.type.array?(v=v.map(f=>s(f)),i(v,u,o)):v===null?(t.type.key.foreign?Je:Ge)(v,u,o):(v=s(v),i(v,u,o)):i(v,u,o),h!==u.color&&(e.fillStyle=u.color,h=u.color),e.fillText(u.text,0,d),d+=F}}function ur(e,t,l,a,r,o){const n=Fe();e.fillStyle=n.hex;let s=0;for(const u of a){const i=l.dataFixed.subarray(u*l.rowLength+t.offset+r,u*l.rowLength+t.offset+o),d=Array.from(i,h=>h.toString(16).padStart(2,"0")).join(" ");e.fillText(d,r*(W*3),s),s+=F}}function cr(e,t,l,a,r){const o=Fe();e.fillStyle=o.hex;const n=r.refArray,s=Math.max(n.keyForeign?l.fieldSize.KEY_FOREIGN:0,n.keySelf?l.fieldSize.KEY:0,n.string?l.fieldSize.STRING:0,n.numeric32?l.fieldSize.LONG:0,l.fieldSize.BYTE),u=Math.ceil(t.textLength/3);let i=0;for(const d of a){const h=l.readerFixed.getUint32(d*l.rowLength+t.offset,!0);if(h===0)e.fillText("[]",0,i);else{const p=l.readerFixed.getUint32(d*l.rowLength+t.offset+l.memsize,!0),v=l.dataVariable.subarray(p,p+Math.min(s*h,u)),f=Array.from(v,g=>g.toString(16).padStart(2,"0")).join(" ");e.fillText(`${h} { ${f} }`,0,i)}i+=F}}const fr={background:"#0f172a",backgroundAlt:"#1e293b",text:"#e2e8f0",textMuted:"#94a3b8",border:"#334155",selection:"rgba(14, 165, 233, 0.2)",selectionText:"#38bdf8",shadow:"rgba(0, 0, 0, 0.3)"},hr={background:"#ffffff",backgroundAlt:"#f8fafc",text:"#1e293b",textMuted:"#64748b",border:"#e2e8f0",selection:"rgba(14, 165, 233, 0.15)",selectionText:"#0284c7",shadow:"rgba(0, 0, 0, 0.1)"};function gt(){return document.documentElement.classList.contains("dark")}function vr(){return gt()?fr:hr}const ee='"JetBrains Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',X=14,W=wr(X,ee),pr=kr(X,ee),F=19,yr=3,te=1,mr=7,ke=Math.round(W*3),re=ke*2+mr*3;function gr(e){const t=String(e-1).length;return Math.max(t,yr)}function bt(e){return Math.ceil(gr(e)*W)}function br(e){return bt(e)+16}function wr(e,t){const a=document.createElement("canvas").getContext("2d");return a.font=`${e}px ${t}`,a.measureText("0").width}function kr(e,t){const a=document.createElement("canvas").getContext("2d");a.font=`${e}px ${t}`,a.textBaseline="middle";const r=a.measureText("0");return e/2+(r.alphabeticBaseline!==void 0?-r.alphabeticBaseline:r.actualBoundingBoxDescent)}function xr(e){return 1+(e-X)/2+pr}function Sr(e){const{ctx:t}=e,l=vr();if(t.fillStyle=l.background,t.fillRect(0,0,t.canvas.width,t.canvas.height),e.viewer.selectedRow.value!==null){const r=e.rows.indexOf(e.viewer.selectedRow.value);r!==-1&&(t.fillStyle=l.selection,t.fillRect(0,e.top+r*F,t.canvas.width,F))}t.save(),t.translate(-e.left,0),Cr(t,e.columns,l),t.restore(),t.font=`${X}px ${ee}`,t.fillStyle=l.text;const a=$r(e.viewer,e.left,e.left+e.paintWidth);for(const r of a)t.save(),t.beginPath(),t.translate(r.left-e.left,0),t.rect(0,0,r.width,t.canvas.height),t.clip(),t.translate(W/2,e.top+xr(F)),r.exec(t,e.rows),t.restore();{const r=t.createLinearGradient(0,-16,0,4);r.addColorStop(0,l.shadow),r.addColorStop(1,"transparent"),t.fillStyle=r,t.fillRect(0,0,t.canvas.width,6);const o=t.createLinearGradient(-16,0,4,0);o.addColorStop(0,l.shadow),o.addColorStop(1,"transparent"),t.fillStyle=o,t.fillRect(0,0,6,t.canvas.height)}}function Cr(e,t,l){for(const a of t)a.selected&&(e.fillStyle=l.selection,e.fillRect(a.leftPx+(a.border?te:0),0,a.widthPx,e.canvas.height)),a.border&&(e.fillStyle=l.border,e.fillRect(a.leftPx,0,te,e.canvas.height))}function $r(e,t,l){const a=e.headers.value,r=e.columnStats.value,o=e.datFile,n=[];let s=0;for(const u of a){const i=Me(u);if(s+i.borderWidth>=t)if(u.type.byteView)if(u.type.byteView.array)n.push({left:s+(i.borderWidth?te:0),width:i.paddingWidth,exec:(d,h)=>{cr(d,u,o,h,r[u.offset])}});else{const d=Math.max(0,Math.floor((t-s)/(W*3))),h=Math.min(u.length,Math.ceil((l-s)/(W*3)));n.push({left:s+(i.borderWidth?te:0),width:i.paddingWidth,exec:(p,v)=>{ur(p,u,o,v,d,h)}})}else n.push({left:s+(i.borderWidth?te:0),width:i.paddingWidth,exec:(d,h)=>{if(u.type.key?.table&&u.type.key.viewColumn){const p=e.referencedTables.value.get(u.type.key.table).value;if(p){const v=p.headers.find(f=>f.name===u.type.key.viewColumn);if(v){Ye(d,u,o,h,{header:v,datFile:p.datFile});return}}}Ye(d,u,o,h)}});if(s+=i.borderWidth,s>=l)return n}return n}function Me(e){const t=e.type.byteView&&!e.type.byteView.array?e.length*3-1:e.textLength;return{paddingWidth:Math.ceil((t+1)*W),borderWidth:Math.ceil((t+1)*W)+(e.offset>0?te:0),hasBorder:e.offset>0}}function Lr(e){let t=0;for(const l of e){const a=Me(l);t+=a.borderWidth}return t}function wt(e,t,l,a){const r=[];let o=0;for(const n of e){const s=Me(n);if(o+s.borderWidth>=l&&r.push({offset:n.offset,border:s.hasBorder,active:n===t,widthPx:s.borderWidth,leftPx:o,name:n.name}),o+=s.borderWidth,o>=a)return r}return r}const Mr=ne({props:{left:{type:Number,required:!0},width:{type:Number,required:!0},columns:{type:Array,required:!0}},setup(e){const t=N(0);let l=-1,a=[];const r=P("viewer"),o=P("dat-schemas");function n(x){l=x,a=[...r.columnSelection.value],Ve(r.columnSelection.value,l,l,r.headers.value),J(r.columnSelection),document.addEventListener("mouseup",y),document.addEventListener("mouseleave",y);function y(){l=-1,document.removeEventListener("mouseup",y),document.removeEventListener("mouseleave",y)}}function s(x,y){if(l===-1||y.buttons!==1)return;const{memsize:m}=r.datFile,k=x-l;k>=m?x=l+m*2-1:k>=4?x=l+8-1:k>=2&&(x=l+4-1),k<=-m?x=l-m*2+1:k<=-4?x=l-8+1:k<=-2&&(x=l-4+1),r.columnSelection.value=[...a],Ve(r.columnSelection.value,l,x,r.headers.value)}function u(x){const y=r.headers.value.find(m=>m.offset===x);r.editHeader.value===y&&(!y.type.byteView||y.type.byteView.array)?(t.value===0?t.value=1:t.value===1?t.value=-1:t.value===-1&&(t.value=1),r.rowSorting.value=Xn(y,t.value,r.datFile)):(r.editHeader.value=y,t.value=0)}function i(x,y){y.preventDefault();const m=r.headers.value.find(k=>k.offset===x);m.textLength!=null&&(m.textLength=Math.max(1,m.textLength-Math.sign(y.deltaY)*(y.ctrlKey?10:1)),J(r.headers),Se(r,o))}let d=0,h=0,p=null;function v(x,y){const m=r.headers.value.find(k=>k.offset===x);!m||m.textLength==null||(p=m,d=y.clientX,h=m.textLength,document.addEventListener("mousemove",f),document.addEventListener("mouseup",g),document.body.style.cursor="col-resize",document.body.style.userSelect="none")}function f(x){if(!p)return;const y=x.clientX-d,m=Math.round(y/W),k=Math.max(1,h+m);p.textLength=k,J(r.headers)}function g(){p&&Se(r,o),p=null,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),document.body.style.cursor="",document.body.style.userSelect=""}return{headers:S(()=>wt(r.headers.value,r.editHeader.value,e.left,e.left+e.width)),selectStart:n,selectContinue:s,editHeader:u,handleHeaderWheel:i,startResize:v,headersRowStyle:S(()=>({transform:`translate(${-e.left}px, 0)`,lineHeight:ke+"px",fontFamily:ee,fontSize:X+"px"})),colsRowStyle:S(()=>({transform:`translate(${-e.left}px, ${ke}px)`,lineHeight:ke+"px",fontFamily:ee,fontSize:X+"px"})),statsRowStyle:S(()=>({transform:`translate(${-e.left}px, ${ke*2}px)`,fontFamily:ee,fontSize:X+"px"}))}}}),Er={class:"datv-header-layer"},Or=["title","onClick","onWheel"],_r={key:1,class:"rounded bg-dark-300 px-1 text-dark-600 dark:bg-dark-600 dark:text-dark-300"},Ar=["onMousedown"],Rr=["title","onMousedown","onMouseenter","textContent"],Nr={key:0,class:"datv-stat__line bg-yellow-500",style:{top:"0"}},Tr={key:1,class:"datv-stat__line bg-green-500",style:{top:"7px"}},Dr={key:2,class:"datv-stat__line bg-gray-800",style:{top:"14px"}},Fr={key:3,class:"datv-stat__line bg-pink-400",style:{top:"14px"}},zr=["textContent"],Hr={key:1,class:"mx-auto inline-flex h-full items-center"};function Ir(e,t,l,a,r,o){return b(),w("div",Er,[c("div",{style:z(e.headersRowStyle),class:"absolute"},[(b(!0),w(O,null,H(e.headers,n=>(b(),w("div",{key:n.offset,class:A(["datv-header",{"datv-col--border":n.border,"datv-header--active":n.active}]),style:z({width:n.widthPx+"px",transform:`translate(${n.leftPx}px, 0)`})},[c("button",{class:"datv-header-btn",title:n.name==null?"unidentified":n.name||"unnamed",onClick:s=>e.editHeader(n.offset),onWheel:s=>e.handleHeaderWheel(n.offset,s)},[n.name===null?(b(),w(O,{key:0},[_("Â ")],64)):n.name===""?(b(),w("span",_r,"?")):(b(),w(O,{key:2},[_(E(n.name),1)],64))],40,Or),n.name!==null?(b(),w("div",{key:0,class:"datv-resize-handle",onMousedown:dt(s=>e.startResize(n.offset,s),["prevent","stop"])},null,40,Ar)):L("",!0)],6))),128))],4),c("div",{style:z(e.colsRowStyle),class:"absolute"},[(b(!0),w(O,null,H(e.columns,n=>(b(),w("button",{key:n.offset,class:A(["datv-byte",{"datv-col--border":n.border,"datv-byte--selected":n.selected}]),style:z({width:n.widthPx+"px",transform:`translate(${n.leftPx}px, 0)`}),title:String(n.offset),onMousedown:s=>e.selectStart(n.offset),onMouseenter:s=>e.selectContinue(n.offset,s),textContent:E(n.text)},null,46,Rr))),128))],4),c("div",{style:z(e.statsRowStyle),class:"datv-stats_row absolute"},[(b(!0),w(O,null,H(e.columns,n=>(b(),w("div",{key:n.offset,class:A(["datv-stat",{"datv-col--border":n.border,"datv-byte--selected":n.selected}]),style:z({width:n.widthPx+"px",transform:`translate(${n.leftPx}px, 0)`})},[n.stat?(b(),w(O,{key:0},[n.stat.string?(b(),w("div",Nr)):L("",!0),n.stat.array?(b(),w("div",Tr)):L("",!0),n.stat.zero?(b(),w("div",Dr)):n.stat.nullable?(b(),w("div",Fr)):L("",!0),c("div",{class:"datv-stat__max",textContent:E(n.stat.max)},null,8,zr)],64)):n.key?(b(),w("span",Hr,[...t[0]||(t[0]=[c("i",{class:"codicon codicon-key"},null,-1)])])):L("",!0)],6))),128))],4)])}const Pr=oe(Mr,[["render",Ir]]);var Z={},de={},j={},Ke;function Y(){if(Ke)return j;Ke=1,Object.defineProperty(j,"__esModule",{value:!0}),j.fillTwoDimensionalArray=j.createTwoDimensionalArray=j.isNullOrUndefined=void 0;function e(a){return a==null}j.isNullOrUndefined=e;function t(a,r){for(var o=Array(a),n=0;n<o.length;n++)o[n]=Array(r);return o}j.createTwoDimensionalArray=t;function l(a,r){r===void 0&&(r=0);for(var o=0,n=a;o<n.length;o++)for(var s=n[o],u=0;u<s.length;u++)s[u]=r}return j.fillTwoDimensionalArray=l,j}var Xe;function Wr(){if(Xe)return de;Xe=1,Object.defineProperty(de,"__esModule",{value:!0}),de.JaroWinkler=void 0;var e=Y(),t=(function(){function l(a){this.DEFAULT_THRESHOLD=.7,this.THREE=3,this.JW_COEF=.1,this.threshold=a||this.DEFAULT_THRESHOLD}return l.prototype.similarity=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");if(a===r)return 1;var o=this.matches(a,r),n=o[0];if(n===0)return 0;var s=(n/a.length+n/r.length+(n-o[1])/n)/this.THREE,u=s;return s>this.threshold&&(u=s+Math.min(this.JW_COEF,1/o[this.THREE])*o[2]*(1-s)),u},l.prototype.distance=function(a,r){return 1-this.similarity(a,r)},l.prototype.matches=function(a,r){var o,n;a.length>r.length?(o=a,n=r):(o=r,n=a);var s=Math.max(Math.floor(o.length/2)-1,0),u=Array(n.length);u.fill(-1);for(var i=Array(o.length),d=0,h=0;h<n.length;h++)for(var p=n[h],v=Math.max(h-s,0),f=Math.min(h+s+1,o.length);v<f;v++)if(!i[v]&&p===o[v]){u[h]=v,i[v]=!0,d++;break}for(var g=Array(d),C=Array(d),x=0,y=0;x<n.length;x++)u[x]!==-1&&(g[y]=n[x],y++);for(var x=0,y=0;x<o.length;x++)i[x]&&(C[y]=o[x],y++);for(var m=0,h=0;h<g.length;h++)g[h]!==C[h]&&m++;for(var k=0,h=0;h<n.length&&a[h]===r[h];h++)k++;return[d,Math.floor(m/2),k,o.length]},l})();return de.JaroWinkler=t,de}var ue={},Qe;function kt(){if(Qe)return ue;Qe=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.Levenshtein=void 0;var e=Y(),t=(function(){function l(){}return l.prototype.distance=function(a,r,o){if(o===void 0&&(o=Number.MAX_VALUE),e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");if(a===r)return 0;if(a.length===0)return r.length;if(r.length===0)return a.length;for(var n=Array(r.length+1),s=Array(r.length+1),u=[],i=0;i<n.length;i++)n[i]=i;for(var i=0;i<a.length;i++){s[0]=i+1;for(var d=s[0],h=0;h<r.length;h++){var p=1;a[i]===r[h]&&(p=0),s[h+1]=Math.min(s[h]+1,Math.min(n[h+1]+1,n[h]+p)),d=Math.min(d,s[h+1])}if(d>=o)return o;u=n,n=s,s=u}return n[r.length]},l})();return ue.Levenshtein=t,ue}var ce={},Ze;function Ur(){if(Ze)return ce;Ze=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.CharacterInsDelInterface=void 0;var e=(function(){function t(l,a){this.deletionCost=l,this.insertionCost=a}return t})();return ce.CharacterInsDelInterface=e,ce}var fe={},et;function Vr(){if(et)return fe;et=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.CharacterSubstitutionInterface=void 0;var e=(function(){function t(l){this.cost=l}return t})();return fe.CharacterSubstitutionInterface=e,fe}var he={},tt;function Br(){if(tt)return he;tt=1,Object.defineProperty(he,"__esModule",{value:!0}),he.NormalizedLevenshtein=void 0;var e=kt(),t=Y(),l=(function(){function a(){this.l=new e.Levenshtein}return a.prototype.distance=function(r,o){if(t.isNullOrUndefined(r))throw new Error("s1 must neither be null nor undefined");if(t.isNullOrUndefined(o))throw new Error("s2 must neither be null nor undefined");if(r===o)return 0;var n=Math.max(r.length,o.length);return n===0?0:this.l.distance(r,o)/n},a.prototype.similarity=function(r,o){return 1-this.distance(r,o)},a})();return he.NormalizedLevenshtein=l,he}var ve={},nt;function qr(){if(nt)return ve;nt=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.WeightedLevenshtein=void 0;var e=Y(),t=(function(){function l(a,r){this.charsub=a,this.charchange=r}return l.prototype.distance=function(a,r,o){if(o===void 0&&(o=Number.MAX_VALUE),e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");if(a===r)return 0;if(a.length===0)return r.length;if(r.length===0)return a.length;var n=Array(r.length+1),s=Array(r.length+1),u=[];n[0]=0;for(var i=1;i<n.length;i++)n[i]=n[i-1]+this.insertionCost(r[i-1]);for(var i=0;i<a.length;i++){var d=a[i],h=this.deletionCost(d);s[0]=n[0]+h;for(var p=s[0],v=0;v<r.length;v++){var f=r[v],g=0;d!==f&&(g=this.charsub.cost(d,f));var C=this.insertionCost(f);s[v+1]=Math.min(s[v]+C,Math.min(n[v+1]+h,n[v]+g)),p=Math.min(p,s[v+1])}if(p>=o)return o;u=n,n=s,s=u}return n[r.length]},l.prototype.insertionCost=function(a){return this.charchange?this.charchange.insertionCost(a):1},l.prototype.deletionCost=function(a){return this.charchange?this.charchange.deletionCost(a):1},l})();return ve.WeightedLevenshtein=t,ve}var pe={},rt;function jr(){if(rt)return pe;rt=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.Damerau=void 0;var e=Y(),t=(function(){function l(){}return l.prototype.distance=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");if(a===r)return 0;for(var o=a.length+r.length,n=new Map,s=0;s<a.length;s++)n.set(a[s],0);for(var s=0;s<r.length;s++)n.set(r[s],0);for(var u=e.createTwoDimensionalArray(a.length+2,r.length+2),i=0;i<=a.length;i++)u[i+1][0]=o,u[i+1][1]=i;for(var d=0;d<=r.length;d++)u[0][d+1]=o,u[1][d+1]=d;for(var i=1;i<=a.length;i++){for(var h=0,d=1;d<=r.length;d++){var p=n.get(r[d-1]),v=h,f=1;a[i-1]===r[d-1]&&(f=0,h=d),u[i+1][d+1]=this.min(u[i][d]+f,u[i+1][d]+1,u[i][d+1]+1,u[p][v]+(i-p-1)+1+(d-v-1))}n.set(a[i-1],i)}return u[a.length+1][r.length+1]},l.prototype.min=function(a,r,o,n){return this.minWithNaN(a,this.minWithNaN(r,this.minWithNaN(o,n)))},l.prototype.minWithNaN=function(a,r){return isNaN(a)&&isNaN(r)?0:isNaN(a)?r:isNaN(r)?a:Math.min(a,r)},l})();return pe.Damerau=t,pe}var ye={},at;function Gr(){if(at)return ye;at=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.OptimalStringAlignment=void 0;var e=Y(),t=(function(){function l(){}return l.prototype.distance=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");if(a===r)return 0;var o=a.length,n=r.length;if(o==0)return n;if(n==0)return o;for(var s=e.createTwoDimensionalArray(o+2,n+2),u=0;u<=o;u++)s[u][0]=u;for(var i=0;i<=n;i++)s[0][i]=i;for(var d,u=1;u<=o;u++)for(var i=1;i<=n;i++)d=1,a.charAt(u-1)==r.charAt(i-1)&&(d=0),s[u][i]=this.min(s[u-1][i-1]+d,s[u][i-1]+1,s[u-1][i]+1),u>1&&i>1&&a.charAt(u-1)===r.charAt(i-2)&&a.charAt(u-2)===r.charAt(i-1)&&(s[u][i]=Math.min(s[u][i],s[u-2][i-2]+d));return s[o][n]},l.prototype.min=function(a,r,o){return Math.min(a,Math.min(r,o))},l})();return ye.OptimalStringAlignment=t,ye}var me={},ot;function xt(){if(ot)return me;ot=1,Object.defineProperty(me,"__esModule",{value:!0}),me.LongestCommonSubsequence=void 0;var e=Y(),t=(function(){function l(){}return l.prototype.distance=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");return a===r?0:a.length+r.length-2*this.length(a,r)},l.prototype.length=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");var o=a.length,n=r.length,s=a,u=r,i=e.createTwoDimensionalArray(o+1,n+1);e.fillTwoDimensionalArray(i);for(var d=1;d<=o;d++)for(var h=1;h<=n;h++)s[d-1]===u[h-1]?i[d][h]=i[d-1][h-1]+1:i[d][h]=Math.max(i[d][h-1],i[d-1][h]);return i[o][n]},l})();return me.LongestCommonSubsequence=t,me}var ge={},lt;function Jr(){if(lt)return ge;lt=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.MetricLCS=void 0;var e=xt(),t=Y(),l=(function(){function a(){this.lcs=new e.LongestCommonSubsequence}return a.prototype.distance=function(r,o){if(t.isNullOrUndefined(r))throw new Error("s1 must neither be null nor undefined");if(t.isNullOrUndefined(o))throw new Error("s2 must neither be null nor undefined");if(r===o)return 0;var n=Math.max(r.length,o.length);return n==0?0:1-1*this.lcs.length(r,o)/n},a})();return ge.MetricLCS=l,ge}var be={},it;function Yr(){if(it)return be;it=1,Object.defineProperty(be,"__esModule",{value:!0}),be.NGram=void 0;var e=Y(),t=(function(){function l(a){this.DEFAULT_N=2,this.n=e.isNullOrUndefined(a)?this.DEFAULT_N:a}return l.prototype.distance=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s0 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s1 must neither be null nor undefined");if(a===r)return 0;var o=`
`,n=a.length,s=r.length;if(n==0||s==0)return 1;var u=0;if(n<this.n||s<this.n){for(var i=0,d=Math.min(n,s);i<d;i++)a.charAt(i)==r.charAt(i)&&u++;return u/Math.max(n,s)}for(var h=Array(n+this.n-1),p,v,f,g=0;g<h.length;g++)g<this.n-1?h[g]=o:h[g]=a.charAt(g-this.n+1);p=Array(n+1),v=Array(n+1);var C,x,y=Array(this.n);for(C=0;C<=n;C++)p[C]=C;for(x=1;x<=s;x++){if(x<this.n){for(var m=0;m<this.n-x;m++)y[m]=o;for(var m=this.n-x;m<this.n;m++)y[m]=r.charAt(m-(this.n-x))}else y=r.substring(x-this.n,x).split("");for(v[0]=x,C=1;C<=n;C++){u=0;for(var k=this.n,d=0;d<this.n;d++)h[C-1+d]!=y[d]?u++:h[C-1+d]==o&&k--;var M=u/k;v[C]=Math.min(Math.min(v[C-1]+1,p[C]+1),p[C-1]+M)}f=p,p=v,v=f}return p[n]/Math.max(s,n)},l})();return be.NGram=t,be}var st;function Kr(){return st||(st=1,(function(e){var t=Z&&Z.__createBinding||(Object.create?(function(a,r,o,n){n===void 0&&(n=o),Object.defineProperty(a,n,{enumerable:!0,get:function(){return r[o]}})}):(function(a,r,o,n){n===void 0&&(n=o),a[n]=r[o]})),l=Z&&Z.__exportStar||function(a,r){for(var o in a)o!=="default"&&!r.hasOwnProperty(o)&&t(r,a,o)};Object.defineProperty(e,"__esModule",{value:!0}),l(Wr(),e),l(kt(),e),l(Ur(),e),l(Vr(),e),l(Br(),e),l(qr(),e),l(jr(),e),l(Gr(),e),l(xt(),e),l(Jr(),e),l(Yr(),e)})(Z)),Z}var Xr=Kr();function Qr(e,t,l){e=e.toLowerCase();const a=[],r=[],o=[],n=new Xr.MetricLCS;for(const i of l)t>=i.totalRows||i.name.toLowerCase()===e||(a.push(i),r.push(i.totalRows-(t+1)),o.push(n.distance(e,i.name.toLowerCase())));const s=new Array(a.length).fill(0);for(const i of[r,o]){const d=Math.min(...i),h=Math.max(...i);for(let p=0;p<i.length;p+=1){const v=(i[p]-d)/(h-d);v>.33&&(s[p]+=v)}}const u=new Array(a.length).fill(0).map((i,d)=>d);return u.sort((i,d)=>s[i]-s[d]),u.map(i=>a[i])}function Zr(e,t,l){const a=[],{fieldSize:r}=l,o=e.length;return o===r.ARRAY&&t.refArray&&a.push({label:"Array",value:"array"}),o===r.STRING&&t.refString&&a.push({label:"String",value:"string"}),o===r.KEY&&t.keySelf&&a.push({label:"Key (self)",value:"key_self"}),o===r.KEY_FOREIGN&&t.keyForeign&&a.push({label:"Key (foreign)",value:"key_foreign"}),(o===4||o===2)&&a.push({label:"Integer",value:"integer"}),o===4&&a.push({label:"Decimal",value:"decimal"}),o===1&&t.maxValue<=1&&a.push({label:"Boolean",value:"boolean"}),a}function ea(e,t){const l=[];if(!e.type.array||!t.refArray)return l;const a=t.refArray;return a.string&&l.push({label:"String",value:"string"}),a.keySelf&&l.push({label:"Key (self)",value:"key_self"}),a.keyForeign&&l.push({label:"Key (foreign)",value:"key_foreign"}),a.numeric32&&l.push({label:"Integer - 4 bytes",value:"integer_4"}),a.numeric32&&l.push({label:"Decimal - 4 bytes",value:"decimal_4"}),a.boolean&&l.push({label:"Boolean",value:"boolean"}),l}function ta(e,t){const l=N([]);return t.findByName(e).then(a=>{l.value=a}).catch(()=>{}),l}const na=ne({setup(){const e=P("viewer"),t=P("dat-schemas"),l=S(()=>e.editHeader.value&&Mt(e.editHeader.value));{let f=null;xe(l,g=>{f&&(f(),f=null),g&&(f=xe(g,()=>{J(e.headers),Se(e,t)},{deep:!0}))})}const a=S(()=>e.columnStats.value[l.value.offset]),r=S({get(){const f=l.value.type;return f.array?"array":f.string?"string":f.key?f.key.foreign?"key_foreign":"key_self":f.integer?"integer":f.decimal?"decimal":f.boolean?"boolean":void 0},set(f){const g=l.value;g.type={},f==="array"?(g.type.array=!0,g.type.byteView={array:!0}):f==="string"?g.type.string={}:f==="key_foreign"?g.type.key={foreign:!0,table:null,viewColumn:null}:f==="key_self"?g.type.key={foreign:!1,table:e.name,viewColumn:null}:f==="integer"?g.type.integer={unsigned:!1,size:g.length}:f==="decimal"?g.type.decimal={size:g.length}:f==="boolean"&&(g.type.boolean={})}}),o=S({get(){const f=l.value.type;return f.string?"string":f.key?f.key.foreign?"key_foreign":"key_self":f.integer?`integer_${f.integer.size}`:f.decimal?`decimal_${f.decimal.size}`:f.boolean?"boolean":void 0},set(f){const g=l.value;g.type={array:!0},f==="string"?g.type.string={}:f==="key_foreign"?g.type.key={foreign:!0,table:null,viewColumn:null}:f==="key_self"?g.type.key={foreign:!1,table:e.name,viewColumn:null}:f==="integer_1"?g.type.integer={unsigned:!1,size:1}:f==="integer_2"?g.type.integer={unsigned:!1,size:2}:f==="integer_4"?g.type.integer={unsigned:!1,size:4}:f==="integer_8"?g.type.integer={unsigned:!1,size:8}:f==="decimal_4"?g.type.decimal={size:4}:f==="decimal_8"?g.type.decimal={size:8}:f==="boolean"&&(g.type.boolean={})}}),n=S(()=>{const f=[],g=l.value.type;return f.push({label:"Bytes",value:"bytes"}),g.array&&f.push({label:"Var. bytes",value:"array-bytes"}),f.push({label:"Data",value:"data",disabled:!r.value||r.value==="array"&&!o.value}),f}),s=S({get(){const f=l.value.type;return f.byteView?f.byteView.array?"array-bytes":"bytes":"data"},set(f){const g=l.value.type;f==="data"?g.byteView=void 0:g.byteView={array:f==="array-bytes"}}}),u=S(()=>{const f=Te(l.value,e.datFile);return Math.max(...l.value.type.array?f.flat():f)}),i=S(()=>{let f;if(!l.value.type.key.foreign)return f=[{value:e.name,label:e.name}],f;if(f=[{value:null,label:"rid (unknown)"}],t.tableStats.length){const g=Qr(e.name,u.value,t.tableStats);f.push(...g.map(C=>({value:C.name,label:C.name})))}else l.value.type.key.table!==null&&f.push({value:l.value.type.key.table,label:l.value.type.key.table});return f}),d=S(()=>l.value.type.key?.table?ta(l.value.type.key.table,t):null),h=S(()=>{if(!l.value.type.key)return[];const f=[{value:null,label:"row index"}],g=l.value.type.key.foreign?d.value?.value??[]:e.headers.value;return f.push(...g.filter(C=>C.name!==null&&C.name.length&&!C.type.array).map(C=>({label:C.name,value:C.name}))),f});function p(){e.editHeader.value=null}function v(){Ht(l.value,e.headers.value),e.editHeader.value=null,J(e.headers),Se(e,t)}return{isVisible:S(()=>e.editHeader.value!=null),HEADERS_HEIGHT:re,header:l,byteViewMode:s,dataType:r,arrayType:o,close:p,remove:v,viewModeOpts:n,keyTableOpts:i,keyDisplayColumnOpts:h,tablesPreloadNeeded:()=>l.value.type.key!=null?l.value.type.key.foreign&&!t.tableStats.length:!1,dataTypeOpts:S(()=>Zr(l.value,a.value,e.datFile)),arrayTypeOpts:S(()=>ea(l.value,a.value))}}}),ra={key:0,style:{width:"300px"},class:"relative overflow-hidden"},aa={class:"absolute inset-0 m-2 flex flex-col border border-dark-300 bg-white shadow dark:border-dark-600 dark:bg-dark-800"},oa={class:"flex items-center bg-dark-100 p-2 text-dark-600 shadow dark:bg-dark-700 dark:text-dark-300"},la={key:0,class:"p-4 text-dark-700 dark:text-dark-300"},ia={key:1,class:"overflow-auto p-4 text-dark-700 dark:text-dark-300"},sa={class:"mb-4"},da={class:"mb-4 flex items-baseline"},ua={class:"flex gap-x-px"},ca=["disabled","onClick","textContent"],fa={class:"mb-4"},ha={class:"mb-2 flex items-baseline justify-between"},va={class:"inline-flex cursor-pointer items-center"},pa=["value"],ya={class:"ml-2"},ma={key:0,class:"mt-3"},ga={class:"inline-flex cursor-pointer items-center"},ba=["value"],wa={class:"ml-2"},ka={key:0,class:"mb-4"},xa={class:"inline-flex cursor-pointer items-center"},Sa={key:1,class:"mb-4"},Ca=["disabled"],$a=["value"],La={key:0,class:"mt-2 italic text-dark-500"},Ma={key:2,class:"mb-4"},Ea=["value"],Oa={key:3,class:"mb-4"};function _a(e,t,l,a,r,o){return e.isVisible?(b(),w("div",ra,[c("div",{style:z({height:e.HEADERS_HEIGHT+"px"}),class:"bg-dark-100 dark:bg-dark-800"},null,4),c("div",aa,[c("div",oa,[t[11]||(t[11]=c("span",{class:"px-2"},"Column properties",-1)),c("button",{class:"rounded-full border border-dark-400 px-3 hover:bg-dark-200 dark:border-dark-500 dark:hover:bg-dark-600",onClick:t[0]||(t[0]=n=>e.$emit("focus-editing-header"))}," Focus "),c("button",{class:"ml-auto px-2 py-1 hover:text-dark-900 dark:hover:text-dark-100",title:"Close",onClick:t[1]||(t[1]=(...n)=>e.close&&e.close(...n))},[...t[10]||(t[10]=[c("i",{class:"codicon codicon-close"},null,-1)])])]),e.header.name===null?(b(),w("div",la,[c("div",null,E(e.header.length)+" bytes of unidentified data",1)])):(b(),w("div",ia,[c("div",sa,[t[12]||(t[12]=c("label",{for:"datv-header-name",class:"text-dark-600 dark:text-dark-400"},"Name",-1)),G(c("input",{id:"datv-header-name","onUpdate:modelValue":t[2]||(t[2]=n=>e.header.name=n),placeholder:"Unnamed",class:"mt-1 w-full border border-dark-300 bg-white p-1 text-dark-900 focus:border-primary-500 dark:border-dark-600 dark:bg-dark-700 dark:text-dark-100",spellcheck:"false"},null,512),[[_e,e.header.name,void 0,{trim:!0}]])]),c("div",da,[t[13]||(t[13]=c("div",{class:"mr-2"},"View mode",-1)),c("div",ua,[(b(!0),w(O,null,H(e.viewModeOpts,n=>(b(),w("button",{key:n.value,class:A(["px-2",e.byteViewMode===n.value?"bg-primary-600 text-white":"bg-dark-100 hover:bg-dark-300 dark:bg-dark-700 dark:hover:bg-dark-600"]),disabled:n.disabled,onClick:s=>e.byteViewMode=n.value,textContent:E(n.label)},null,10,ca))),128))])]),c("div",fa,[c("div",ha,[t[14]||(t[14]=c("span",null,"Data type",-1)),c("button",{class:"bg-red-100 px-2 text-red-700 hover:bg-red-200 dark:bg-red-900/30 dark:text-red-400 dark:hover:bg-red-900/50",onClick:t[3]||(t[3]=(...n)=>e.remove&&e.remove(...n))}," Delete ")]),c("div",null,[(b(!0),w(O,null,H(e.dataTypeOpts,n=>(b(),w("div",{key:n.value,class:"mb-0.5"},[c("label",va,[G(c("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>e.dataType=s),type:"radio",value:n.value},null,8,pa),[[He,e.dataType]]),c("span",ya,E(n.label),1)])]))),128)),e.arrayTypeOpts.length?(b(),w("div",ma,[t[15]||(t[15]=c("div",{class:"mb-1 text-dark-500"},"of ...",-1)),(b(!0),w(O,null,H(e.arrayTypeOpts,n=>(b(),w("div",{key:n.value,class:"mb-0.5"},[c("label",ga,[G(c("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>e.arrayType=s),type:"radio",value:n.value},null,8,ba),[[He,e.arrayType]]),c("span",wa,E(n.label),1)])]))),128))])):L("",!0)])]),e.header.type.integer?(b(),w("div",ka,[c("label",xa,[G(c("input",{"onUpdate:modelValue":t[6]||(t[6]=n=>e.header.type.integer.unsigned=n),type:"checkbox"},null,512),[[Et,e.header.type.integer.unsigned]]),t[16]||(t[16]=c("span",{class:"ml-2"},"Unsigned",-1))])])):L("",!0),e.header.type.key?(b(),w("div",Sa,[t[17]||(t[17]=c("label",{for:"datv-header-key-table",class:"text-dark-600 dark:text-dark-400"},"Table",-1)),G(c("select",{id:"datv-header-key-table","onUpdate:modelValue":t[7]||(t[7]=n=>e.header.type.key.table=n),class:"mt-1 w-full border border-dark-300 bg-white p-1 text-dark-900 focus:border-primary-500 dark:border-dark-600 dark:bg-dark-700 dark:text-dark-100",disabled:e.tablesPreloadNeeded()},[(b(!0),w(O,null,H(e.keyTableOpts,n=>(b(),w("option",{key:n.label,value:n.value},E(n.label),9,$a))),128))],8,Ca),[[Ie,e.header.type.key.table]]),e.tablesPreloadNeeded()?(b(),w("div",La," (pre-load all Data Tables to change) ")):L("",!0)])):L("",!0),t[22]||(t[22]=c("hr",{class:"my-6 border-dark-200 dark:border-dark-600"},null,-1)),e.keyDisplayColumnOpts.length?(b(),w("div",Ma,[t[18]||(t[18]=c("label",{for:"datv-header-key-column",class:"text-dark-600 dark:text-dark-400"},"Display Column",-1)),G(c("select",{id:"datv-header-key-column","onUpdate:modelValue":t[8]||(t[8]=n=>e.header.type.key.viewColumn=n),class:"mt-1 w-full border border-dark-300 bg-white p-1 text-dark-900 focus:border-primary-500 dark:border-dark-600 dark:bg-dark-700 dark:text-dark-100"},[(b(!0),w(O,null,H(e.keyDisplayColumnOpts,n=>(b(),w("option",{key:n.label,value:n.value},E(n.label),9,Ea))),128))],512),[[Ie,e.header.type.key.viewColumn]])])):L("",!0),e.dataType?(b(),w("div",Oa,[t[19]||(t[19]=c("label",{class:"mr-4"},"Width",-1)),G(c("input",{"onUpdate:modelValue":t[9]||(t[9]=n=>e.header.textLength=n),class:"w-16 border border-dark-300 bg-white text-center text-dark-900 dark:border-dark-600 dark:bg-dark-700 dark:text-dark-100"},null,512),[[_e,e.header.textLength,void 0,{number:!0}]]),t[20]||(t[20]=_(" chars ",-1)),t[21]||(t[21]=c("div",{class:"mt-2 italic text-dark-500"}," (move mouse over the column name in Viewer and use `ScrollWheel`, hold `Ctrl` to increase resize step) ",-1))])):L("",!0)]))])])):L("",!0)}const Aa=oe(na,[["render",_a]]),Ra=Math.ceil(W*3);function Na(e,t,l,a,r){const o=[];let n=0;for(const s of l){const u=Me(s);if(s.type.byteView&&!s.type.byteView.array){let i=n;for(let d=0;d<s.length;++d){const h=u.hasBorder&&d===0,p=W*3+(h?te:0);if(Math.ceil(i)+p<a){i+=p;continue}const v=s.offset+d;if(o.push({offset:v,selected:e[v],border:h,widthPx:Ra,leftPx:Math.ceil(i),text:String(v%100).padStart(2,"0"),stat:t[v],key:!1}),i+=p,Math.ceil(i)>=r)return o}}else n+u.borderWidth>=a&&o.push({offset:s.offset,selected:!1,border:u.hasBorder,widthPx:u.paddingWidth,leftPx:n,text:String(s.offset%100).padStart(2,"0"),key:s.type.key!=null});if(n+=u.borderWidth,n>=r)return o}return o}function Ta(e,t){const l=e.map(r=>({max:r.maxValue.toString(16).padStart(2,"0"),array:!1,string:!1,nullable:!1,zero:r.maxValue===0})),{fieldSize:a}=t;for(let r=0;r<e.length;++r){const o=e[r];if(o.refString)for(let n=0;n<a.STRING;++n)l[r+n].string=!0;if(o.refArray)for(let n=0;n<a.ARRAY;++n)l[r+n].array=!0;if(o.nullableMemsize)for(let n=0;n<t.memsize;++n)l[r+n].nullable=!0}return l}const Da=ne({components:{ResizeObserver:Pt,CanvasScroll:It,ViewerActions:Kn,ViewerHead:Pr,HeaderProps:Aa},props:{args:{type:Object,required:!0},kaState:{type:Object,default:void 0},kaScope:{type:Object,required:!0}},emits:["update:kaState"],setup(e,t){const l=P("bundle-index"),a=P("dat-schemas"),r=Vt();let o;e.kaState?o=e.kaState:(o=tn(e.args.fullPath,e.args.fileContent,l,a,e.kaScope),t.emit("update:kaState",o)),Ot("viewer",o);const n=V(null),s=V(null);function u($){if(($.ctrlKey||$.metaKey)&&$.key==="c"&&o.selectedRow.value!==null){$.preventDefault();const R=we(o.headers.value,o.datFile)[o.selectedRow.value];if(R){const K=r.settings.copyFormat;let Ce;if(K==="csv"){const ie=Object.keys(R);Ce=ie.join(",")+`
`+ie.map(Ee=>{const T=R[Ee];return T==null?"":typeof T=="string"?`"${T.replace(/"/g,'""')}"`:Array.isArray(T)?`"${JSON.stringify(T).replace(/"/g,'""')}"`:String(T)}).join(",")}else if(K==="tsv"){const ie=Object.keys(R);Ce=ie.join("	")+`
`+ie.map(Ee=>{const T=R[Ee];return T==null?"":Array.isArray(T)?JSON.stringify(T):String(T)}).join("	")}else Ce=JSON.stringify(R,null,2);navigator.clipboard.writeText(Ce)}}}Re(()=>{s.value.scrollTo(o.scrollPos.x,o.scrollPos.y),window.addEventListener("keydown",u)}),Ne(()=>{window.removeEventListener("keydown",u)});const i=S(()=>o.rowSorting.value?o.rowSorting.value:Array.from({length:o.datFile.rowCount},($,B)=>B)),d=V(0),h=V(0);function p($){d.value=$.width,h.value=$.height}const{scrollPos:v}=o;function f($){v.x=$.x,v.y=$.y}const g=S(()=>Lr(o.headers.value)),C=S(()=>o.datFile.rowCount*F),x=S(()=>br(o.datFile.rowCount)),y=S(()=>Math.max(0,d.value-x.value)),m=S(()=>Math.max(0,h.value-re));xe([y,m],()=>{const $=window.devicePixelRatio;n.value.style.width=y.value+"px",n.value.style.height=m.value+"px",n.value.width=y.value*$,n.value.height=m.value*$,n.value.getContext("2d",{alpha:!1}).scale($,$),U()});const k=S(()=>Ta(o.columnStats.value,o.datFile)),M=S(()=>Na(o.columnSelection.value,k.value,o.headers.value,v.x,v.x+Math.min(g.value,y.value))),I=S(()=>{for(const $ of o.referencedTables.value.values())$.value});xe([v,M,i,o.selectedRow,I],()=>{U()});function U(){const $=n.value.getContext("2d",{alpha:!1});Sr({left:v.x,paintWidth:y.value,top:Q.value.top,rows:Q.value.ids,columns:M.value,viewer:o,ctx:$})}const Q=S(()=>{const $=v.y,B=Math.ceil(m.value/F)+1,R=Math.floor($/F);return{top:R*F-$,ids:i.value.slice(R,R+B)}});function Ct(){const $=o.editHeader.value,R=wt(o.headers.value,null,0,0+1/0).find(K=>K.offset===$.offset);s.value.scrollTo(R.leftPx-y.value*.33,void 0)}function $t($){const{selectedRow:B}=o,R=Math.floor(($.offsetY+v.y)/F),K=i.value[R];B.value=B.value!==K?K:null}const le=S(()=>r.settings.showLineNumbers),ze=S(()=>le.value?x.value:0);return{headerBlockStyle:S(()=>({height:re+"px",width:d.value+"px"})),headerOverlayContentStyle:S(()=>({left:ze.value+"px",height:re+"px",width:(le.value?y.value:d.value)+"px"})),scrollableStyle:S(()=>({top:re+"px",left:ze.value+"px"})),scrollablePaintSize:S(()=>({width:le.value?y.value:d.value,height:m.value})),scrollableFullSize:S(()=>({width:g.value,height:C.value})),rowsOverlayStyle:S(()=>({top:re+"px",width:x.value+"px",height:m.value+"px",fontFamily:ee,fontSize:X+"px",lineHeight:F+"px"})),showLineNumbers:le,handleScroll:f,handleResize:p,renderItems:Q,canvasRef:n,renderColumns:M,scrollLeft:S(()=>v.x),rowsWidth:S(()=>Math.min(g.value,le.value?y.value:d.value)),LINE_HEIGHT:F,canvasScroll:s,rowsNumberWidth:bt(o.datFile.rowCount)+"px",focusEditingHeader:Ct,handleCanvasClick:$t}}}),Fa="_rowsOverlay_17ljd_2",za={rowsOverlay:Fa},Ha={class:"flex flex-1"},Ia=["textContent"];function Pa(e,t,l,a,r,o){const n=se("viewer-actions"),s=se("viewer-head"),u=se("canvas-scroll"),i=se("resize-observer"),d=se("header-props");return b(),w(O,null,[D(n),c("div",Ha,[D(i,{class:"relative min-h-0 flex-1",onResize:e.handleResize},{default:Pe(()=>[c("div",{class:"absolute bg-dark-800",style:z(e.headerBlockStyle)},[D(s,{style:z(e.headerOverlayContentStyle),left:e.scrollLeft,width:e.rowsWidth,columns:e.renderColumns},null,8,["style","left","width","columns"])],4),D(u,{ref:"canvasScroll",class:"absolute bg-dark-900",style:z(e.scrollableStyle),"paint-size":e.scrollablePaintSize,"full-size":e.scrollableFullSize,onScroll:e.handleScroll},{default:Pe(()=>[c("canvas",{ref:"canvasRef",onClick:t[0]||(t[0]=(...h)=>e.handleCanvasClick&&e.handleCanvasClick(...h))},null,512)]),_:1},8,["style","paint-size","full-size","onScroll"]),e.showLineNumbers?(b(),w("div",{key:0,class:A(e.$style.rowsOverlay),style:z(e.rowsOverlayStyle)},[c("div",{class:"absolute",style:z({transform:`translate(0, ${e.renderItems.top}px)`})},[(b(!0),w(O,null,H(e.renderItems.ids,(h,p)=>(b(),w("div",{key:h,style:z({transform:`translate(0, ${p*e.LINE_HEIGHT}px)`,width:e.rowsNumberWidth,position:"absolute"}),textContent:E(h)},null,12,Ia))),128))],4)],6)):L("",!0)]),_:1},8,["onResize"]),D(d,{onFocusEditingHeader:e.focusEditingHeader},null,8,["onFocusEditingHeader"])])],64)}const Wa={$style:za},St=oe(Da,[["render",Pa],["__cssModules",Wa]]),Ua={key:0,class:"flex items-center border-b border-dark-700 bg-dark-800/50"},Va={class:"flex flex-1 items-center gap-1 overflow-x-auto px-2 py-1"},Ba=["onClick"],qa={class:"max-w-32 truncate"},ja=["onClick"],Ga={class:"flex items-center gap-1 border-l border-dark-700 px-2"},Ja=["title"],Ya={class:"relative flex-1 overflow-hidden"},Ka={key:0,class:"flex h-full flex-col items-center justify-center p-8"},Xa={class:"mb-6 rounded-2xl bg-dark-800 p-6"},Qa={class:"mt-8 flex gap-4"},Za={class:"btn-primary cursor-pointer"},eo={class:"btn-secondary"},to={key:2,class:"absolute inset-0 z-50 flex items-center justify-center bg-dark-900/90 backdrop-blur-sm"},no={class:"rounded-xl border-2 border-dashed border-primary-500 bg-primary-600/10 p-12 text-center"},uo=ne({__name:"ViewerView",setup(e){const t=At(),l=Wt(),a=P("bundle-index"),r=V([]),o=V(null),n=V(!1),s=V(!1),u=S(()=>r.value.find(y=>y.id===o.value));xe(()=>t.query.file,async y=>{y&&typeof y=="string"&&await i(y)},{immediate:!0});async function i(y){const m=r.value.find(k=>k.fullPath===y);if(m){o.value=m.id;return}try{l.setLoading(!0,`Loading ${y}...`);const k=await a.loadFileContent(y),M=y.substring(y.lastIndexOf("/")+1),I=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`;r.value.push({id:I,title:M,fullPath:y,fileContent:k,scope:ae()}),o.value=I}catch(k){console.error("Failed to load file:",k)}finally{l.setLoading(!1)}}async function d(y){const m=y.target,k=m.files?.[0];if(!k)return;const M=await k.arrayBuffer(),I=new Uint8Array(M),U=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,Q=`local/${k.name}`;r.value.push({id:U,title:k.name,fullPath:Q,fileContent:I,scope:ae()}),o.value=U,m.value=""}function h(y){const m=r.value.findIndex(k=>k.id===y);m!==-1&&(r.value[m].scope.stop(),r.value.splice(m,1),o.value===y&&(o.value=r.value[Math.min(m,r.value.length-1)]?.id??null))}function p(){if(!u.value)return;const y=new Blob([u.value.fileContent.buffer],{type:"application/octet-stream"});Ae.saveAs(y,u.value.title)}function v(y){y.preventDefault(),s.value=!0}function f(){s.value=!1}async function g(y){y.preventDefault(),s.value=!1;const m=y.dataTransfer?.files[0];if(!m)return;const k=await m.arrayBuffer(),M=new Uint8Array(k),I=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,U=`local/${m.name}`;r.value.push({id:I,title:m.name,fullPath:U,fileContent:M,scope:ae()}),o.value=I}function C(){document.getElementById("file-upload")?.click()}async function x(y){const m=y.detail;if(m?.length)for(const k of Array.from(m)){const M=await k.arrayBuffer(),I=new Uint8Array(M),U=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,Q=`local/${k.name}`;r.value.push({id:U,title:k.name,fullPath:Q,fileContent:I,scope:ae()}),o.value=U}}return Re(()=>{window.addEventListener("open-local-file",C),window.addEventListener("open-local-files",x)}),Ne(()=>{window.removeEventListener("open-local-file",C),window.removeEventListener("open-local-files",x),r.value.forEach(y=>y.scope.stop())}),(y,m)=>(b(),w("div",{class:"flex h-full flex-col",onDragover:v,onDragleave:f,onDrop:g},[c("input",{id:"file-upload",type:"file",accept:".datc64,.dat",class:"hidden",onChange:d},null,32),r.value.length?(b(),w("div",Ua,[c("div",Va,[(b(!0),w(O,null,H(r.value,k=>(b(),w("button",{key:k.id,class:A(["group flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm transition-colors",o.value===k.id?"bg-dark-700 text-dark-100":"text-dark-400 hover:bg-dark-700/50 hover:text-dark-200"]),onClick:M=>o.value=k.id},[D(q(jt),{class:"h-4 w-4 shrink-0"}),c("span",qa,E(k.title),1),c("button",{class:"ml-1 rounded p-0.5 opacity-0 transition-opacity hover:bg-dark-600 group-hover:opacity-100",onClick:dt(M=>h(k.id),["stop"])},[D(q(Ut),{class:"h-3 w-3"})],8,ja)],10,Ba))),128))]),c("div",Ga,[c("button",{class:"btn-icon btn-ghost p-1.5",title:"Export",onClick:p},[D(q(Bt),{class:"h-4 w-4"})]),c("button",{class:"btn-icon btn-ghost p-1.5",title:n.value?"Restore":"Maximize",onClick:m[0]||(m[0]=k=>n.value=!n.value)},[n.value?(b(),We(q(Jt),{key:0,class:"h-4 w-4"})):(b(),We(q(Gt),{key:1,class:"h-4 w-4"}))],8,Ja)])])):L("",!0),c("div",Ya,[r.value.length?(b(!0),w(O,{key:1},H(r.value,k=>G((b(),w("div",{key:k.id,class:"absolute inset-0 flex flex-col bg-dark-900"},[D(St,{"ka-state":k.state,"onUpdate:kaState":M=>k.state=M,args:{fileContent:k.fileContent,fullPath:k.fullPath},"ka-scope":k.scope},null,8,["ka-state","onUpdate:kaState","args","ka-scope"])])),[[_t,o.value===k.id]])),128)):(b(),w("div",Ka,[c("div",Xa,[D(q(Yt),{class:"h-16 w-16 text-dark-600"})]),m[3]||(m[3]=c("h2",{class:"text-xl font-semibold text-dark-200"},"No files open",-1)),m[4]||(m[4]=c("p",{class:"mt-2 text-dark-500"},"Open a .datc64 file to start exploring",-1)),c("div",Qa,[c("label",Za,[D(q(Be),{class:"h-4 w-4"}),m[1]||(m[1]=c("span",null,"Open File",-1)),c("input",{type:"file",accept:".datc64,.dat",class:"hidden",onChange:d},null,32)]),c("button",eo,[D(q(qt),{class:"h-4 w-4"}),m[2]||(m[2]=c("span",null,"Browse Index",-1))])]),m[5]||(m[5]=c("p",{class:"mt-6 text-sm text-dark-500"},"or drag and drop a file here",-1))])),s.value?(b(),w("div",to,[c("div",no,[D(q(Be),{class:"mx-auto h-12 w-12 text-primary-400"}),m[6]||(m[6]=c("p",{class:"mt-4 text-lg font-medium text-dark-100"},"Drop file to open",-1)),m[7]||(m[7]=c("p",{class:"mt-1 text-sm text-dark-400"},"Supports .datc64 and .dat files",-1))])])):L("",!0)])],32))}});export{uo as default};
