import{c as S,g as A,s as vt,D as G,d as ee,i as I,h as m,o as y,j as f,n as O,k as _,p as U,v as Ce,t as E,H as F,L as ne,F as L,l as H,z as D,M as pt,C as ge,N as Le,O as yt,P as Me,r as q,G as Qe,E as mt,e as T,b as oe,w as Ee,Q as gt,u as P,a as Oe,A as bt,S as wt,q as kt}from"./index-_Pbl4r-9.js";import{h as be,g as xt,r as Ze,i as et,c as tt,j as $e,k as St,v as Ct,s as $t,l as nt,m as rt,e as _t,_ as re,n as Lt,o as Ae,t as Ne,p as Mt,C as Et,R as Ot,u as At,U as Te,X as Nt}from"./headers-DcurmUiY.js";import{D as Tt}from"./download-G4s1RwVE.js";import{c as _e}from"./createLucideIcon-DvCTLidc.js";import{a as Rt,F as Dt}from"./folder-open-CBsnKEEs.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=_e("Maximize2Icon",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=_e("Minimize2Icon",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=_e("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);var we={exports:{}},zt=we.exports,Re;function Pt(){return Re||(Re=1,(function(e,t){(function(l,a){a()})(zt,function(){function l(s,d){return typeof d>"u"?d={autoBom:!1}:typeof d!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}function a(s,d,c){var h=new XMLHttpRequest;h.open("GET",s),h.responseType="blob",h.onload=function(){u(h.response,d,c)},h.onerror=function(){console.error("could not download file")},h.send()}function n(s){var d=new XMLHttpRequest;d.open("HEAD",s,!1);try{d.send()}catch{}return 200<=d.status&&299>=d.status}function o(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(d)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof be=="object"&&be.global===be?be:void 0,i=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(s,d,c){var h=r.URL||r.webkitURL,p=document.createElement("a");d=d||s.name||"download",p.download=d,p.rel="noopener",typeof s=="string"?(p.href=s,p.origin===location.origin?o(p):n(p.href)?a(s,d,c):o(p,p.target="_blank")):(p.href=h.createObjectURL(s),setTimeout(function(){h.revokeObjectURL(p.href)},4e4),setTimeout(function(){o(p)},0))}:"msSaveOrOpenBlob"in navigator?function(s,d,c){if(d=d||s.name||"download",typeof s!="string")navigator.msSaveOrOpenBlob(l(s,c),d);else if(n(s))a(s,d,c);else{var h=document.createElement("a");h.href=s,h.target="_blank",setTimeout(function(){o(h)})}}:function(s,d,c,h){if(h=h||open("","_blank"),h&&(h.document.title=h.document.body.innerText="downloading..."),typeof s=="string")return a(s,d,c);var p=s.type==="application/octet-stream",v=/constructor/i.test(r.HTMLElement)||r.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||p&&v||i)&&typeof FileReader<"u"){var w=new FileReader;w.onloadend=function(){var b=w.result;b=g?b:b.replace(/^data:[^;]*;/,"data:attachment/file;"),h?h.location.href=b:location=b,h=null},w.readAsDataURL(s)}else{var C=r.URL||r.webkitURL,k=C.createObjectURL(s);h?h.location=k:location.href=k,h=null,setTimeout(function(){C.revokeObjectURL(k)},4e4)}});r.saveAs=u.saveAs=u,e.exports=u})})(we)),we.exports}var Wt=Pt();const at=xt(Wt),De=new Map;function Ut(e,t,l){const a=De.get(e)?.deref();if(a)return a;const n=A(null);return Vt(e,t,l).then(o=>{o&&(n.value=o)}).catch(()=>{}),De.set(e,new WeakRef(n)),n}async function Vt(e,t,l){const a=await t.loadFileContent(e),n=Ze(e,a.buffer),o=await tt(n),r=await l.findByName(lt(e)),i=_t(r,o,n);if(i)return{headers:i.headers,datFile:n}}function Bt(e,t,l,a,n){const o=Ze(e,t.buffer),r={headers:A(o.rowLength?[{name:null,offset:0,length:o.rowLength,type:et()}]:[]),datFile:o,name:lt(e),path:e,columnStats:A([]),columnSelection:A(new Array(o.rowLength).fill(!1)),editHeader:A(null),selectedRow:A(null),rowSorting:A(null),scrollPos:vt({x:0,y:0}),referencedTables:n.run(()=>S(()=>{const i=new Map;i.set(r.name,A({headers:r.headers.value,datFile:r.datFile}));for(const u of r.headers.value){if(!u.type.key?.table||i.has(u.type.key.table))continue;const s=r.path.replace(`/${r.name}.`,`/${u.type.key.table}.`);i.set(u.type.key.table,Ut(s,l,a))}return i}))};return tt(r.datFile).then(async i=>{r.columnStats.value=i,await ot(r,a)}),r}async function ot(e,t){e.editHeader.value=null,e.headers.value=e.datFile.rowLength?[{name:null,offset:0,length:e.datFile.rowLength,type:et()}]:[];const l=await t.findByName(e.name);try{qt(l,e)}catch(a){window.alert(`WARN: ${a.message}`)}finally{G(e.headers)}}function qt(e,t){let l=0;for(const a of e){const n=a.length||St(a,t.datFile);if(a.name==null){l+=n;continue}const o={...a,length:n,offset:l};if(!(a.length?t.datFile.rowLength-o.offset>=o.length:Ct(o,t.columnStats.value)))throw new Error("The schema is invalid.");$t(o,t.columnSelection.value);const i=nt(t.columnSelection.value,t.headers.value);Object.assign(i,o),rt(t.columnSelection.value),l+=n}}function jt(e,t){const l=e.filter(({type:a})=>a.boolean||a.decimal||a.integer||a.key||a.string).map((a,n)=>({name:a.name||`Unknown${n+1}`,data:$e(a,t)}));return l.unshift({name:"_rid",data:Array(t.rowCount).fill(void 0).map((a,n)=>n)}),Array(t.rowCount).fill(void 0).map((a,n)=>Object.fromEntries(l.map(o=>[o.name,o.data[n]])))}function lt(e){return e.match(/[^/]+(?=\..+$)/)[0]}async function ke(e,t){await t.saveHeaders(e.name,e.headers.value)}async function Gt(e,t){await t.removeHeaders(e.name)}const Jt=ee({setup(){const e=I("bundle-index"),t=I("dat-schemas"),l=A(localStorage.getItem("POE_PATCH_VER")||""),a=A();l.value&&!e.isLoaded&&o(),t.isLoaded||t.fetchSchema(),r();async function n(i){const u=i.target.files[0],s=new Uint8Array(await u.arrayBuffer()),d=u.name;it({id:`file@${d}`,title:d,type:ft,args:{fileContent:s,fullPath:d}})}async function o(){try{await e.loader.setPatch(l.value),await e.loadIndex(),localStorage.setItem("POE_PATCH_VER",l.value)}catch(i){throw window.alert(i.message),i}}async function r(){const u=await(await fetch("https://poe-versions.obsoleet.org")).json();a.value=u}return{index:e,poePatch:l,latestPoEPatch:a,isCdnImportRunning:S(()=>e.loader.progress.value!=null),isFetchingSchema:S(()=>t.isLoading),handleFile:n,cdnImport:o}}}),Yt="_input_16vaf_2",Kt="_label_16vaf_20",Xt="_importVariant_16vaf_26",Qt={input:Yt,label:Kt,importVariant:Xt},Zt={class:"p-4 overflow-auto border-l flex-1 text-base"},en={class:"flex gap-x-4 items-baseline mt-4"},tn={class:"inline-flex items-baseline pb-2"},nn={style:{width:"200px"},class:"my-1"},rn={style:{width:"100px"},class:"m-1"},an={style:{width:"220px"},class:"my-1"},on=["disabled","loading"],ln={key:0},sn={class:"px-1 border border-gray-300 rounded"},un={class:"px-1 border border-gray-300 rounded"},dn={key:0,class:"text-red-600"},cn={class:"flex gap-x-4 items-baseline mt-4 border-b pb-3"},fn={class:"flex items-baseline"},hn={class:"mt-3 flex gap-x-2 items-center"},vn={key:0,class:"codicon codicon-loading animate-spin"},pn={key:1,class:"codicon codicon-check"},yn={key:0},mn={key:1};function gn(e,t,l,a,n,o){return y(),m("div",Zt,[f("div",en,[f("div",{class:O(e.$style.importVariant)},"1",2),f("div",null,[t[7]||(t[7]=f("div",{class:"max-w-xl mb-4 font-semibold"},"Useful when a new league is released. While the update is still downloading, you can review files and fix schema directly from the update servers.",-1)),f("div",tn,[f("div",nn,[f("input",{value:"patch(-poe2).poecdn.com/",readonly:"",class:O(e.$style.input)},null,2),f("label",{class:O(e.$style.label)},"Patch CDN",2)]),f("div",rn,[U(f("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>e.poePatch=r),placeholder:"x.x.x.x.x",class:O(e.$style.input)},null,2),[[Ce,e.poePatch,void 0,{trim:!0}]]),f("label",{class:O(e.$style.label)},"Patch #",2)]),f("div",an,[f("input",{value:"/Bundles2/_.index.bin",readonly:"",class:O(e.$style.input)},null,2),f("label",{class:O(e.$style.label)},"Index",2)]),f("button",{class:"ml-1 py-1 px-3 bg-blue-600 text-white hover:bg-blue-800",onClick:t[1]||(t[1]=(...r)=>e.cdnImport&&e.cdnImport(...r)),disabled:e.isCdnImportRunning,loading:e.isCdnImportRunning},E(e.isCdnImportRunning?"Wait...":"Import"),9,on)]),e.latestPoEPatch?(y(),m("div",ln,[f("p",null,[t[3]||(t[3]=F(" Latest PoE patch is ",-1)),f("code",sn,E(e.latestPoEPatch.poe),1),t[4]||(t[4]=F(", and version ",-1)),f("code",un,E(e.latestPoEPatch.poe2),1),t[5]||(t[5]=F(" for PoE2. ",-1))]),e.index.isLoaded&&e.index.loader.patchVersion!==e.latestPoEPatch.poe&&e.index.loader.patchVersion!==e.latestPoEPatch.poe2?(y(),m("p",dn,[...t[6]||(t[6]=[F(" You can continue to work with cached files.",-1),f("br",null,null,-1),F("But don't delay updating the patch version, otherwise you may experience download errors. ",-1)])])):_("",!0)])):_("",!0)])]),f("div",cn,[f("div",{class:O(e.$style.importVariant)},"2",2),f("div",fn,[t[8]||(t[8]=f("span",{class:"pr-2"},"or just",-1)),t[9]||(t[9]=f("label",{class:"bg-gray-100 py-1 px-2 cursor-pointer hover:bg-gray-300",style:{width:"200px"},for:"import-local-file"},"Pick a local dat file",-1)),f("input",{class:"hidden",id:"import-local-file",type:"file",accept:".datc64",onInput:t[2]||(t[2]=(...r)=>e.handleFile&&e.handleFile(...r))},null,32)])]),f("div",hn,[e.isFetchingSchema?(y(),m("i",vn)):(y(),m("i",pn)),f("div",null,[e.isFetchingSchema?(y(),m("span",yn," Downloading schema from ")):(y(),m("span",mn," Downloaded schema from ")),t[10]||(t[10]=f("a",{href:"https://github.com/poe-tool-dev/dat-schema",class:"underline",target:"_blank"},"github.com/poe-tool-dev/dat-schema",-1))])])])}const bn={$style:Qt},wn=re(Jt,[["render",gn],["__cssModules",bn]]),kn=A("poe-dat-viewer@import");function xn(e){kn.value=e}const Se=A([{id:"poe-dat-viewer@import",title:"Import",type:wn,args:void 0,kaScope:ne(!0),kaState:void 0}]);function it(e){Se.value.find(l=>l.id===e.id)||Se.value.push({id:e.id,title:e.title,type:e.type,args:e.args,kaScope:ne(!0),kaState:void 0}),xn(e.id),G(Se)}const Sn=ee({props:{args:{type:Object,required:!0}},setup(e){return{text:S(()=>{const{name:t,headers:l}=e.args;let a="";for(const n of l){if(n.name==null)break;let o="";if(n.type.boolean?o="bool":n.type.string?o="string":n.type.integer?.size===1?o=n.type.integer.unsigned?"u8":"i8":n.type.integer?.size===2?o=n.type.integer.unsigned?"u16":"i16":n.type.integer?.size===4?o=n.type.integer.unsigned?"u32":"i32":n.type.integer?.size===8?o=n.type.integer.unsigned?"u64":"i64":n.type.decimal?.size===4?o="f32":n.type.decimal?.size===8?o="f64":n.type.key&&(o=n.type.key.foreign?n.type.key.table??"rid":t),n.type.array)a+=`  ${n.name||"_"}: [${o||"_"}]
`;else if(o)a+=`  ${n.name||"_"}: ${o}
`;else break}return`type ${t} {
${a}}
`})}}}),Cn={class:"p-4 overflow-auto border-l flex-1 text-base"};function $n(e,t,l,a,n,o){return y(),m("div",Cn,[f("pre",null,E(e.text),1)])}const _n=re(Sn,[["render",$n]]),Ln=ee({name:"ViewerActions",setup(){const e=I("viewer"),t=I("dat-schemas"),l=S(()=>Lt(e.columnSelection.value).map(i=>i.map(u=>String(u)).join(" ")));function a(){const{editHeader:i,columnSelection:u,headers:s}=e;i.value=nt(u.value,s.value),rt(u.value),G(s),G(u),ke(e,t)}function n(){const i=jt(e.headers.value,e.datFile);at.saveAs(new File([JSON.stringify(i,null,2)],`${e.name}.json`,{type:"application/json;charset=utf-8"}))}function o(){it({id:"poe-dat-viewer@show-schema",title:"Schema",type:_n,args:{name:e.name,headers:JSON.parse(JSON.stringify(e.headers.value))}})}async function r(){await Gt(e,t),await ot(e,t)}return{rowSorting:e.rowSorting,selections:l,defineColumn:a,exportDataJson:n,showSchema:o,restoreSchema:r}}}),Mn="_bar_1e38q_2",En={bar:Mn},On={class:"flex"},An={key:0,class:"self-center px-1.5 italic text-dark-500"},Nn=["textContent"],Tn={class:"flex gap-x-1"};function Rn(e,t,l,a,n,o){return y(),m("div",{class:O(e.$style.bar)},[f("div",On,[e.selections.length===0?(y(),m("div",An,"No bytes selected")):e.selections.length===1?(y(),m("button",{key:1,class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[0]||(t[0]=(...r)=>e.defineColumn&&e.defineColumn(...r))},[...t[5]||(t[5]=[f("i",{class:"codicon codicon-add"},null,-1),F(" Define column ",-1)])])):e.selections.length>1?(y(),m(L,{key:2},[t[6]||(t[6]=f("div",{class:"mr-1 self-center px-1.5 text-dark-400"},"Selections",-1)),(y(!0),m(L,null,H(e.selections,r=>(y(),m("div",{class:"mr-1 flex items-center rounded bg-dark-700 px-1.5 font-mono text-dark-200",textContent:E(r)},null,8,Nn))),256))],64)):_("",!0)]),f("div",Tn,[e.rowSorting?(y(),m("button",{key:0,class:"rounded border border-dark-500 bg-dark-600 px-1.5 hover:bg-dark-500",onClick:t[1]||(t[1]=r=>e.rowSorting=null)}," Clear sorting ")):_("",!0),f("button",{class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[2]||(t[2]=(...r)=>e.restoreSchema&&e.restoreSchema(...r))},[...t[7]||(t[7]=[f("i",{class:"codicon codicon-discard"},null,-1),F(" Restore schema ",-1)])]),f("button",{class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[3]||(t[3]=(...r)=>e.showSchema&&e.showSchema(...r))},[...t[8]||(t[8]=[f("i",{class:"codicon codicon-json"},null,-1),F(" Show schema ",-1)])]),f("button",{class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[4]||(t[4]=(...r)=>e.exportDataJson&&e.exportDataJson(...r))},[...t[9]||(t[9]=[f("i",{class:"codicon codicon-database"},null,-1),F(" Export data ",-1)])])])],2)}const Dn={$style:En},Fn=re(Ln,[["render",Rn],["__cssModules",Dn]]);function Hn(e,t,l){const a=$e(e,l),n=Array.from({length:l.rowCount},(o,r)=>r);return e.type.array?n.sort((o,r)=>{const i=a[o];return(a[r].length-i.length)*t}):e.type.boolean?n.sort((o,r)=>{const i=Number(a[o]),u=Number(a[r]);return(i-u)*t}):e.type.string?n.sort((o,r)=>{const i=a[o],u=a[r];return i.localeCompare(u)*t}):e.type.integer||e.type.decimal?n.sort((o,r)=>{const i=a[o];return(a[r]-i)*t}):e.type.key&&(e.type.key.foreign?n.sort((o,r)=>{const i=a[o];return((a[r]||0)-(i||0))*t}):n.sort((o,r)=>{const i=Number(a[o]);return(Number(a[r])-i)*t})),n}function In(e,t){t.text=String(e),t.color="#098658"}function zn(e,t){t.text=e.toLocaleString(void 0,{maximumFractionDigits:6,minimumFractionDigits:1}),t.color="#098658"}function Pn(e,t){t.text=`[${e.join(", ")}]`,t.color="#098658"}function Wn(e,t){t.text=`[${e.map(l=>l.toLocaleString(void 0,{maximumFractionDigits:6,minimumFractionDigits:1})).join(", ")}]`,t.color="#098658"}function Un(e,t){t.text=String(e),t.color="#0000ff"}function Vn(e,t){t.text=`[${e.join(", ")}]`,t.color="#0000ff"}function Bn(e,t){e===""?(t.text="empty",t.color="#0000ff"):(t.text=String(e),t.color="#001080")}function qn(e,t){t.text=`[${e.map(l=>JSON.stringify(l)).join(", ")}]`,t.color="#001080"}function Fe(e,t){e===null?(t.text="<null, self>",t.color="#0000ff"):(t.text=`<${e}, self>`,t.color="#098658")}function jn(e,t){t.text=`[${e.map(l=>`<${l}, self>`).join(", ")}]`,t.color="#098658"}function He(e,t){e===null?(t.text="<null>",t.color="#0000ff"):(t.text=`<${e}>`,t.color="#098658")}function Gn(e,t){t.text=`[${e.map(l=>`<${l}>`).join(", ")}]`,t.color="#098658"}function Ie(e,t,l,a,n){const o=Ae(t,l);if(n?.header.type.array)throw new Error("Can't show array of arrays.");const r=n&&Ae(n.header,n.datFile),i={text:"",color:""},u=(()=>{const c=n!=null?n.header.type:t.type;if(t.type.array){if(c.boolean)return Vn;if(c.string)return qn;if(c.integer)return Pn;if(c.decimal)return Wn;if(c.key?.foreign)return Gn;if(c.key)return jn}else{if(c.boolean)return Un;if(c.string)return Bn;if(c.integer)return In;if(c.decimal)return zn;if(c.key?.foreign)return He;if(c.key)return Fe}throw new Error("never")})();let s=0,d="";for(const c of a){let h=o(c);n?t.type.array?(h=h.map(p=>r(p)),u(h,i)):h===null?(t.type.key.foreign?He:Fe)(h,i):(h=r(h),u(h,i)):u(h,i),d!==i.color&&(e.fillStyle=i.color,d=i.color),e.fillText(i.text,0,s),s+=R}}function Jn(e,t,l,a,n,o){e.fillStyle="#000";let r=0;for(const i of a){const u=l.dataFixed.subarray(i*l.rowLength+t.offset+n,i*l.rowLength+t.offset+o),s=Array.from(u,d=>d.toString(16).padStart(2,"0")).join(" ");e.fillText(s,n*(z*3),r),r+=R}}function Yn(e,t,l,a,n){e.fillStyle="#000";const o=n.refArray,r=Math.max(o.keyForeign?l.fieldSize.KEY_FOREIGN:0,o.keySelf?l.fieldSize.KEY:0,o.string?l.fieldSize.STRING:0,o.numeric32?l.fieldSize.LONG:0,l.fieldSize.BYTE),i=Math.ceil(t.textLength/3);let u=0;for(const s of a){const d=l.readerFixed.getUint32(s*l.rowLength+t.offset,!0);if(d===0)e.fillText("[]",0,u);else{const c=l.readerFixed.getUint32(s*l.rowLength+t.offset+l.memsize,!0),h=l.dataVariable.subarray(c,c+Math.min(r*d,i)),p=Array.from(h,v=>v.toString(16).padStart(2,"0")).join(" ");e.fillText(`${d} { ${p} }`,0,u)}u+=R}}const X={background:"#0f172a",text:"#e2e8f0",border:"#334155",selection:"rgba(14, 165, 233, 0.2)",shadow:"rgba(0, 0, 0, 0.3)"},Q='"JetBrains Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',j=14,z=tr(j,Q),Kn=nr(j,Q),R=19,Xn=3,Z=1,Qn=7,me=Math.round(z*3),te=me*2+Qn*3;function Zn(e){const t=String(e-1).length;return Math.max(t,Xn)}function st(e){return Math.ceil(Zn(e)*z)}function er(e){return st(e)+16}function tr(e,t){const a=document.createElement("canvas").getContext("2d");return a.font=`${e}px ${t}`,a.measureText("0").width}function nr(e,t){const a=document.createElement("canvas").getContext("2d");a.font=`${e}px ${t}`,a.textBaseline="middle";const n=a.measureText("0");return e/2+(n.alphabeticBaseline!==void 0?-n.alphabeticBaseline:n.actualBoundingBoxDescent)}function rr(e){return 1+(e-j)/2+Kn}function ar(e){const{ctx:t}=e;if(t.fillStyle=X.background,t.fillRect(0,0,t.canvas.width,t.canvas.height),e.viewer.selectedRow.value!==null){const a=e.rows.indexOf(e.viewer.selectedRow.value);a!==-1&&(t.fillStyle=X.selection,t.fillRect(0,e.top+a*R,t.canvas.width,R))}t.save(),t.translate(-e.left,0),or(t,e.columns),t.restore(),t.font=`${j}px ${Q}`,t.fillStyle=X.text;const l=lr(e.viewer,e.left,e.left+e.paintWidth);for(const a of l)t.save(),t.beginPath(),t.translate(a.left-e.left,0),t.rect(0,0,a.width,t.canvas.height),t.clip(),t.translate(z/2,e.top+rr(R)),a.exec(t,e.rows),t.restore();{const a=t.createLinearGradient(0,-16,0,4);a.addColorStop(0,X.shadow),a.addColorStop(1,"transparent"),t.fillStyle=a,t.fillRect(0,0,t.canvas.width,6);const n=t.createLinearGradient(-16,0,4,0);n.addColorStop(0,X.shadow),n.addColorStop(1,"transparent"),t.fillStyle=n,t.fillRect(0,0,6,t.canvas.height)}}function or(e,t){for(const l of t)l.selected&&(e.fillStyle=X.selection,e.fillRect(l.leftPx+(l.border?Z:0),0,l.widthPx,e.canvas.height)),l.border&&(e.fillStyle=X.border,e.fillRect(l.leftPx,0,Z,e.canvas.height))}function lr(e,t,l){const a=e.headers.value,n=e.columnStats.value,o=e.datFile,r=[];let i=0;for(const u of a){const s=xe(u);if(i+s.borderWidth>=t)if(u.type.byteView)if(u.type.byteView.array)r.push({left:i+(s.borderWidth?Z:0),width:s.paddingWidth,exec:(d,c)=>{Yn(d,u,o,c,n[u.offset])}});else{const d=Math.max(0,Math.floor((t-i)/(z*3))),c=Math.min(u.length,Math.ceil((l-i)/(z*3)));r.push({left:i+(s.borderWidth?Z:0),width:s.paddingWidth,exec:(h,p)=>{Jn(h,u,o,p,d,c)}})}else r.push({left:i+(s.borderWidth?Z:0),width:s.paddingWidth,exec:(d,c)=>{if(u.type.key?.table&&u.type.key.viewColumn){const h=e.referencedTables.value.get(u.type.key.table).value;if(h){const p=h.headers.find(v=>v.name===u.type.key.viewColumn);if(p){Ie(d,u,o,c,{header:p,datFile:h.datFile});return}}}Ie(d,u,o,c)}});if(i+=s.borderWidth,i>=l)return r}return r}function xe(e){const t=e.type.byteView&&!e.type.byteView.array?e.length*3-1:e.textLength;return{paddingWidth:Math.ceil((t+1)*z),borderWidth:Math.ceil((t+1)*z)+(e.offset>0?Z:0),hasBorder:e.offset>0}}function ir(e){let t=0;for(const l of e){const a=xe(l);t+=a.borderWidth}return t}function ut(e,t,l,a){const n=[];let o=0;for(const r of e){const i=xe(r);if(o+i.borderWidth>=l&&n.push({offset:r.offset,border:i.hasBorder,active:r===t,widthPx:i.borderWidth,leftPx:o,name:r.name}),o+=i.borderWidth,o>=a)return n}return n}const sr=ee({props:{left:{type:Number,required:!0},width:{type:Number,required:!0},columns:{type:Array,required:!0}},setup(e){const t=A(0);let l=-1,a=[];const n=I("viewer"),o=I("dat-schemas");function r(c){l=c,a=[...n.columnSelection.value],Ne(n.columnSelection.value,l,l,n.headers.value),G(n.columnSelection),document.addEventListener("mouseup",h),document.addEventListener("mouseleave",h);function h(){l=-1,document.removeEventListener("mouseup",h),document.removeEventListener("mouseleave",h)}}function i(c,h){if(l===-1||h.buttons!==1)return;const{memsize:p}=n.datFile,v=c-l;v>=p?c=l+p*2-1:v>=4?c=l+8-1:v>=2&&(c=l+4-1),v<=-p?c=l-p*2+1:v<=-4?c=l-8+1:v<=-2&&(c=l-4+1),n.columnSelection.value=[...a],Ne(n.columnSelection.value,l,c,n.headers.value)}function u(c){const h=n.headers.value.find(p=>p.offset===c);n.editHeader.value===h&&(!h.type.byteView||h.type.byteView.array)?(t.value===0?t.value=1:t.value===1?t.value=-1:t.value===-1&&(t.value=1),n.rowSorting.value=Hn(h,t.value,n.datFile)):(n.editHeader.value=h,t.value=0)}function s(c,h){h.preventDefault();const p=n.headers.value.find(v=>v.offset===c);p.textLength!=null&&(p.textLength=Math.max(1,p.textLength-Math.sign(h.deltaY)*(h.ctrlKey?10:1)),G(n.headers),ke(n,o))}return{headers:S(()=>ut(n.headers.value,n.editHeader.value,e.left,e.left+e.width)),selectStart:r,selectContinue:i,editHeader:u,handleHeaderWheel:s,headersRowStyle:S(()=>({transform:`translate(${-e.left}px, 0)`,lineHeight:me+"px",fontFamily:Q,fontSize:j+"px"})),colsRowStyle:S(()=>({transform:`translate(${-e.left}px, ${me}px)`,lineHeight:me+"px",fontFamily:Q,fontSize:j+"px"})),statsRowStyle:S(()=>({transform:`translate(${-e.left}px, ${me*2}px)`,fontFamily:Q,fontSize:j+"px"}))}}}),ur={class:"datv-header-layer"},dr=["title","onClick","onWheel"],cr={key:1,class:"bg-gray-500 text-gray-200 px-1"},fr=["onMousedown","onMouseenter","title","textContent"],hr={key:0,class:"datv-stat__line bg-yellow-500",style:{top:"0"}},vr={key:1,class:"datv-stat__line bg-green-500",style:{top:"7px"}},pr={key:2,class:"datv-stat__line bg-gray-800",style:{top:"14px"}},yr={key:3,class:"datv-stat__line bg-pink-400",style:{top:"14px"}},mr=["textContent"],gr={key:1,class:"inline-flex mx-auto items-center h-full"};function br(e,t,l,a,n,o){return y(),m("div",ur,[f("div",{style:D(e.headersRowStyle),class:"absolute"},[(y(!0),m(L,null,H(e.headers,r=>(y(),m("button",{key:r.offset,class:O(["datv-header",{"datv-col--border":r.border,"datv-header--active":r.active}]),style:D({width:r.widthPx+"px",transform:`translate(${r.leftPx}px, 0)`}),title:r.name==null?"unidentified":r.name||"unnamed",onClick:i=>e.editHeader(r.offset),onWheel:i=>e.handleHeaderWheel(r.offset,i)},[r.name===null?(y(),m(L,{key:0},[F("Â ")],64)):r.name===""?(y(),m("span",cr,"?")):(y(),m(L,{key:2},[F(E(r.name),1)],64))],46,dr))),128))],4),f("div",{style:D(e.colsRowStyle),class:"absolute"},[(y(!0),m(L,null,H(e.columns,r=>(y(),m("button",{key:r.offset,class:O(["datv-byte",{"datv-col--border":r.border,"datv-byte--selected":r.selected}]),style:D({width:r.widthPx+"px",transform:`translate(${r.leftPx}px, 0)`}),onMousedown:i=>e.selectStart(r.offset),onMouseenter:i=>e.selectContinue(r.offset,i),title:String(r.offset),textContent:E(r.text)},null,46,fr))),128))],4),f("div",{style:D(e.statsRowStyle),class:"absolute datv-stats_row"},[(y(!0),m(L,null,H(e.columns,r=>(y(),m("div",{key:r.offset,class:O(["datv-stat",{"datv-col--border":r.border,"datv-byte--selected":r.selected}]),style:D({width:r.widthPx+"px",transform:`translate(${r.leftPx}px, 0)`})},[r.stat?(y(),m(L,{key:0},[r.stat.string?(y(),m("div",hr)):_("",!0),r.stat.array?(y(),m("div",vr)):_("",!0),r.stat.zero?(y(),m("div",pr)):r.stat.nullable?(y(),m("div",yr)):_("",!0),f("div",{class:"datv-stat__max",textContent:E(r.stat.max)},null,8,mr)],64)):r.key?(y(),m("span",gr,[...t[0]||(t[0]=[f("i",{class:"codicon codicon-key"},null,-1)])])):_("",!0)],6))),128))],4)])}const wr=re(sr,[["render",br]]);var K={},le={},W={},ze;function V(){if(ze)return W;ze=1,Object.defineProperty(W,"__esModule",{value:!0}),W.fillTwoDimensionalArray=W.createTwoDimensionalArray=W.isNullOrUndefined=void 0;function e(a){return a==null}W.isNullOrUndefined=e;function t(a,n){for(var o=Array(a),r=0;r<o.length;r++)o[r]=Array(n);return o}W.createTwoDimensionalArray=t;function l(a,n){n===void 0&&(n=0);for(var o=0,r=a;o<r.length;o++)for(var i=r[o],u=0;u<i.length;u++)i[u]=n}return W.fillTwoDimensionalArray=l,W}var Pe;function kr(){if(Pe)return le;Pe=1,Object.defineProperty(le,"__esModule",{value:!0}),le.JaroWinkler=void 0;var e=V(),t=(function(){function l(a){this.DEFAULT_THRESHOLD=.7,this.THREE=3,this.JW_COEF=.1,this.threshold=a||this.DEFAULT_THRESHOLD}return l.prototype.similarity=function(a,n){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(n))throw new Error("s2 must neither be null nor undefined");if(a===n)return 1;var o=this.matches(a,n),r=o[0];if(r===0)return 0;var i=(r/a.length+r/n.length+(r-o[1])/r)/this.THREE,u=i;return i>this.threshold&&(u=i+Math.min(this.JW_COEF,1/o[this.THREE])*o[2]*(1-i)),u},l.prototype.distance=function(a,n){return 1-this.similarity(a,n)},l.prototype.matches=function(a,n){var o,r;a.length>n.length?(o=a,r=n):(o=n,r=a);var i=Math.max(Math.floor(o.length/2)-1,0),u=Array(r.length);u.fill(-1);for(var s=Array(o.length),d=0,c=0;c<r.length;c++)for(var h=r[c],p=Math.max(c-i,0),v=Math.min(c+i+1,o.length);p<v;p++)if(!s[p]&&h===o[p]){u[c]=p,s[p]=!0,d++;break}for(var g=Array(d),w=Array(d),C=0,k=0;C<r.length;C++)u[C]!==-1&&(g[k]=r[C],k++);for(var C=0,k=0;C<o.length;C++)s[C]&&(w[k]=o[C],k++);for(var b=0,c=0;c<g.length;c++)g[c]!==w[c]&&b++;for(var x=0,c=0;c<r.length&&a[c]===n[c];c++)x++;return[d,Math.floor(b/2),x,o.length]},l})();return le.JaroWinkler=t,le}var ie={},We;function dt(){if(We)return ie;We=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.Levenshtein=void 0;var e=V(),t=(function(){function l(){}return l.prototype.distance=function(a,n,o){if(o===void 0&&(o=Number.MAX_VALUE),e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(n))throw new Error("s2 must neither be null nor undefined");if(a===n)return 0;if(a.length===0)return n.length;if(n.length===0)return a.length;for(var r=Array(n.length+1),i=Array(n.length+1),u=[],s=0;s<r.length;s++)r[s]=s;for(var s=0;s<a.length;s++){i[0]=s+1;for(var d=i[0],c=0;c<n.length;c++){var h=1;a[s]===n[c]&&(h=0),i[c+1]=Math.min(i[c]+1,Math.min(r[c+1]+1,r[c]+h)),d=Math.min(d,i[c+1])}if(d>=o)return o;u=r,r=i,i=u}return r[n.length]},l})();return ie.Levenshtein=t,ie}var se={},Ue;function xr(){if(Ue)return se;Ue=1,Object.defineProperty(se,"__esModule",{value:!0}),se.CharacterInsDelInterface=void 0;var e=(function(){function t(l,a){this.deletionCost=l,this.insertionCost=a}return t})();return se.CharacterInsDelInterface=e,se}var ue={},Ve;function Sr(){if(Ve)return ue;Ve=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.CharacterSubstitutionInterface=void 0;var e=(function(){function t(l){this.cost=l}return t})();return ue.CharacterSubstitutionInterface=e,ue}var de={},Be;function Cr(){if(Be)return de;Be=1,Object.defineProperty(de,"__esModule",{value:!0}),de.NormalizedLevenshtein=void 0;var e=dt(),t=V(),l=(function(){function a(){this.l=new e.Levenshtein}return a.prototype.distance=function(n,o){if(t.isNullOrUndefined(n))throw new Error("s1 must neither be null nor undefined");if(t.isNullOrUndefined(o))throw new Error("s2 must neither be null nor undefined");if(n===o)return 0;var r=Math.max(n.length,o.length);return r===0?0:this.l.distance(n,o)/r},a.prototype.similarity=function(n,o){return 1-this.distance(n,o)},a})();return de.NormalizedLevenshtein=l,de}var ce={},qe;function $r(){if(qe)return ce;qe=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.WeightedLevenshtein=void 0;var e=V(),t=(function(){function l(a,n){this.charsub=a,this.charchange=n}return l.prototype.distance=function(a,n,o){if(o===void 0&&(o=Number.MAX_VALUE),e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(n))throw new Error("s2 must neither be null nor undefined");if(a===n)return 0;if(a.length===0)return n.length;if(n.length===0)return a.length;var r=Array(n.length+1),i=Array(n.length+1),u=[];r[0]=0;for(var s=1;s<r.length;s++)r[s]=r[s-1]+this.insertionCost(n[s-1]);for(var s=0;s<a.length;s++){var d=a[s],c=this.deletionCost(d);i[0]=r[0]+c;for(var h=i[0],p=0;p<n.length;p++){var v=n[p],g=0;d!==v&&(g=this.charsub.cost(d,v));var w=this.insertionCost(v);i[p+1]=Math.min(i[p]+w,Math.min(r[p+1]+c,r[p]+g)),h=Math.min(h,i[p+1])}if(h>=o)return o;u=r,r=i,i=u}return r[n.length]},l.prototype.insertionCost=function(a){return this.charchange?this.charchange.insertionCost(a):1},l.prototype.deletionCost=function(a){return this.charchange?this.charchange.deletionCost(a):1},l})();return ce.WeightedLevenshtein=t,ce}var fe={},je;function _r(){if(je)return fe;je=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.Damerau=void 0;var e=V(),t=(function(){function l(){}return l.prototype.distance=function(a,n){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(n))throw new Error("s2 must neither be null nor undefined");if(a===n)return 0;for(var o=a.length+n.length,r=new Map,i=0;i<a.length;i++)r.set(a[i],0);for(var i=0;i<n.length;i++)r.set(n[i],0);for(var u=e.createTwoDimensionalArray(a.length+2,n.length+2),s=0;s<=a.length;s++)u[s+1][0]=o,u[s+1][1]=s;for(var d=0;d<=n.length;d++)u[0][d+1]=o,u[1][d+1]=d;for(var s=1;s<=a.length;s++){for(var c=0,d=1;d<=n.length;d++){var h=r.get(n[d-1]),p=c,v=1;a[s-1]===n[d-1]&&(v=0,c=d),u[s+1][d+1]=this.min(u[s][d]+v,u[s+1][d]+1,u[s][d+1]+1,u[h][p]+(s-h-1)+1+(d-p-1))}r.set(a[s-1],s)}return u[a.length+1][n.length+1]},l.prototype.min=function(a,n,o,r){return this.minWithNaN(a,this.minWithNaN(n,this.minWithNaN(o,r)))},l.prototype.minWithNaN=function(a,n){return isNaN(a)&&isNaN(n)?0:isNaN(a)?n:isNaN(n)?a:Math.min(a,n)},l})();return fe.Damerau=t,fe}var he={},Ge;function Lr(){if(Ge)return he;Ge=1,Object.defineProperty(he,"__esModule",{value:!0}),he.OptimalStringAlignment=void 0;var e=V(),t=(function(){function l(){}return l.prototype.distance=function(a,n){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(n))throw new Error("s2 must neither be null nor undefined");if(a===n)return 0;var o=a.length,r=n.length;if(o==0)return r;if(r==0)return o;for(var i=e.createTwoDimensionalArray(o+2,r+2),u=0;u<=o;u++)i[u][0]=u;for(var s=0;s<=r;s++)i[0][s]=s;for(var d,u=1;u<=o;u++)for(var s=1;s<=r;s++)d=1,a.charAt(u-1)==n.charAt(s-1)&&(d=0),i[u][s]=this.min(i[u-1][s-1]+d,i[u][s-1]+1,i[u-1][s]+1),u>1&&s>1&&a.charAt(u-1)===n.charAt(s-2)&&a.charAt(u-2)===n.charAt(s-1)&&(i[u][s]=Math.min(i[u][s],i[u-2][s-2]+d));return i[o][r]},l.prototype.min=function(a,n,o){return Math.min(a,Math.min(n,o))},l})();return he.OptimalStringAlignment=t,he}var ve={},Je;function ct(){if(Je)return ve;Je=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.LongestCommonSubsequence=void 0;var e=V(),t=(function(){function l(){}return l.prototype.distance=function(a,n){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(n))throw new Error("s2 must neither be null nor undefined");return a===n?0:a.length+n.length-2*this.length(a,n)},l.prototype.length=function(a,n){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(n))throw new Error("s2 must neither be null nor undefined");var o=a.length,r=n.length,i=a,u=n,s=e.createTwoDimensionalArray(o+1,r+1);e.fillTwoDimensionalArray(s);for(var d=1;d<=o;d++)for(var c=1;c<=r;c++)i[d-1]===u[c-1]?s[d][c]=s[d-1][c-1]+1:s[d][c]=Math.max(s[d][c-1],s[d-1][c]);return s[o][r]},l})();return ve.LongestCommonSubsequence=t,ve}var pe={},Ye;function Mr(){if(Ye)return pe;Ye=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.MetricLCS=void 0;var e=ct(),t=V(),l=(function(){function a(){this.lcs=new e.LongestCommonSubsequence}return a.prototype.distance=function(n,o){if(t.isNullOrUndefined(n))throw new Error("s1 must neither be null nor undefined");if(t.isNullOrUndefined(o))throw new Error("s2 must neither be null nor undefined");if(n===o)return 0;var r=Math.max(n.length,o.length);return r==0?0:1-1*this.lcs.length(n,o)/r},a})();return pe.MetricLCS=l,pe}var ye={},Ke;function Er(){if(Ke)return ye;Ke=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.NGram=void 0;var e=V(),t=(function(){function l(a){this.DEFAULT_N=2,this.n=e.isNullOrUndefined(a)?this.DEFAULT_N:a}return l.prototype.distance=function(a,n){if(e.isNullOrUndefined(a))throw new Error("s0 must neither be null nor undefined");if(e.isNullOrUndefined(n))throw new Error("s1 must neither be null nor undefined");if(a===n)return 0;var o=`
`,r=a.length,i=n.length;if(r==0||i==0)return 1;var u=0;if(r<this.n||i<this.n){for(var s=0,d=Math.min(r,i);s<d;s++)a.charAt(s)==n.charAt(s)&&u++;return u/Math.max(r,i)}for(var c=Array(r+this.n-1),h,p,v,g=0;g<c.length;g++)g<this.n-1?c[g]=o:c[g]=a.charAt(g-this.n+1);h=Array(r+1),p=Array(r+1);var w,C,k=Array(this.n);for(w=0;w<=r;w++)h[w]=w;for(C=1;C<=i;C++){if(C<this.n){for(var b=0;b<this.n-C;b++)k[b]=o;for(var b=this.n-C;b<this.n;b++)k[b]=n.charAt(b-(this.n-C))}else k=n.substring(C-this.n,C).split("");for(p[0]=C,w=1;w<=r;w++){u=0;for(var x=this.n,d=0;d<this.n;d++)c[w-1+d]!=k[d]?u++:c[w-1+d]==o&&x--;var M=u/x;p[w]=Math.min(Math.min(p[w-1]+1,h[w]+1),h[w-1]+M)}v=h,h=p,p=v}return h[r]/Math.max(i,r)},l})();return ye.NGram=t,ye}var Xe;function Or(){return Xe||(Xe=1,(function(e){var t=K&&K.__createBinding||(Object.create?(function(a,n,o,r){r===void 0&&(r=o),Object.defineProperty(a,r,{enumerable:!0,get:function(){return n[o]}})}):(function(a,n,o,r){r===void 0&&(r=o),a[r]=n[o]})),l=K&&K.__exportStar||function(a,n){for(var o in a)o!=="default"&&!n.hasOwnProperty(o)&&t(n,a,o)};Object.defineProperty(e,"__esModule",{value:!0}),l(kr(),e),l(dt(),e),l(xr(),e),l(Sr(),e),l(Cr(),e),l($r(),e),l(_r(),e),l(Lr(),e),l(ct(),e),l(Mr(),e),l(Er(),e)})(K)),K}var Ar=Or();function Nr(e,t,l){e=e.toLowerCase();const a=[],n=[],o=[],r=new Ar.MetricLCS;for(const s of l)t>=s.totalRows||s.name.toLowerCase()===e||(a.push(s),n.push(s.totalRows-(t+1)),o.push(r.distance(e,s.name.toLowerCase())));const i=new Array(a.length).fill(0);for(const s of[n,o]){const d=Math.min(...s),c=Math.max(...s);for(let h=0;h<s.length;h+=1){const p=(s[h]-d)/(c-d);p>.33&&(i[h]+=p)}}const u=new Array(a.length).fill(0).map((s,d)=>d);return u.sort((s,d)=>i[s]-i[d]),u.map(s=>a[s])}function Tr(e,t,l){const a=[],{fieldSize:n}=l,o=e.length;return o===n.ARRAY&&t.refArray&&a.push({label:"Array",value:"array"}),o===n.STRING&&t.refString&&a.push({label:"String",value:"string"}),o===n.KEY&&t.keySelf&&a.push({label:"Key (self)",value:"key_self"}),o===n.KEY_FOREIGN&&t.keyForeign&&a.push({label:"Key (foreign)",value:"key_foreign"}),(o===4||o===2)&&a.push({label:"Integer",value:"integer"}),o===4&&a.push({label:"Decimal",value:"decimal"}),o===1&&t.maxValue<=1&&a.push({label:"Boolean",value:"boolean"}),a}function Rr(e,t){const l=[];if(!e.type.array||!t.refArray)return l;const a=t.refArray;return a.string&&l.push({label:"String",value:"string"}),a.keySelf&&l.push({label:"Key (self)",value:"key_self"}),a.keyForeign&&l.push({label:"Key (foreign)",value:"key_foreign"}),a.numeric32&&l.push({label:"Integer - 4 bytes",value:"integer_4"}),a.numeric32&&l.push({label:"Decimal - 4 bytes",value:"decimal_4"}),a.boolean&&l.push({label:"Boolean",value:"boolean"}),l}function Dr(e,t){const l=A([]);return t.findByName(e).then(a=>{l.value=a}).catch(()=>{}),l}const Fr=ee({setup(){const e=I("viewer"),t=I("dat-schemas"),l=S(()=>e.editHeader.value&&pt(e.editHeader.value));{let v=null;ge(l,g=>{v&&(v(),v=null),g&&(v=ge(g,()=>{G(e.headers),ke(e,t)},{deep:!0}))})}const a=S(()=>e.columnStats.value[l.value.offset]),n=S({get(){const v=l.value.type;return v.array?"array":v.string?"string":v.key?v.key.foreign?"key_foreign":"key_self":v.integer?"integer":v.decimal?"decimal":v.boolean?"boolean":void 0},set(v){const g=l.value;g.type={},v==="array"?(g.type.array=!0,g.type.byteView={array:!0}):v==="string"?g.type.string={}:v==="key_foreign"?g.type.key={foreign:!0,table:null,viewColumn:null}:v==="key_self"?g.type.key={foreign:!1,table:e.name,viewColumn:null}:v==="integer"?g.type.integer={unsigned:!1,size:g.length}:v==="decimal"?g.type.decimal={size:g.length}:v==="boolean"&&(g.type.boolean={})}}),o=S({get(){const v=l.value.type;return v.string?"string":v.key?v.key.foreign?"key_foreign":"key_self":v.integer?`integer_${v.integer.size}`:v.decimal?`decimal_${v.decimal.size}`:v.boolean?"boolean":void 0},set(v){const g=l.value;g.type={array:!0},v==="string"?g.type.string={}:v==="key_foreign"?g.type.key={foreign:!0,table:null,viewColumn:null}:v==="key_self"?g.type.key={foreign:!1,table:e.name,viewColumn:null}:v==="integer_1"?g.type.integer={unsigned:!1,size:1}:v==="integer_2"?g.type.integer={unsigned:!1,size:2}:v==="integer_4"?g.type.integer={unsigned:!1,size:4}:v==="integer_8"?g.type.integer={unsigned:!1,size:8}:v==="decimal_4"?g.type.decimal={size:4}:v==="decimal_8"?g.type.decimal={size:8}:v==="boolean"&&(g.type.boolean={})}}),r=S(()=>{const v=[],g=l.value.type;return v.push({label:"Bytes",value:"bytes"}),g.array&&v.push({label:"Var. bytes",value:"array-bytes"}),v.push({label:"Data",value:"data",disabled:!n.value||n.value==="array"&&!o.value}),v}),i=S({get(){const v=l.value.type;return v.byteView?v.byteView.array?"array-bytes":"bytes":"data"},set(v){const g=l.value.type;v==="data"?g.byteView=void 0:g.byteView={array:v==="array-bytes"}}}),u=S(()=>{const v=$e(l.value,e.datFile);return Math.max(...l.value.type.array?v.flat():v)}),s=S(()=>{let v;if(!l.value.type.key.foreign)return v=[{value:e.name,label:e.name}],v;if(v=[{value:null,label:"rid (unknown)"}],t.tableStats.length){const g=Nr(e.name,u.value,t.tableStats);v.push(...g.map(w=>({value:w.name,label:w.name})))}else l.value.type.key.table!==null&&v.push({value:l.value.type.key.table,label:l.value.type.key.table});return v}),d=S(()=>l.value.type.key?.table?Dr(l.value.type.key.table,t):null),c=S(()=>{if(!l.value.type.key)return[];const v=[{value:null,label:"row index"}],g=l.value.type.key.foreign?d.value?.value??[]:e.headers.value;return v.push(...g.filter(w=>w.name!==null&&w.name.length&&!w.type.array).map(w=>({label:w.name,value:w.name}))),v});function h(){e.editHeader.value=null}function p(){Mt(l.value,e.headers.value),e.editHeader.value=null,G(e.headers),ke(e,t)}return{isVisible:S(()=>e.editHeader.value!=null),HEADERS_HEIGHT:te,header:l,byteViewMode:i,dataType:n,arrayType:o,close:h,remove:p,viewModeOpts:r,keyTableOpts:s,keyDisplayColumnOpts:c,tablesPreloadNeeded:()=>l.value.type.key!=null?l.value.type.key.foreign&&!t.tableStats.length:!1,dataTypeOpts:S(()=>Tr(l.value,a.value,e.datFile)),arrayTypeOpts:S(()=>Rr(l.value,a.value))}}}),Hr={key:0,style:{width:"300px"},class:"relative overflow-hidden"},Ir={class:"m-2 shadow border border-gray-300 bg-white absolute inset-0 flex flex-col"},zr={class:"p-2 bg-gray-100 text-gray-600 shadow flex items-center"},Pr={key:0,class:"p-4"},Wr={key:1,class:"p-4 overflow-auto"},Ur={class:"mb-4"},Vr={class:"mb-4 flex items-baseline"},Br={class:"gap-x-px flex"},qr=["onClick","disabled","textContent"],jr={class:"mb-4"},Gr={class:"mb-2 flex justify-between items-baseline"},Jr={class:"inline-flex items-center"},Yr=["value"],Kr={class:"ml-2 cursor-pointer"},Xr={key:0,class:"mt-3"},Qr={class:"inline-flex items-center"},Zr=["value"],ea={class:"ml-2 cursor-pointer"},ta={key:0,class:"mb-4"},na={class:"inline-flex items-center"},ra={key:1,class:"mb-4"},aa=["disabled"],oa=["value"],la={key:0,class:"italic mt-2"},ia={key:2,class:"mb-4"},sa=["value"],ua={key:3,class:"mb-4"};function da(e,t,l,a,n,o){return e.isVisible?(y(),m("div",Hr,[f("div",{style:D({height:e.HEADERS_HEIGHT+"px"}),class:"bg-gray-100"},null,4),f("div",Ir,[f("div",zr,[t[11]||(t[11]=f("span",{class:"px-2"},"Column properties",-1)),f("button",{class:"border border-gray-400 rounded-full px-3",onClick:t[0]||(t[0]=r=>e.$emit("focus-editing-header"))},"Focus"),f("button",{onClick:t[1]||(t[1]=(...r)=>e.close&&e.close(...r)),class:"px-2 py-1 ml-auto",title:"Close"},[...t[10]||(t[10]=[f("i",{class:"codicon codicon-close"},null,-1)])])]),e.header.name===null?(y(),m("div",Pr,[f("div",null,E(e.header.length)+" bytes of unidentified data",1)])):(y(),m("div",Wr,[f("div",Ur,[t[12]||(t[12]=f("label",{for:"datv-header-name"},"Name",-1)),U(f("input",{id:"datv-header-name",placeholder:"Unnamed","onUpdate:modelValue":t[2]||(t[2]=r=>e.header.name=r),class:"border p-1 mt-1 w-full focus:border-blue-500",spellcheck:"false"},null,512),[[Ce,e.header.name,void 0,{trim:!0}]])]),f("div",Vr,[t[13]||(t[13]=f("div",{class:"mr-2"},"View mode",-1)),f("div",Br,[(y(!0),m(L,null,H(e.viewModeOpts,r=>(y(),m("button",{key:r.value,class:O(["px-2",e.byteViewMode===r.value?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-300"]),onClick:i=>e.byteViewMode=r.value,disabled:r.disabled,textContent:E(r.label)},null,10,qr))),128))])]),f("div",jr,[f("div",Gr,[t[14]||(t[14]=f("span",null,"Data type",-1)),f("button",{class:"text-red-700 bg-red-100 px-2",onClick:t[3]||(t[3]=(...r)=>e.remove&&e.remove(...r))},"Delete")]),f("div",null,[(y(!0),m(L,null,H(e.dataTypeOpts,r=>(y(),m("div",{key:r.value,class:"mb-0.5"},[f("label",Jr,[U(f("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=i=>e.dataType=i),value:r.value},null,8,Yr),[[Le,e.dataType]]),f("span",Kr,E(r.label),1)])]))),128)),e.arrayTypeOpts.length?(y(),m("div",Xr,[t[15]||(t[15]=f("div",{class:"mb-1"},"of ...",-1)),(y(!0),m(L,null,H(e.arrayTypeOpts,r=>(y(),m("div",{key:r.value,class:"mb-0.5"},[f("label",Qr,[U(f("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=i=>e.arrayType=i),value:r.value},null,8,Zr),[[Le,e.arrayType]]),f("span",ea,E(r.label),1)])]))),128))])):_("",!0)])]),e.header.type.integer?(y(),m("div",ta,[f("label",na,[U(f("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=r=>e.header.type.integer.unsigned=r)},null,512),[[yt,e.header.type.integer.unsigned]]),t[16]||(t[16]=f("span",{class:"ml-2 cursor-pointer"},"Unsigned",-1))])])):_("",!0),e.header.type.key?(y(),m("div",ra,[t[17]||(t[17]=f("label",{for:"datv-header-key-table"},"Table",-1)),U(f("select",{id:"datv-header-key-table",class:"border mt-1 w-full focus:border-blue-500",disabled:e.tablesPreloadNeeded(),"onUpdate:modelValue":t[7]||(t[7]=r=>e.header.type.key.table=r)},[(y(!0),m(L,null,H(e.keyTableOpts,r=>(y(),m("option",{key:r.label,value:r.value},E(r.label),9,oa))),128))],8,aa),[[Me,e.header.type.key.table]]),e.tablesPreloadNeeded()?(y(),m("div",la,"(pre-load all Data Tables to change)")):_("",!0)])):_("",!0),t[22]||(t[22]=f("hr",{class:"my-6"},null,-1)),e.keyDisplayColumnOpts.length?(y(),m("div",ia,[t[18]||(t[18]=f("label",{for:"datv-header-key-column"},"Display Column",-1)),U(f("select",{id:"datv-header-key-column",class:"border mt-1 w-full focus:border-blue-500","onUpdate:modelValue":t[8]||(t[8]=r=>e.header.type.key.viewColumn=r)},[(y(!0),m(L,null,H(e.keyDisplayColumnOpts,r=>(y(),m("option",{key:r.label,value:r.value},E(r.label),9,sa))),128))],512),[[Me,e.header.type.key.viewColumn]])])):_("",!0),e.dataType?(y(),m("div",ua,[t[19]||(t[19]=f("label",{class:"mr-4"},"Width",-1)),U(f("input",{"onUpdate:modelValue":t[9]||(t[9]=r=>e.header.textLength=r),class:"border w-16 text-center"},null,512),[[Ce,e.header.textLength,void 0,{number:!0}]]),t[20]||(t[20]=F(" chars ",-1)),t[21]||(t[21]=f("div",{class:"italic mt-2"},"(move mouse over the column name in Viewer and use `ScrollWheel`, hold `Ctrl` to increase resize step)",-1))])):_("",!0)]))])])):_("",!0)}const ca=re(Fr,[["render",da]]),fa=Math.ceil(z*3);function ha(e,t,l,a,n){const o=[];let r=0;for(const i of l){const u=xe(i);if(i.type.byteView&&!i.type.byteView.array){let s=r;for(let d=0;d<i.length;++d){const c=u.hasBorder&&d===0,h=z*3+(c?Z:0);if(Math.ceil(s)+h<a){s+=h;continue}const p=i.offset+d;if(o.push({offset:p,selected:e[p],border:c,widthPx:fa,leftPx:Math.ceil(s),text:String(p%100).padStart(2,"0"),stat:t[p],key:!1}),s+=h,Math.ceil(s)>=n)return o}}else r+u.borderWidth>=a&&o.push({offset:i.offset,selected:!1,border:u.hasBorder,widthPx:u.paddingWidth,leftPx:r,text:String(i.offset%100).padStart(2,"0"),key:i.type.key!=null});if(r+=u.borderWidth,r>=n)return o}return o}function va(e,t){const l=e.map(n=>({max:n.maxValue.toString(16).padStart(2,"0"),array:!1,string:!1,nullable:!1,zero:n.maxValue===0})),{fieldSize:a}=t;for(let n=0;n<e.length;++n){const o=e[n];if(o.refString)for(let r=0;r<a.STRING;++r)l[n+r].string=!0;if(o.refArray)for(let r=0;r<a.ARRAY;++r)l[n+r].array=!0;if(o.nullableMemsize)for(let r=0;r<t.memsize;++r)l[n+r].nullable=!0}return l}const pa=ee({components:{ResizeObserver:Ot,CanvasScroll:Et,ViewerActions:Fn,ViewerHead:wr,HeaderProps:ca},props:{args:{type:Object,required:!0},kaState:{type:Object,default:void 0},kaScope:{type:Object,required:!0}},emits:["update:kaState"],setup(e,t){const l=I("bundle-index"),a=I("dat-schemas");let n;e.kaState?n=e.kaState:(n=Bt(e.args.fullPath,e.args.fileContent,l,a,e.kaScope),t.emit("update:kaState",n)),mt("viewer",n);const o=q(null),r=q(null);Qe(()=>{r.value.scrollTo(n.scrollPos.x,n.scrollPos.y)});const i=S(()=>n.rowSorting.value?n.rowSorting.value:Array.from({length:n.datFile.rowCount},($,B)=>B)),u=q(0),s=q(0);function d($){u.value=$.width,s.value=$.height}const{scrollPos:c}=n;function h($){c.x=$.x,c.y=$.y}const p=S(()=>ir(n.headers.value)),v=S(()=>n.datFile.rowCount*R),g=S(()=>er(n.datFile.rowCount)),w=S(()=>Math.max(0,u.value-g.value)),C=S(()=>Math.max(0,s.value-te));ge([w,C],()=>{const $=window.devicePixelRatio;o.value.style.width=w.value+"px",o.value.style.height=C.value+"px",o.value.width=w.value*$,o.value.height=C.value*$,o.value.getContext("2d",{alpha:!1}).scale($,$),M()});const k=S(()=>va(n.columnStats.value,n.datFile)),b=S(()=>ha(n.columnSelection.value,k.value,n.headers.value,c.x,c.x+Math.min(p.value,w.value))),x=S(()=>{for(const $ of n.referencedTables.value.values())$.value});ge([c,b,i,n.selectedRow,x],()=>{M()});function M(){const $=o.value.getContext("2d",{alpha:!1});ar({left:c.x,paintWidth:w.value,top:N.value.top,rows:N.value.ids,columns:b.value,viewer:n,ctx:$})}const N=S(()=>{const $=c.y,B=Math.ceil(C.value/R)+1,Y=Math.floor($/R);return{top:Y*R-$,ids:i.value.slice(Y,Y+B)}});function J(){const $=n.editHeader.value,Y=ut(n.headers.value,null,0,0+1/0).find(ae=>ae.offset===$.offset);r.value.scrollTo(Y.leftPx-w.value*.33,void 0)}function ht($){const{selectedRow:B}=n,Y=Math.floor(($.offsetY+c.y)/R),ae=i.value[Y];B.value=B.value!==ae?ae:null}return{headerBlockStyle:S(()=>({height:te+"px",width:u.value+"px"})),headerOverlayContentStyle:S(()=>({left:g.value+"px",height:te+"px",width:w.value+"px"})),scrollableStyle:S(()=>({top:te+"px",left:g.value+"px"})),scrollablePaintSize:S(()=>({width:w.value,height:C.value})),scrollableFullSize:S(()=>({width:p.value,height:v.value})),rowsOverlayStyle:S(()=>({top:te+"px",width:g.value+"px",height:C.value+"px",fontFamily:Q,fontSize:j+"px",lineHeight:R+"px"})),handleScroll:h,handleResize:d,renderItems:N,canvasRef:o,renderColumns:b,scrollLeft:S(()=>c.x),rowsWidth:S(()=>Math.min(p.value,w.value)),LINE_HEIGHT:R,canvasScroll:r,rowsNumberWidth:st(n.datFile.rowCount)+"px",focusEditingHeader:J,handleCanvasClick:ht}}}),ya="_rowsOverlay_1ab2y_2",ma={rowsOverlay:ya},ga={class:"flex flex-1"},ba=["textContent"];function wa(e,t,l,a,n,o){const r=oe("viewer-actions"),i=oe("viewer-head"),u=oe("canvas-scroll"),s=oe("resize-observer"),d=oe("header-props");return y(),m(L,null,[T(r),f("div",ga,[T(s,{class:"relative min-h-0 flex-1",onResize:e.handleResize},{default:Ee(()=>[f("div",{class:"absolute bg-dark-800",style:D(e.headerBlockStyle)},[T(i,{style:D(e.headerOverlayContentStyle),left:e.scrollLeft,width:e.rowsWidth,columns:e.renderColumns},null,8,["style","left","width","columns"])],4),T(u,{ref:"canvasScroll",class:"absolute bg-dark-900",style:D(e.scrollableStyle),"paint-size":e.scrollablePaintSize,"full-size":e.scrollableFullSize,onScroll:e.handleScroll},{default:Ee(()=>[f("canvas",{ref:"canvasRef",onClick:t[0]||(t[0]=(...c)=>e.handleCanvasClick&&e.handleCanvasClick(...c))},null,512)]),_:1},8,["style","paint-size","full-size","onScroll"]),f("div",{class:O(e.$style.rowsOverlay),style:D(e.rowsOverlayStyle)},[f("div",{class:"absolute",style:D({transform:`translate(0, ${e.renderItems.top}px)`})},[(y(!0),m(L,null,H(e.renderItems.ids,(c,h)=>(y(),m("div",{key:c,style:D({transform:`translate(0, ${h*e.LINE_HEIGHT}px)`,width:e.rowsNumberWidth,position:"absolute"}),textContent:E(c)},null,12,ba))),128))],4)],6)]),_:1},8,["onResize"]),T(d,{onFocusEditingHeader:e.focusEditingHeader},null,8,["onFocusEditingHeader"])])],64)}const ka={$style:ma},ft=re(pa,[["render",wa],["__cssModules",ka]]),xa={key:0,class:"flex items-center border-b border-dark-700 bg-dark-800/50"},Sa={class:"flex flex-1 items-center gap-1 overflow-x-auto px-2 py-1"},Ca=["onClick"],$a={class:"max-w-32 truncate"},_a=["onClick"],La={class:"flex items-center gap-1 border-l border-dark-700 px-2"},Ma=["title"],Ea={class:"relative flex-1 overflow-hidden"},Oa={key:0,class:"flex h-full flex-col items-center justify-center p-8"},Aa={class:"mb-6 rounded-2xl bg-dark-800 p-6"},Na={class:"mt-8 flex gap-4"},Ta={class:"btn-primary cursor-pointer"},Ra={class:"btn-secondary"},Da={key:2,class:"absolute inset-0 z-50 flex items-center justify-center bg-dark-900/90 backdrop-blur-sm"},Fa={class:"rounded-xl border-2 border-dashed border-primary-500 bg-primary-600/10 p-12 text-center"},Ua=ee({__name:"ViewerView",setup(e){const t=kt(),l=At(),a=I("bundle-index"),n=q([]),o=q(null),r=q(!1),i=q(!1),u=S(()=>n.value.find(k=>k.id===o.value));ge(()=>t.query.file,async k=>{k&&typeof k=="string"&&await s(k)},{immediate:!0});async function s(k){const b=n.value.find(x=>x.fullPath===k);if(b){o.value=b.id;return}try{l.setLoading(!0,`Loading ${k}...`);const x=await a.loadFileContent(k),M=k.substring(k.lastIndexOf("/")+1),N=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`;n.value.push({id:N,title:M,fullPath:k,fileContent:x,scope:ne()}),o.value=N}catch(x){console.error("Failed to load file:",x)}finally{l.setLoading(!1)}}async function d(k){const b=k.target,x=b.files?.[0];if(!x)return;const M=await x.arrayBuffer(),N=new Uint8Array(M),J=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`;n.value.push({id:J,title:x.name,fullPath:`local/${x.name}`,fileContent:N,scope:ne()}),o.value=J,b.value=""}function c(k){const b=n.value.findIndex(x=>x.id===k);b!==-1&&(n.value[b].scope.stop(),n.value.splice(b,1),o.value===k&&(o.value=n.value[Math.min(b,n.value.length-1)]?.id??null))}function h(){if(!u.value)return;const k=new Blob([u.value.fileContent.buffer],{type:"application/octet-stream"});at.saveAs(k,u.value.title)}function p(k){k.preventDefault(),i.value=!0}function v(){i.value=!1}async function g(k){k.preventDefault(),i.value=!1;const b=k.dataTransfer?.files[0];if(!b)return;const x=await b.arrayBuffer(),M=new Uint8Array(x),N=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`;n.value.push({id:N,title:b.name,fullPath:`local/${b.name}`,fileContent:M,scope:ne()}),o.value=N}function w(){document.getElementById("file-upload")?.click()}async function C(k){const b=k.detail;if(b?.length)for(const x of Array.from(b)){const M=await x.arrayBuffer(),N=new Uint8Array(M),J=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`;n.value.push({id:J,title:x.name,fullPath:`local/${x.name}`,fileContent:N,scope:ne()}),o.value=J}}return Qe(()=>{window.addEventListener("open-local-file",w),window.addEventListener("open-local-files",C)}),gt(()=>{window.removeEventListener("open-local-file",w),window.removeEventListener("open-local-files",C),n.value.forEach(k=>k.scope.stop())}),(k,b)=>(y(),m("div",{class:"flex h-full flex-col",onDragover:p,onDragleave:v,onDrop:g},[f("input",{id:"file-upload",type:"file",accept:".datc64,.dat",class:"hidden",onChange:d},null,32),n.value.length?(y(),m("div",xa,[f("div",Sa,[(y(!0),m(L,null,H(n.value,x=>(y(),m("button",{key:x.id,class:O(["group flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm transition-colors",o.value===x.id?"bg-dark-700 text-dark-100":"text-dark-400 hover:bg-dark-700/50 hover:text-dark-200"]),onClick:M=>o.value=x.id},[T(P(Dt),{class:"h-4 w-4 shrink-0"}),f("span",$a,E(x.title),1),f("button",{class:"ml-1 rounded p-0.5 opacity-0 transition-opacity hover:bg-dark-600 group-hover:opacity-100",onClick:bt(M=>c(x.id),["stop"])},[T(P(Nt),{class:"h-3 w-3"})],8,_a)],10,Ca))),128))]),f("div",La,[f("button",{class:"btn-icon btn-ghost p-1.5",title:"Export",onClick:h},[T(P(Tt),{class:"h-4 w-4"})]),f("button",{class:"btn-icon btn-ghost p-1.5",title:r.value?"Restore":"Maximize",onClick:b[0]||(b[0]=x=>r.value=!r.value)},[r.value?(y(),Oe(P(Ht),{key:0,class:"h-4 w-4"})):(y(),Oe(P(Ft),{key:1,class:"h-4 w-4"}))],8,Ma)])])):_("",!0),f("div",Ea,[n.value.length?(y(!0),m(L,{key:1},H(n.value,x=>U((y(),m("div",{key:x.id,class:"absolute inset-0 flex flex-col bg-dark-900"},[T(ft,{"ka-state":x.state,"onUpdate:kaState":M=>x.state=M,args:{fileContent:x.fileContent,fullPath:x.fullPath},"ka-scope":x.scope},null,8,["ka-state","onUpdate:kaState","args","ka-scope"])])),[[wt,o.value===x.id]])),128)):(y(),m("div",Oa,[f("div",Aa,[T(P(It),{class:"h-16 w-16 text-dark-600"})]),b[3]||(b[3]=f("h2",{class:"text-xl font-semibold text-dark-200"},"No files open",-1)),b[4]||(b[4]=f("p",{class:"mt-2 text-dark-500"},"Open a .datc64 file to start exploring",-1)),f("div",Na,[f("label",Ta,[T(P(Te),{class:"h-4 w-4"}),b[1]||(b[1]=f("span",null,"Open File",-1)),f("input",{type:"file",accept:".datc64,.dat",class:"hidden",onChange:d},null,32)]),f("button",Ra,[T(P(Rt),{class:"h-4 w-4"}),b[2]||(b[2]=f("span",null,"Browse Index",-1))])]),b[5]||(b[5]=f("p",{class:"mt-6 text-sm text-dark-500"},"or drag and drop a file here",-1))])),i.value?(y(),m("div",Da,[f("div",Fa,[T(P(Te),{class:"mx-auto h-12 w-12 text-primary-400"}),b[6]||(b[6]=f("p",{class:"mt-4 text-lg font-medium text-dark-100"},"Drop file to open",-1)),b[7]||(b[7]=f("p",{class:"mt-1 text-sm text-dark-400"},"Supports .datc64 and .dat files",-1))])])):_("",!0)])],32))}});export{Ua as default};
