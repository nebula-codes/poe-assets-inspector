import{c as k,g as T,s as $t,D as Q,d as re,i as W,h as m,o as y,j as c,n as N,k as L,p as G,v as Ne,t as E,H as _,L as oe,r as U,G as Te,M as De,F as O,l as z,z as I,N as Lt,C as Se,O as ze,P as Mt,Q as Pe,E as Et,e as F,b as ue,w as We,u as q,a as Ue,A as Ot,S as At,q as _t}from"./index-BEKG2SnG.js";import{h as $e,g as Nt,r as dt,i as ct,c as ft,j as Fe,k as Rt,v as Tt,s as Dt,l as vt,m as ht,e as Ft,_ as le,n as Ht,o as Ve,t as Be,p as It,C as zt,R as Pt,u as Wt,U as qe,X as Ut}from"./headers-x4RY6FgL.js";import{u as Vt}from"./settings-CsCANAeq.js";import{D as Bt}from"./download-CxYVnS9b.js";import{c as He}from"./createLucideIcon-DALoACw2.js";import{a as qt,F as jt}from"./folder-open-Bu8j2YCb.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=He("Maximize2Icon",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=He("Minimize2Icon",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=He("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);var Le={exports:{}},Kt=Le.exports,je;function Xt(){return je||(je=1,(function(e,t){(function(l,a){a()})(Kt,function(){function l(i,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function a(i,u,f){var h=new XMLHttpRequest;h.open("GET",i),h.responseType="blob",h.onload=function(){d(h.response,u,f)},h.onerror=function(){console.error("could not download file")},h.send()}function r(i){var u=new XMLHttpRequest;u.open("HEAD",i,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function o(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(u)}}var n=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof $e=="object"&&$e.global===$e?$e:void 0,s=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),d=n.saveAs||(typeof window!="object"||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(i,u,f){var h=n.URL||n.webkitURL,p=document.createElement("a");u=u||i.name||"download",p.download=u,p.rel="noopener",typeof i=="string"?(p.href=i,p.origin===location.origin?o(p):r(p.href)?a(i,u,f):o(p,p.target="_blank")):(p.href=h.createObjectURL(i),setTimeout(function(){h.revokeObjectURL(p.href)},4e4),setTimeout(function(){o(p)},0))}:"msSaveOrOpenBlob"in navigator?function(i,u,f){if(u=u||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(l(i,f),u);else if(r(i))a(i,u,f);else{var h=document.createElement("a");h.href=i,h.target="_blank",setTimeout(function(){o(h)})}}:function(i,u,f,h){if(h=h||open("","_blank"),h&&(h.document.title=h.document.body.innerText="downloading..."),typeof i=="string")return a(i,u,f);var p=i.type==="application/octet-stream",v=/constructor/i.test(n.HTMLElement)||n.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||p&&v||s)&&typeof FileReader<"u"){var S=new FileReader;S.onloadend=function(){var w=S.result;w=g?w:w.replace(/^data:[^;]*;/,"data:attachment/file;"),h?h.location.href=w:location=w,h=null},S.readAsDataURL(i)}else{var C=n.URL||n.webkitURL,b=C.createObjectURL(i);h?h.location=b:location.href=b,h=null,setTimeout(function(){C.revokeObjectURL(b)},4e4)}});n.saveAs=d.saveAs=d,e.exports=d})})(Le)),Le.exports}var Qt=Xt();const Re=Nt(Qt),Ge=new Map;function Zt(e,t,l){const a=Ge.get(e)?.deref();if(a)return a;const r=T(null);return en(e,t,l).then(o=>{o&&(r.value=o)}).catch(()=>{}),Ge.set(e,new WeakRef(r)),r}async function en(e,t,l){const a=await t.loadFileContent(e),r=dt(e,a.buffer),o=await ft(r),n=await l.findByName(yt(e)),s=Ft(n,o,r);if(s)return{headers:s.headers,datFile:r}}function tn(e,t,l,a,r){const o=dt(e,t.buffer),n={headers:T(o.rowLength?[{name:null,offset:0,length:o.rowLength,type:ct()}]:[]),datFile:o,name:yt(e),path:e,columnStats:T([]),columnSelection:T(new Array(o.rowLength).fill(!1)),editHeader:T(null),selectedRow:T(null),rowSorting:T(null),scrollPos:$t({x:0,y:0}),referencedTables:r.run(()=>k(()=>{const s=new Map;s.set(n.name,T({headers:n.headers.value,datFile:n.datFile}));for(const d of n.headers.value){if(!d.type.key?.table||s.has(d.type.key.table))continue;const i=n.path.replace(`/${n.name}.`,`/${d.type.key.table}.`);s.set(d.type.key.table,Zt(i,l,a))}return s}))};return ft(n.datFile).then(async s=>{n.columnStats.value=s,await pt(n,a)}),n}async function pt(e,t){e.editHeader.value=null,e.headers.value=e.datFile.rowLength?[{name:null,offset:0,length:e.datFile.rowLength,type:ct()}]:[];const l=await t.findByName(e.name);try{nn(l,e)}catch(a){window.alert(`WARN: ${a.message}`)}finally{Q(e.headers)}}function nn(e,t){let l=0;for(const a of e){const r=a.length||Rt(a,t.datFile);if(a.name==null){l+=r;continue}const o={...a,length:r,offset:l};if(!(a.length?t.datFile.rowLength-o.offset>=o.length:Tt(o,t.columnStats.value)))throw new Error("The schema is invalid.");Dt(o,t.columnSelection.value);const s=vt(t.columnSelection.value,t.headers.value);Object.assign(s,o),ht(t.columnSelection.value),l+=r}}function ke(e,t){const l=e.filter(({type:a})=>a.boolean||a.decimal||a.integer||a.key||a.string).map((a,r)=>({name:a.name||`Unknown${r+1}`,data:Fe(a,t)}));return l.unshift({name:"_rid",data:Array(t.rowCount).fill(void 0).map((a,r)=>r)}),Array(t.rowCount).fill(void 0).map((a,r)=>Object.fromEntries(l.map(o=>[o.name,o.data[r]])))}function yt(e){return e.match(/[^/]+(?=\..+$)/)[0]}async function Me(e,t){await t.saveHeaders(e.name,e.headers.value)}async function rn(e,t){await t.removeHeaders(e.name)}const an=re({setup(){const e=W("bundle-index"),t=W("dat-schemas"),l=T(localStorage.getItem("POE_PATCH_VER")||""),a=T();l.value&&!e.isLoaded&&o(),t.isLoaded||t.fetchSchema(),n();async function r(s){const d=s.target.files[0],i=new Uint8Array(await d.arrayBuffer()),u=d.name;mt({id:`file@${u}`,title:u,type:xt,args:{fileContent:i,fullPath:u}})}async function o(){try{await e.loader.setPatch(l.value),await e.loadIndex(),localStorage.setItem("POE_PATCH_VER",l.value)}catch(s){throw window.alert(s.message),s}}async function n(){const d=await(await fetch("https://poe-versions.obsoleet.org")).json();a.value=d}return{index:e,poePatch:l,latestPoEPatch:a,isCdnImportRunning:k(()=>e.loader.progress.value!=null),isFetchingSchema:k(()=>t.isLoading),handleFile:r,cdnImport:o}}}),on="_input_16vaf_2",ln="_label_16vaf_20",sn="_importVariant_16vaf_26",un={input:on,label:ln,importVariant:sn},dn={class:"p-4 overflow-auto border-l flex-1 text-base"},cn={class:"flex gap-x-4 items-baseline mt-4"},fn={class:"inline-flex items-baseline pb-2"},vn={style:{width:"200px"},class:"my-1"},hn={style:{width:"100px"},class:"m-1"},pn={style:{width:"220px"},class:"my-1"},yn=["disabled","loading"],mn={key:0},gn={class:"px-1 border border-gray-300 rounded"},bn={class:"px-1 border border-gray-300 rounded"},wn={key:0,class:"text-red-600"},kn={class:"flex gap-x-4 items-baseline mt-4 border-b pb-3"},xn={class:"flex items-baseline"},Sn={class:"mt-3 flex gap-x-2 items-center"},Cn={key:0,class:"codicon codicon-loading animate-spin"},$n={key:1,class:"codicon codicon-check"},Ln={key:0},Mn={key:1};function En(e,t,l,a,r,o){return y(),m("div",dn,[c("div",cn,[c("div",{class:N(e.$style.importVariant)},"1",2),c("div",null,[t[7]||(t[7]=c("div",{class:"max-w-xl mb-4 font-semibold"},"Useful when a new league is released. While the update is still downloading, you can review files and fix schema directly from the update servers.",-1)),c("div",fn,[c("div",vn,[c("input",{value:"patch(-poe2).poecdn.com/",readonly:"",class:N(e.$style.input)},null,2),c("label",{class:N(e.$style.label)},"Patch CDN",2)]),c("div",hn,[G(c("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>e.poePatch=n),placeholder:"x.x.x.x.x",class:N(e.$style.input)},null,2),[[Ne,e.poePatch,void 0,{trim:!0}]]),c("label",{class:N(e.$style.label)},"Patch #",2)]),c("div",pn,[c("input",{value:"/Bundles2/_.index.bin",readonly:"",class:N(e.$style.input)},null,2),c("label",{class:N(e.$style.label)},"Index",2)]),c("button",{class:"ml-1 py-1 px-3 bg-blue-600 text-white hover:bg-blue-800",onClick:t[1]||(t[1]=(...n)=>e.cdnImport&&e.cdnImport(...n)),disabled:e.isCdnImportRunning,loading:e.isCdnImportRunning},E(e.isCdnImportRunning?"Wait...":"Import"),9,yn)]),e.latestPoEPatch?(y(),m("div",mn,[c("p",null,[t[3]||(t[3]=_(" Latest PoE patch is ",-1)),c("code",gn,E(e.latestPoEPatch.poe),1),t[4]||(t[4]=_(", and version ",-1)),c("code",bn,E(e.latestPoEPatch.poe2),1),t[5]||(t[5]=_(" for PoE2. ",-1))]),e.index.isLoaded&&e.index.loader.patchVersion!==e.latestPoEPatch.poe&&e.index.loader.patchVersion!==e.latestPoEPatch.poe2?(y(),m("p",wn,[...t[6]||(t[6]=[_(" You can continue to work with cached files.",-1),c("br",null,null,-1),_("But don't delay updating the patch version, otherwise you may experience download errors. ",-1)])])):L("",!0)])):L("",!0)])]),c("div",kn,[c("div",{class:N(e.$style.importVariant)},"2",2),c("div",xn,[t[8]||(t[8]=c("span",{class:"pr-2"},"or just",-1)),t[9]||(t[9]=c("label",{class:"bg-gray-100 py-1 px-2 cursor-pointer hover:bg-gray-300",style:{width:"200px"},for:"import-local-file"},"Pick a local dat file",-1)),c("input",{class:"hidden",id:"import-local-file",type:"file",accept:".datc64",onInput:t[2]||(t[2]=(...n)=>e.handleFile&&e.handleFile(...n))},null,32)])]),c("div",Sn,[e.isFetchingSchema?(y(),m("i",Cn)):(y(),m("i",$n)),c("div",null,[e.isFetchingSchema?(y(),m("span",Ln," Downloading schema from ")):(y(),m("span",Mn," Downloaded schema from ")),t[10]||(t[10]=c("a",{href:"https://github.com/poe-tool-dev/dat-schema",class:"underline",target:"_blank"},"github.com/poe-tool-dev/dat-schema",-1))])])])}const On={$style:un},An=le(an,[["render",En],["__cssModules",On]]),_n=T("poe-dat-viewer@import");function Nn(e){_n.value=e}const _e=T([{id:"poe-dat-viewer@import",title:"Import",type:An,args:void 0,kaScope:oe(!0),kaState:void 0}]);function mt(e){_e.value.find(l=>l.id===e.id)||_e.value.push({id:e.id,title:e.title,type:e.type,args:e.args,kaScope:oe(!0),kaState:void 0}),Nn(e.id),Q(_e)}const Rn=re({props:{args:{type:Object,required:!0}},setup(e){return{text:k(()=>{const{name:t,headers:l}=e.args;let a="";for(const r of l){if(r.name==null)break;let o="";if(r.type.boolean?o="bool":r.type.string?o="string":r.type.integer?.size===1?o=r.type.integer.unsigned?"u8":"i8":r.type.integer?.size===2?o=r.type.integer.unsigned?"u16":"i16":r.type.integer?.size===4?o=r.type.integer.unsigned?"u32":"i32":r.type.integer?.size===8?o=r.type.integer.unsigned?"u64":"i64":r.type.decimal?.size===4?o="f32":r.type.decimal?.size===8?o="f64":r.type.key&&(o=r.type.key.foreign?r.type.key.table??"rid":t),r.type.array)a+=`  ${r.name||"_"}: [${o||"_"}]
`;else if(o)a+=`  ${r.name||"_"}: ${o}
`;else break}return`type ${t} {
${a}}
`})}}}),Tn={class:"p-4 overflow-auto border-l flex-1 text-base"};function Dn(e,t,l,a,r,o){return y(),m("div",Tn,[c("pre",null,E(e.text),1)])}const Fn=le(Rn,[["render",Dn]]),Hn=re({name:"ViewerActions",setup(){const e=W("viewer"),t=W("dat-schemas"),l=U(!1),a=U(null),r=k(()=>Ht(e.columnSelection.value).map(p=>p.map(v=>String(v)).join(" ")));function o(p){a.value&&!a.value.contains(p.target)&&(l.value=!1)}Te(()=>{document.addEventListener("click",o)}),De(()=>{document.removeEventListener("click",o)});function n(){const{editHeader:p,columnSelection:v,headers:g}=e;p.value=vt(v.value,g.value),ht(v.value),Q(g),Q(v),Me(e,t)}function s(){const p=ke(e.headers.value,e.datFile);Re.saveAs(new File([JSON.stringify(p,null,2)],`${e.name}.json`,{type:"application/json;charset=utf-8"})),l.value=!1}function d(){const p=ke(e.headers.value,e.datFile);if(p.length===0)return;const v=Object.keys(p[0]),g=[v.join(","),...p.map(S=>v.map(C=>{const b=S[C];return b==null?"":typeof b=="string"?`"${b.replace(/"/g,'""')}"`:Array.isArray(b)?`"${JSON.stringify(b).replace(/"/g,'""')}"`:String(b)}).join(","))];Re.saveAs(new File([g.join(`
`)],`${e.name}.csv`,{type:"text/csv;charset=utf-8"})),l.value=!1}async function i(){const p=ke(e.headers.value,e.datFile);await navigator.clipboard.writeText(JSON.stringify(p,null,2)),l.value=!1}function u(){if(e.selectedRow.value===null)return;const v=ke(e.headers.value,e.datFile)[e.selectedRow.value];v&&navigator.clipboard.writeText(JSON.stringify(v,null,2))}function f(){mt({id:"poe-dat-viewer@show-schema",title:"Schema",type:Fn,args:{name:e.name,headers:JSON.parse(JSON.stringify(e.headers.value))}})}async function h(){await rn(e,t),await pt(e,t)}return{rowSorting:e.rowSorting,selectedRow:e.selectedRow,selections:r,showExportMenu:l,exportDropdownRef:a,defineColumn:n,exportDataJson:s,exportDataCsv:d,copyAllToClipboard:i,copySelectedRow:u,showSchema:f,restoreSchema:h}}}),In="_bar_1e38q_2",zn={bar:In},Pn={class:"flex items-center gap-2"},Wn={key:0,class:"self-center px-1.5 italic text-dark-500"},Un=["textContent"],Vn={key:3,class:"ml-2 flex items-center gap-2 border-l border-dark-600 pl-2"},Bn={class:"text-dark-400"},qn={class:"flex gap-x-1"},jn={ref:"exportDropdownRef",class:"relative"},Gn={key:0,class:"absolute right-0 top-full z-10 mt-1 w-48 rounded-lg border border-dark-600 bg-dark-800 py-1 shadow-lg"};function Jn(e,t,l,a,r,o){return y(),m("div",{class:N(e.$style.bar)},[c("div",Pn,[e.selections.length===0?(y(),m("div",Wn,"No bytes selected")):e.selections.length===1?(y(),m("button",{key:1,class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[0]||(t[0]=(...n)=>e.defineColumn&&e.defineColumn(...n))},[...t[9]||(t[9]=[c("i",{class:"codicon codicon-add"},null,-1),_(" Define column ",-1)])])):e.selections.length>1?(y(),m(O,{key:2},[t[10]||(t[10]=c("div",{class:"mr-1 self-center px-1.5 text-dark-400"},"Selections",-1)),(y(!0),m(O,null,z(e.selections,n=>(y(),m("div",{class:"mr-1 flex items-center rounded bg-dark-700 px-1.5 font-mono text-dark-200",textContent:E(n)},null,8,Un))),256))],64)):L("",!0),e.selectedRow!==null?(y(),m("div",Vn,[c("span",Bn,"Row "+E(e.selectedRow),1),c("button",{class:"flex items-center gap-x-1 rounded bg-dark-700 px-2 py-0.5 text-xs hover:bg-dark-600 hover:text-dark-100",title:"Copy row data (Ctrl+C)",onClick:t[1]||(t[1]=(...n)=>e.copySelectedRow&&e.copySelectedRow(...n))},[...t[11]||(t[11]=[c("i",{class:"codicon codicon-copy"},null,-1),_(" Copy Row ",-1)])])])):L("",!0)]),c("div",qn,[e.rowSorting?(y(),m("button",{key:0,class:"rounded border border-dark-500 bg-dark-600 px-1.5 hover:bg-dark-500",onClick:t[2]||(t[2]=n=>e.rowSorting=null)}," Clear sorting ")):L("",!0),c("button",{class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[3]||(t[3]=(...n)=>e.restoreSchema&&e.restoreSchema(...n))},[...t[12]||(t[12]=[c("i",{class:"codicon codicon-discard"},null,-1),_(" Restore schema ",-1)])]),c("button",{class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[4]||(t[4]=(...n)=>e.showSchema&&e.showSchema(...n))},[...t[13]||(t[13]=[c("i",{class:"codicon codicon-json"},null,-1),_(" Show schema ",-1)])]),c("div",jn,[c("button",{class:"flex items-center gap-x-1 rounded px-1.5 hover:bg-dark-600 hover:text-dark-100",onClick:t[5]||(t[5]=n=>e.showExportMenu=!e.showExportMenu)},[...t[14]||(t[14]=[c("i",{class:"codicon codicon-database"},null,-1),_(" Export ",-1),c("i",{class:"codicon codicon-chevron-down text-xs"},null,-1)])]),e.showExportMenu?(y(),m("div",Gn,[c("button",{class:"flex w-full items-center gap-2 px-3 py-2 text-left text-sm text-dark-200 hover:bg-dark-700",onClick:t[6]||(t[6]=(...n)=>e.exportDataJson&&e.exportDataJson(...n))},[...t[15]||(t[15]=[c("i",{class:"codicon codicon-json"},null,-1),_(" Export as JSON ",-1)])]),c("button",{class:"flex w-full items-center gap-2 px-3 py-2 text-left text-sm text-dark-200 hover:bg-dark-700",onClick:t[7]||(t[7]=(...n)=>e.exportDataCsv&&e.exportDataCsv(...n))},[...t[16]||(t[16]=[c("i",{class:"codicon codicon-table"},null,-1),_(" Export as CSV ",-1)])]),t[18]||(t[18]=c("div",{class:"my-1 border-t border-dark-700"},null,-1)),c("button",{class:"flex w-full items-center gap-2 px-3 py-2 text-left text-sm text-dark-200 hover:bg-dark-700",onClick:t[8]||(t[8]=(...n)=>e.copyAllToClipboard&&e.copyAllToClipboard(...n))},[...t[17]||(t[17]=[c("i",{class:"codicon codicon-copy"},null,-1),_(" Copy all to clipboard ",-1)])])])):L("",!0)],512)])],2)}const Yn={$style:zn},Kn=le(Hn,[["render",Jn],["__cssModules",Yn]]);function Xn(e,t,l){const a=Fe(e,l),r=Array.from({length:l.rowCount},(o,n)=>n);return e.type.array?r.sort((o,n)=>{const s=a[o];return(a[n].length-s.length)*t}):e.type.boolean?r.sort((o,n)=>{const s=Number(a[o]),d=Number(a[n]);return(s-d)*t}):e.type.string?r.sort((o,n)=>{const s=a[o],d=a[n];return s.localeCompare(d)*t}):e.type.integer||e.type.decimal?r.sort((o,n)=>{const s=a[o];return(a[n]-s)*t}):e.type.key&&(e.type.key.foreign?r.sort((o,n)=>{const s=a[o];return((a[n]||0)-(s||0))*t}):r.sort((o,n)=>{const s=Number(a[o]);return(Number(a[n])-s)*t})),r}const A={number:"#4ade80",boolean:"#60a5fa",string:"#fbbf24",null:"#f87171",key:"#a78bfa",muted:"#64748b",hex:"#94a3b8"};function Qn(e,t){t.text=String(e),t.color=A.number}function Zn(e,t){t.text=e.toLocaleString(void 0,{maximumFractionDigits:6,minimumFractionDigits:1}),t.color=A.number}function er(e,t){t.text=`[${e.join(", ")}]`,t.color=A.number}function tr(e,t){t.text=`[${e.map(l=>l.toLocaleString(void 0,{maximumFractionDigits:6,minimumFractionDigits:1})).join(", ")}]`,t.color=A.number}function nr(e,t){t.text=String(e),t.color=A.boolean}function rr(e,t){t.text=`[${e.join(", ")}]`,t.color=A.boolean}function ar(e,t){e===""?(t.text="empty",t.color=A.muted):(t.text=String(e),t.color=A.string)}function or(e,t){t.text=`[${e.map(l=>JSON.stringify(l)).join(", ")}]`,t.color=A.string}function Je(e,t){e===null?(t.text="<null, self>",t.color=A.null):(t.text=`<${e}, self>`,t.color=A.key)}function lr(e,t){t.text=`[${e.map(l=>`<${l}, self>`).join(", ")}]`,t.color=A.key}function Ye(e,t){e===null?(t.text="<null>",t.color=A.null):(t.text=`<${e}>`,t.color=A.key)}function ir(e,t){t.text=`[${e.map(l=>`<${l}>`).join(", ")}]`,t.color=A.key}function Ke(e,t,l,a,r){const o=Ve(t,l);if(r?.header.type.array)throw new Error("Can't show array of arrays.");const n=r&&Ve(r.header,r.datFile),s={text:"",color:""},d=(()=>{const f=r!=null?r.header.type:t.type;if(t.type.array){if(f.boolean)return rr;if(f.string)return or;if(f.integer)return er;if(f.decimal)return tr;if(f.key?.foreign)return ir;if(f.key)return lr}else{if(f.boolean)return nr;if(f.string)return ar;if(f.integer)return Qn;if(f.decimal)return Zn;if(f.key?.foreign)return Ye;if(f.key)return Je}throw new Error("never")})();let i=0,u="";for(const f of a){let h=o(f);r?t.type.array?(h=h.map(p=>n(p)),d(h,s)):h===null?(t.type.key.foreign?Ye:Je)(h,s):(h=n(h),d(h,s)):d(h,s),u!==s.color&&(e.fillStyle=s.color,u=s.color),e.fillText(s.text,0,i),i+=H}}function sr(e,t,l,a,r,o){e.fillStyle=A.hex;let n=0;for(const s of a){const d=l.dataFixed.subarray(s*l.rowLength+t.offset+r,s*l.rowLength+t.offset+o),i=Array.from(d,u=>u.toString(16).padStart(2,"0")).join(" ");e.fillText(i,r*(V*3),n),n+=H}}function ur(e,t,l,a,r){e.fillStyle=A.hex;const o=r.refArray,n=Math.max(o.keyForeign?l.fieldSize.KEY_FOREIGN:0,o.keySelf?l.fieldSize.KEY:0,o.string?l.fieldSize.STRING:0,o.numeric32?l.fieldSize.LONG:0,l.fieldSize.BYTE),s=Math.ceil(t.textLength/3);let d=0;for(const i of a){const u=l.readerFixed.getUint32(i*l.rowLength+t.offset,!0);if(u===0)e.fillText("[]",0,d);else{const f=l.readerFixed.getUint32(i*l.rowLength+t.offset+l.memsize,!0),h=l.dataVariable.subarray(f,f+Math.min(n*u,s)),p=Array.from(h,v=>v.toString(16).padStart(2,"0")).join(" ");e.fillText(`${u} { ${p} }`,0,d)}d+=H}}const ee={background:"#0f172a",text:"#e2e8f0",border:"#334155",selection:"rgba(14, 165, 233, 0.2)",shadow:"rgba(0, 0, 0, 0.3)"},te='"JetBrains Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',X=14,V=pr(X,te),dr=yr(X,te),H=19,cr=3,ne=1,fr=7,xe=Math.round(V*3),ae=xe*2+fr*3;function vr(e){const t=String(e-1).length;return Math.max(t,cr)}function gt(e){return Math.ceil(vr(e)*V)}function hr(e){return gt(e)+16}function pr(e,t){const a=document.createElement("canvas").getContext("2d");return a.font=`${e}px ${t}`,a.measureText("0").width}function yr(e,t){const a=document.createElement("canvas").getContext("2d");a.font=`${e}px ${t}`,a.textBaseline="middle";const r=a.measureText("0");return e/2+(r.alphabeticBaseline!==void 0?-r.alphabeticBaseline:r.actualBoundingBoxDescent)}function mr(e){return 1+(e-X)/2+dr}function gr(e){const{ctx:t}=e;if(t.fillStyle=ee.background,t.fillRect(0,0,t.canvas.width,t.canvas.height),e.viewer.selectedRow.value!==null){const a=e.rows.indexOf(e.viewer.selectedRow.value);a!==-1&&(t.fillStyle=ee.selection,t.fillRect(0,e.top+a*H,t.canvas.width,H))}t.save(),t.translate(-e.left,0),br(t,e.columns),t.restore(),t.font=`${X}px ${te}`,t.fillStyle=ee.text;const l=wr(e.viewer,e.left,e.left+e.paintWidth);for(const a of l)t.save(),t.beginPath(),t.translate(a.left-e.left,0),t.rect(0,0,a.width,t.canvas.height),t.clip(),t.translate(V/2,e.top+mr(H)),a.exec(t,e.rows),t.restore();{const a=t.createLinearGradient(0,-16,0,4);a.addColorStop(0,ee.shadow),a.addColorStop(1,"transparent"),t.fillStyle=a,t.fillRect(0,0,t.canvas.width,6);const r=t.createLinearGradient(-16,0,4,0);r.addColorStop(0,ee.shadow),r.addColorStop(1,"transparent"),t.fillStyle=r,t.fillRect(0,0,6,t.canvas.height)}}function br(e,t){for(const l of t)l.selected&&(e.fillStyle=ee.selection,e.fillRect(l.leftPx+(l.border?ne:0),0,l.widthPx,e.canvas.height)),l.border&&(e.fillStyle=ee.border,e.fillRect(l.leftPx,0,ne,e.canvas.height))}function wr(e,t,l){const a=e.headers.value,r=e.columnStats.value,o=e.datFile,n=[];let s=0;for(const d of a){const i=Ee(d);if(s+i.borderWidth>=t)if(d.type.byteView)if(d.type.byteView.array)n.push({left:s+(i.borderWidth?ne:0),width:i.paddingWidth,exec:(u,f)=>{ur(u,d,o,f,r[d.offset])}});else{const u=Math.max(0,Math.floor((t-s)/(V*3))),f=Math.min(d.length,Math.ceil((l-s)/(V*3)));n.push({left:s+(i.borderWidth?ne:0),width:i.paddingWidth,exec:(h,p)=>{sr(h,d,o,p,u,f)}})}else n.push({left:s+(i.borderWidth?ne:0),width:i.paddingWidth,exec:(u,f)=>{if(d.type.key?.table&&d.type.key.viewColumn){const h=e.referencedTables.value.get(d.type.key.table).value;if(h){const p=h.headers.find(v=>v.name===d.type.key.viewColumn);if(p){Ke(u,d,o,f,{header:p,datFile:h.datFile});return}}}Ke(u,d,o,f)}});if(s+=i.borderWidth,s>=l)return n}return n}function Ee(e){const t=e.type.byteView&&!e.type.byteView.array?e.length*3-1:e.textLength;return{paddingWidth:Math.ceil((t+1)*V),borderWidth:Math.ceil((t+1)*V)+(e.offset>0?ne:0),hasBorder:e.offset>0}}function kr(e){let t=0;for(const l of e){const a=Ee(l);t+=a.borderWidth}return t}function bt(e,t,l,a){const r=[];let o=0;for(const n of e){const s=Ee(n);if(o+s.borderWidth>=l&&r.push({offset:n.offset,border:s.hasBorder,active:n===t,widthPx:s.borderWidth,leftPx:o,name:n.name}),o+=s.borderWidth,o>=a)return r}return r}const xr=re({props:{left:{type:Number,required:!0},width:{type:Number,required:!0},columns:{type:Array,required:!0}},setup(e){const t=T(0);let l=-1,a=[];const r=W("viewer"),o=W("dat-schemas");function n(f){l=f,a=[...r.columnSelection.value],Be(r.columnSelection.value,l,l,r.headers.value),Q(r.columnSelection),document.addEventListener("mouseup",h),document.addEventListener("mouseleave",h);function h(){l=-1,document.removeEventListener("mouseup",h),document.removeEventListener("mouseleave",h)}}function s(f,h){if(l===-1||h.buttons!==1)return;const{memsize:p}=r.datFile,v=f-l;v>=p?f=l+p*2-1:v>=4?f=l+8-1:v>=2&&(f=l+4-1),v<=-p?f=l-p*2+1:v<=-4?f=l-8+1:v<=-2&&(f=l-4+1),r.columnSelection.value=[...a],Be(r.columnSelection.value,l,f,r.headers.value)}function d(f){const h=r.headers.value.find(p=>p.offset===f);r.editHeader.value===h&&(!h.type.byteView||h.type.byteView.array)?(t.value===0?t.value=1:t.value===1?t.value=-1:t.value===-1&&(t.value=1),r.rowSorting.value=Xn(h,t.value,r.datFile)):(r.editHeader.value=h,t.value=0)}function i(f,h){h.preventDefault();const p=r.headers.value.find(v=>v.offset===f);p.textLength!=null&&(p.textLength=Math.max(1,p.textLength-Math.sign(h.deltaY)*(h.ctrlKey?10:1)),Q(r.headers),Me(r,o))}return{headers:k(()=>bt(r.headers.value,r.editHeader.value,e.left,e.left+e.width)),selectStart:n,selectContinue:s,editHeader:d,handleHeaderWheel:i,headersRowStyle:k(()=>({transform:`translate(${-e.left}px, 0)`,lineHeight:xe+"px",fontFamily:te,fontSize:X+"px"})),colsRowStyle:k(()=>({transform:`translate(${-e.left}px, ${xe}px)`,lineHeight:xe+"px",fontFamily:te,fontSize:X+"px"})),statsRowStyle:k(()=>({transform:`translate(${-e.left}px, ${xe*2}px)`,fontFamily:te,fontSize:X+"px"}))}}}),Sr={class:"datv-header-layer"},Cr=["title","onClick","onWheel"],$r={key:1,class:"rounded bg-dark-600 px-1 text-dark-300"},Lr=["title","onMousedown","onMouseenter","textContent"],Mr={key:0,class:"datv-stat__line bg-yellow-500",style:{top:"0"}},Er={key:1,class:"datv-stat__line bg-green-500",style:{top:"7px"}},Or={key:2,class:"datv-stat__line bg-gray-800",style:{top:"14px"}},Ar={key:3,class:"datv-stat__line bg-pink-400",style:{top:"14px"}},_r=["textContent"],Nr={key:1,class:"mx-auto inline-flex h-full items-center"};function Rr(e,t,l,a,r,o){return y(),m("div",Sr,[c("div",{style:I(e.headersRowStyle),class:"absolute"},[(y(!0),m(O,null,z(e.headers,n=>(y(),m("button",{key:n.offset,class:N(["datv-header",{"datv-col--border":n.border,"datv-header--active":n.active}]),style:I({width:n.widthPx+"px",transform:`translate(${n.leftPx}px, 0)`}),title:n.name==null?"unidentified":n.name||"unnamed",onClick:s=>e.editHeader(n.offset),onWheel:s=>e.handleHeaderWheel(n.offset,s)},[n.name===null?(y(),m(O,{key:0},[_("Â ")],64)):n.name===""?(y(),m("span",$r,"?")):(y(),m(O,{key:2},[_(E(n.name),1)],64))],46,Cr))),128))],4),c("div",{style:I(e.colsRowStyle),class:"absolute"},[(y(!0),m(O,null,z(e.columns,n=>(y(),m("button",{key:n.offset,class:N(["datv-byte",{"datv-col--border":n.border,"datv-byte--selected":n.selected}]),style:I({width:n.widthPx+"px",transform:`translate(${n.leftPx}px, 0)`}),title:String(n.offset),onMousedown:s=>e.selectStart(n.offset),onMouseenter:s=>e.selectContinue(n.offset,s),textContent:E(n.text)},null,46,Lr))),128))],4),c("div",{style:I(e.statsRowStyle),class:"datv-stats_row absolute"},[(y(!0),m(O,null,z(e.columns,n=>(y(),m("div",{key:n.offset,class:N(["datv-stat",{"datv-col--border":n.border,"datv-byte--selected":n.selected}]),style:I({width:n.widthPx+"px",transform:`translate(${n.leftPx}px, 0)`})},[n.stat?(y(),m(O,{key:0},[n.stat.string?(y(),m("div",Mr)):L("",!0),n.stat.array?(y(),m("div",Er)):L("",!0),n.stat.zero?(y(),m("div",Or)):n.stat.nullable?(y(),m("div",Ar)):L("",!0),c("div",{class:"datv-stat__max",textContent:E(n.stat.max)},null,8,_r)],64)):n.key?(y(),m("span",Nr,[...t[0]||(t[0]=[c("i",{class:"codicon codicon-key"},null,-1)])])):L("",!0)],6))),128))],4)])}const Tr=le(xr,[["render",Rr]]);var Z={},de={},j={},Xe;function J(){if(Xe)return j;Xe=1,Object.defineProperty(j,"__esModule",{value:!0}),j.fillTwoDimensionalArray=j.createTwoDimensionalArray=j.isNullOrUndefined=void 0;function e(a){return a==null}j.isNullOrUndefined=e;function t(a,r){for(var o=Array(a),n=0;n<o.length;n++)o[n]=Array(r);return o}j.createTwoDimensionalArray=t;function l(a,r){r===void 0&&(r=0);for(var o=0,n=a;o<n.length;o++)for(var s=n[o],d=0;d<s.length;d++)s[d]=r}return j.fillTwoDimensionalArray=l,j}var Qe;function Dr(){if(Qe)return de;Qe=1,Object.defineProperty(de,"__esModule",{value:!0}),de.JaroWinkler=void 0;var e=J(),t=(function(){function l(a){this.DEFAULT_THRESHOLD=.7,this.THREE=3,this.JW_COEF=.1,this.threshold=a||this.DEFAULT_THRESHOLD}return l.prototype.similarity=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");if(a===r)return 1;var o=this.matches(a,r),n=o[0];if(n===0)return 0;var s=(n/a.length+n/r.length+(n-o[1])/n)/this.THREE,d=s;return s>this.threshold&&(d=s+Math.min(this.JW_COEF,1/o[this.THREE])*o[2]*(1-s)),d},l.prototype.distance=function(a,r){return 1-this.similarity(a,r)},l.prototype.matches=function(a,r){var o,n;a.length>r.length?(o=a,n=r):(o=r,n=a);var s=Math.max(Math.floor(o.length/2)-1,0),d=Array(n.length);d.fill(-1);for(var i=Array(o.length),u=0,f=0;f<n.length;f++)for(var h=n[f],p=Math.max(f-s,0),v=Math.min(f+s+1,o.length);p<v;p++)if(!i[p]&&h===o[p]){d[f]=p,i[p]=!0,u++;break}for(var g=Array(u),S=Array(u),C=0,b=0;C<n.length;C++)d[C]!==-1&&(g[b]=n[C],b++);for(var C=0,b=0;C<o.length;C++)i[C]&&(S[b]=o[C],b++);for(var w=0,f=0;f<g.length;f++)g[f]!==S[f]&&w++;for(var x=0,f=0;f<n.length&&a[f]===r[f];f++)x++;return[u,Math.floor(w/2),x,o.length]},l})();return de.JaroWinkler=t,de}var ce={},Ze;function wt(){if(Ze)return ce;Ze=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.Levenshtein=void 0;var e=J(),t=(function(){function l(){}return l.prototype.distance=function(a,r,o){if(o===void 0&&(o=Number.MAX_VALUE),e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");if(a===r)return 0;if(a.length===0)return r.length;if(r.length===0)return a.length;for(var n=Array(r.length+1),s=Array(r.length+1),d=[],i=0;i<n.length;i++)n[i]=i;for(var i=0;i<a.length;i++){s[0]=i+1;for(var u=s[0],f=0;f<r.length;f++){var h=1;a[i]===r[f]&&(h=0),s[f+1]=Math.min(s[f]+1,Math.min(n[f+1]+1,n[f]+h)),u=Math.min(u,s[f+1])}if(u>=o)return o;d=n,n=s,s=d}return n[r.length]},l})();return ce.Levenshtein=t,ce}var fe={},et;function Fr(){if(et)return fe;et=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.CharacterInsDelInterface=void 0;var e=(function(){function t(l,a){this.deletionCost=l,this.insertionCost=a}return t})();return fe.CharacterInsDelInterface=e,fe}var ve={},tt;function Hr(){if(tt)return ve;tt=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.CharacterSubstitutionInterface=void 0;var e=(function(){function t(l){this.cost=l}return t})();return ve.CharacterSubstitutionInterface=e,ve}var he={},nt;function Ir(){if(nt)return he;nt=1,Object.defineProperty(he,"__esModule",{value:!0}),he.NormalizedLevenshtein=void 0;var e=wt(),t=J(),l=(function(){function a(){this.l=new e.Levenshtein}return a.prototype.distance=function(r,o){if(t.isNullOrUndefined(r))throw new Error("s1 must neither be null nor undefined");if(t.isNullOrUndefined(o))throw new Error("s2 must neither be null nor undefined");if(r===o)return 0;var n=Math.max(r.length,o.length);return n===0?0:this.l.distance(r,o)/n},a.prototype.similarity=function(r,o){return 1-this.distance(r,o)},a})();return he.NormalizedLevenshtein=l,he}var pe={},rt;function zr(){if(rt)return pe;rt=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.WeightedLevenshtein=void 0;var e=J(),t=(function(){function l(a,r){this.charsub=a,this.charchange=r}return l.prototype.distance=function(a,r,o){if(o===void 0&&(o=Number.MAX_VALUE),e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");if(a===r)return 0;if(a.length===0)return r.length;if(r.length===0)return a.length;var n=Array(r.length+1),s=Array(r.length+1),d=[];n[0]=0;for(var i=1;i<n.length;i++)n[i]=n[i-1]+this.insertionCost(r[i-1]);for(var i=0;i<a.length;i++){var u=a[i],f=this.deletionCost(u);s[0]=n[0]+f;for(var h=s[0],p=0;p<r.length;p++){var v=r[p],g=0;u!==v&&(g=this.charsub.cost(u,v));var S=this.insertionCost(v);s[p+1]=Math.min(s[p]+S,Math.min(n[p+1]+f,n[p]+g)),h=Math.min(h,s[p+1])}if(h>=o)return o;d=n,n=s,s=d}return n[r.length]},l.prototype.insertionCost=function(a){return this.charchange?this.charchange.insertionCost(a):1},l.prototype.deletionCost=function(a){return this.charchange?this.charchange.deletionCost(a):1},l})();return pe.WeightedLevenshtein=t,pe}var ye={},at;function Pr(){if(at)return ye;at=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.Damerau=void 0;var e=J(),t=(function(){function l(){}return l.prototype.distance=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");if(a===r)return 0;for(var o=a.length+r.length,n=new Map,s=0;s<a.length;s++)n.set(a[s],0);for(var s=0;s<r.length;s++)n.set(r[s],0);for(var d=e.createTwoDimensionalArray(a.length+2,r.length+2),i=0;i<=a.length;i++)d[i+1][0]=o,d[i+1][1]=i;for(var u=0;u<=r.length;u++)d[0][u+1]=o,d[1][u+1]=u;for(var i=1;i<=a.length;i++){for(var f=0,u=1;u<=r.length;u++){var h=n.get(r[u-1]),p=f,v=1;a[i-1]===r[u-1]&&(v=0,f=u),d[i+1][u+1]=this.min(d[i][u]+v,d[i+1][u]+1,d[i][u+1]+1,d[h][p]+(i-h-1)+1+(u-p-1))}n.set(a[i-1],i)}return d[a.length+1][r.length+1]},l.prototype.min=function(a,r,o,n){return this.minWithNaN(a,this.minWithNaN(r,this.minWithNaN(o,n)))},l.prototype.minWithNaN=function(a,r){return isNaN(a)&&isNaN(r)?0:isNaN(a)?r:isNaN(r)?a:Math.min(a,r)},l})();return ye.Damerau=t,ye}var me={},ot;function Wr(){if(ot)return me;ot=1,Object.defineProperty(me,"__esModule",{value:!0}),me.OptimalStringAlignment=void 0;var e=J(),t=(function(){function l(){}return l.prototype.distance=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");if(a===r)return 0;var o=a.length,n=r.length;if(o==0)return n;if(n==0)return o;for(var s=e.createTwoDimensionalArray(o+2,n+2),d=0;d<=o;d++)s[d][0]=d;for(var i=0;i<=n;i++)s[0][i]=i;for(var u,d=1;d<=o;d++)for(var i=1;i<=n;i++)u=1,a.charAt(d-1)==r.charAt(i-1)&&(u=0),s[d][i]=this.min(s[d-1][i-1]+u,s[d][i-1]+1,s[d-1][i]+1),d>1&&i>1&&a.charAt(d-1)===r.charAt(i-2)&&a.charAt(d-2)===r.charAt(i-1)&&(s[d][i]=Math.min(s[d][i],s[d-2][i-2]+u));return s[o][n]},l.prototype.min=function(a,r,o){return Math.min(a,Math.min(r,o))},l})();return me.OptimalStringAlignment=t,me}var ge={},lt;function kt(){if(lt)return ge;lt=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.LongestCommonSubsequence=void 0;var e=J(),t=(function(){function l(){}return l.prototype.distance=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");return a===r?0:a.length+r.length-2*this.length(a,r)},l.prototype.length=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s1 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s2 must neither be null nor undefined");var o=a.length,n=r.length,s=a,d=r,i=e.createTwoDimensionalArray(o+1,n+1);e.fillTwoDimensionalArray(i);for(var u=1;u<=o;u++)for(var f=1;f<=n;f++)s[u-1]===d[f-1]?i[u][f]=i[u-1][f-1]+1:i[u][f]=Math.max(i[u][f-1],i[u-1][f]);return i[o][n]},l})();return ge.LongestCommonSubsequence=t,ge}var be={},it;function Ur(){if(it)return be;it=1,Object.defineProperty(be,"__esModule",{value:!0}),be.MetricLCS=void 0;var e=kt(),t=J(),l=(function(){function a(){this.lcs=new e.LongestCommonSubsequence}return a.prototype.distance=function(r,o){if(t.isNullOrUndefined(r))throw new Error("s1 must neither be null nor undefined");if(t.isNullOrUndefined(o))throw new Error("s2 must neither be null nor undefined");if(r===o)return 0;var n=Math.max(r.length,o.length);return n==0?0:1-1*this.lcs.length(r,o)/n},a})();return be.MetricLCS=l,be}var we={},st;function Vr(){if(st)return we;st=1,Object.defineProperty(we,"__esModule",{value:!0}),we.NGram=void 0;var e=J(),t=(function(){function l(a){this.DEFAULT_N=2,this.n=e.isNullOrUndefined(a)?this.DEFAULT_N:a}return l.prototype.distance=function(a,r){if(e.isNullOrUndefined(a))throw new Error("s0 must neither be null nor undefined");if(e.isNullOrUndefined(r))throw new Error("s1 must neither be null nor undefined");if(a===r)return 0;var o=`
`,n=a.length,s=r.length;if(n==0||s==0)return 1;var d=0;if(n<this.n||s<this.n){for(var i=0,u=Math.min(n,s);i<u;i++)a.charAt(i)==r.charAt(i)&&d++;return d/Math.max(n,s)}for(var f=Array(n+this.n-1),h,p,v,g=0;g<f.length;g++)g<this.n-1?f[g]=o:f[g]=a.charAt(g-this.n+1);h=Array(n+1),p=Array(n+1);var S,C,b=Array(this.n);for(S=0;S<=n;S++)h[S]=S;for(C=1;C<=s;C++){if(C<this.n){for(var w=0;w<this.n-C;w++)b[w]=o;for(var w=this.n-C;w<this.n;w++)b[w]=r.charAt(w-(this.n-C))}else b=r.substring(C-this.n,C).split("");for(p[0]=C,S=1;S<=n;S++){d=0;for(var x=this.n,u=0;u<this.n;u++)f[S-1+u]!=b[u]?d++:f[S-1+u]==o&&x--;var M=d/x;p[S]=Math.min(Math.min(p[S-1]+1,h[S]+1),h[S-1]+M)}v=h,h=p,p=v}return h[n]/Math.max(s,n)},l})();return we.NGram=t,we}var ut;function Br(){return ut||(ut=1,(function(e){var t=Z&&Z.__createBinding||(Object.create?(function(a,r,o,n){n===void 0&&(n=o),Object.defineProperty(a,n,{enumerable:!0,get:function(){return r[o]}})}):(function(a,r,o,n){n===void 0&&(n=o),a[n]=r[o]})),l=Z&&Z.__exportStar||function(a,r){for(var o in a)o!=="default"&&!r.hasOwnProperty(o)&&t(r,a,o)};Object.defineProperty(e,"__esModule",{value:!0}),l(Dr(),e),l(wt(),e),l(Fr(),e),l(Hr(),e),l(Ir(),e),l(zr(),e),l(Pr(),e),l(Wr(),e),l(kt(),e),l(Ur(),e),l(Vr(),e)})(Z)),Z}var qr=Br();function jr(e,t,l){e=e.toLowerCase();const a=[],r=[],o=[],n=new qr.MetricLCS;for(const i of l)t>=i.totalRows||i.name.toLowerCase()===e||(a.push(i),r.push(i.totalRows-(t+1)),o.push(n.distance(e,i.name.toLowerCase())));const s=new Array(a.length).fill(0);for(const i of[r,o]){const u=Math.min(...i),f=Math.max(...i);for(let h=0;h<i.length;h+=1){const p=(i[h]-u)/(f-u);p>.33&&(s[h]+=p)}}const d=new Array(a.length).fill(0).map((i,u)=>u);return d.sort((i,u)=>s[i]-s[u]),d.map(i=>a[i])}function Gr(e,t,l){const a=[],{fieldSize:r}=l,o=e.length;return o===r.ARRAY&&t.refArray&&a.push({label:"Array",value:"array"}),o===r.STRING&&t.refString&&a.push({label:"String",value:"string"}),o===r.KEY&&t.keySelf&&a.push({label:"Key (self)",value:"key_self"}),o===r.KEY_FOREIGN&&t.keyForeign&&a.push({label:"Key (foreign)",value:"key_foreign"}),(o===4||o===2)&&a.push({label:"Integer",value:"integer"}),o===4&&a.push({label:"Decimal",value:"decimal"}),o===1&&t.maxValue<=1&&a.push({label:"Boolean",value:"boolean"}),a}function Jr(e,t){const l=[];if(!e.type.array||!t.refArray)return l;const a=t.refArray;return a.string&&l.push({label:"String",value:"string"}),a.keySelf&&l.push({label:"Key (self)",value:"key_self"}),a.keyForeign&&l.push({label:"Key (foreign)",value:"key_foreign"}),a.numeric32&&l.push({label:"Integer - 4 bytes",value:"integer_4"}),a.numeric32&&l.push({label:"Decimal - 4 bytes",value:"decimal_4"}),a.boolean&&l.push({label:"Boolean",value:"boolean"}),l}function Yr(e,t){const l=T([]);return t.findByName(e).then(a=>{l.value=a}).catch(()=>{}),l}const Kr=re({setup(){const e=W("viewer"),t=W("dat-schemas"),l=k(()=>e.editHeader.value&&Lt(e.editHeader.value));{let v=null;Se(l,g=>{v&&(v(),v=null),g&&(v=Se(g,()=>{Q(e.headers),Me(e,t)},{deep:!0}))})}const a=k(()=>e.columnStats.value[l.value.offset]),r=k({get(){const v=l.value.type;return v.array?"array":v.string?"string":v.key?v.key.foreign?"key_foreign":"key_self":v.integer?"integer":v.decimal?"decimal":v.boolean?"boolean":void 0},set(v){const g=l.value;g.type={},v==="array"?(g.type.array=!0,g.type.byteView={array:!0}):v==="string"?g.type.string={}:v==="key_foreign"?g.type.key={foreign:!0,table:null,viewColumn:null}:v==="key_self"?g.type.key={foreign:!1,table:e.name,viewColumn:null}:v==="integer"?g.type.integer={unsigned:!1,size:g.length}:v==="decimal"?g.type.decimal={size:g.length}:v==="boolean"&&(g.type.boolean={})}}),o=k({get(){const v=l.value.type;return v.string?"string":v.key?v.key.foreign?"key_foreign":"key_self":v.integer?`integer_${v.integer.size}`:v.decimal?`decimal_${v.decimal.size}`:v.boolean?"boolean":void 0},set(v){const g=l.value;g.type={array:!0},v==="string"?g.type.string={}:v==="key_foreign"?g.type.key={foreign:!0,table:null,viewColumn:null}:v==="key_self"?g.type.key={foreign:!1,table:e.name,viewColumn:null}:v==="integer_1"?g.type.integer={unsigned:!1,size:1}:v==="integer_2"?g.type.integer={unsigned:!1,size:2}:v==="integer_4"?g.type.integer={unsigned:!1,size:4}:v==="integer_8"?g.type.integer={unsigned:!1,size:8}:v==="decimal_4"?g.type.decimal={size:4}:v==="decimal_8"?g.type.decimal={size:8}:v==="boolean"&&(g.type.boolean={})}}),n=k(()=>{const v=[],g=l.value.type;return v.push({label:"Bytes",value:"bytes"}),g.array&&v.push({label:"Var. bytes",value:"array-bytes"}),v.push({label:"Data",value:"data",disabled:!r.value||r.value==="array"&&!o.value}),v}),s=k({get(){const v=l.value.type;return v.byteView?v.byteView.array?"array-bytes":"bytes":"data"},set(v){const g=l.value.type;v==="data"?g.byteView=void 0:g.byteView={array:v==="array-bytes"}}}),d=k(()=>{const v=Fe(l.value,e.datFile);return Math.max(...l.value.type.array?v.flat():v)}),i=k(()=>{let v;if(!l.value.type.key.foreign)return v=[{value:e.name,label:e.name}],v;if(v=[{value:null,label:"rid (unknown)"}],t.tableStats.length){const g=jr(e.name,d.value,t.tableStats);v.push(...g.map(S=>({value:S.name,label:S.name})))}else l.value.type.key.table!==null&&v.push({value:l.value.type.key.table,label:l.value.type.key.table});return v}),u=k(()=>l.value.type.key?.table?Yr(l.value.type.key.table,t):null),f=k(()=>{if(!l.value.type.key)return[];const v=[{value:null,label:"row index"}],g=l.value.type.key.foreign?u.value?.value??[]:e.headers.value;return v.push(...g.filter(S=>S.name!==null&&S.name.length&&!S.type.array).map(S=>({label:S.name,value:S.name}))),v});function h(){e.editHeader.value=null}function p(){It(l.value,e.headers.value),e.editHeader.value=null,Q(e.headers),Me(e,t)}return{isVisible:k(()=>e.editHeader.value!=null),HEADERS_HEIGHT:ae,header:l,byteViewMode:s,dataType:r,arrayType:o,close:h,remove:p,viewModeOpts:n,keyTableOpts:i,keyDisplayColumnOpts:f,tablesPreloadNeeded:()=>l.value.type.key!=null?l.value.type.key.foreign&&!t.tableStats.length:!1,dataTypeOpts:k(()=>Gr(l.value,a.value,e.datFile)),arrayTypeOpts:k(()=>Jr(l.value,a.value))}}}),Xr={key:0,style:{width:"300px"},class:"relative overflow-hidden"},Qr={class:"m-2 shadow border border-gray-300 bg-white absolute inset-0 flex flex-col"},Zr={class:"p-2 bg-gray-100 text-gray-600 shadow flex items-center"},ea={key:0,class:"p-4"},ta={key:1,class:"p-4 overflow-auto"},na={class:"mb-4"},ra={class:"mb-4 flex items-baseline"},aa={class:"gap-x-px flex"},oa=["onClick","disabled","textContent"],la={class:"mb-4"},ia={class:"mb-2 flex justify-between items-baseline"},sa={class:"inline-flex items-center"},ua=["value"],da={class:"ml-2 cursor-pointer"},ca={key:0,class:"mt-3"},fa={class:"inline-flex items-center"},va=["value"],ha={class:"ml-2 cursor-pointer"},pa={key:0,class:"mb-4"},ya={class:"inline-flex items-center"},ma={key:1,class:"mb-4"},ga=["disabled"],ba=["value"],wa={key:0,class:"italic mt-2"},ka={key:2,class:"mb-4"},xa=["value"],Sa={key:3,class:"mb-4"};function Ca(e,t,l,a,r,o){return e.isVisible?(y(),m("div",Xr,[c("div",{style:I({height:e.HEADERS_HEIGHT+"px"}),class:"bg-gray-100"},null,4),c("div",Qr,[c("div",Zr,[t[11]||(t[11]=c("span",{class:"px-2"},"Column properties",-1)),c("button",{class:"border border-gray-400 rounded-full px-3",onClick:t[0]||(t[0]=n=>e.$emit("focus-editing-header"))},"Focus"),c("button",{onClick:t[1]||(t[1]=(...n)=>e.close&&e.close(...n)),class:"px-2 py-1 ml-auto",title:"Close"},[...t[10]||(t[10]=[c("i",{class:"codicon codicon-close"},null,-1)])])]),e.header.name===null?(y(),m("div",ea,[c("div",null,E(e.header.length)+" bytes of unidentified data",1)])):(y(),m("div",ta,[c("div",na,[t[12]||(t[12]=c("label",{for:"datv-header-name"},"Name",-1)),G(c("input",{id:"datv-header-name",placeholder:"Unnamed","onUpdate:modelValue":t[2]||(t[2]=n=>e.header.name=n),class:"border p-1 mt-1 w-full focus:border-blue-500",spellcheck:"false"},null,512),[[Ne,e.header.name,void 0,{trim:!0}]])]),c("div",ra,[t[13]||(t[13]=c("div",{class:"mr-2"},"View mode",-1)),c("div",aa,[(y(!0),m(O,null,z(e.viewModeOpts,n=>(y(),m("button",{key:n.value,class:N(["px-2",e.byteViewMode===n.value?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-300"]),onClick:s=>e.byteViewMode=n.value,disabled:n.disabled,textContent:E(n.label)},null,10,oa))),128))])]),c("div",la,[c("div",ia,[t[14]||(t[14]=c("span",null,"Data type",-1)),c("button",{class:"text-red-700 bg-red-100 px-2",onClick:t[3]||(t[3]=(...n)=>e.remove&&e.remove(...n))},"Delete")]),c("div",null,[(y(!0),m(O,null,z(e.dataTypeOpts,n=>(y(),m("div",{key:n.value,class:"mb-0.5"},[c("label",sa,[G(c("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=s=>e.dataType=s),value:n.value},null,8,ua),[[ze,e.dataType]]),c("span",da,E(n.label),1)])]))),128)),e.arrayTypeOpts.length?(y(),m("div",ca,[t[15]||(t[15]=c("div",{class:"mb-1"},"of ...",-1)),(y(!0),m(O,null,z(e.arrayTypeOpts,n=>(y(),m("div",{key:n.value,class:"mb-0.5"},[c("label",fa,[G(c("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=s=>e.arrayType=s),value:n.value},null,8,va),[[ze,e.arrayType]]),c("span",ha,E(n.label),1)])]))),128))])):L("",!0)])]),e.header.type.integer?(y(),m("div",pa,[c("label",ya,[G(c("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=n=>e.header.type.integer.unsigned=n)},null,512),[[Mt,e.header.type.integer.unsigned]]),t[16]||(t[16]=c("span",{class:"ml-2 cursor-pointer"},"Unsigned",-1))])])):L("",!0),e.header.type.key?(y(),m("div",ma,[t[17]||(t[17]=c("label",{for:"datv-header-key-table"},"Table",-1)),G(c("select",{id:"datv-header-key-table",class:"border mt-1 w-full focus:border-blue-500",disabled:e.tablesPreloadNeeded(),"onUpdate:modelValue":t[7]||(t[7]=n=>e.header.type.key.table=n)},[(y(!0),m(O,null,z(e.keyTableOpts,n=>(y(),m("option",{key:n.label,value:n.value},E(n.label),9,ba))),128))],8,ga),[[Pe,e.header.type.key.table]]),e.tablesPreloadNeeded()?(y(),m("div",wa,"(pre-load all Data Tables to change)")):L("",!0)])):L("",!0),t[22]||(t[22]=c("hr",{class:"my-6"},null,-1)),e.keyDisplayColumnOpts.length?(y(),m("div",ka,[t[18]||(t[18]=c("label",{for:"datv-header-key-column"},"Display Column",-1)),G(c("select",{id:"datv-header-key-column",class:"border mt-1 w-full focus:border-blue-500","onUpdate:modelValue":t[8]||(t[8]=n=>e.header.type.key.viewColumn=n)},[(y(!0),m(O,null,z(e.keyDisplayColumnOpts,n=>(y(),m("option",{key:n.label,value:n.value},E(n.label),9,xa))),128))],512),[[Pe,e.header.type.key.viewColumn]])])):L("",!0),e.dataType?(y(),m("div",Sa,[t[19]||(t[19]=c("label",{class:"mr-4"},"Width",-1)),G(c("input",{"onUpdate:modelValue":t[9]||(t[9]=n=>e.header.textLength=n),class:"border w-16 text-center"},null,512),[[Ne,e.header.textLength,void 0,{number:!0}]]),t[20]||(t[20]=_(" chars ",-1)),t[21]||(t[21]=c("div",{class:"italic mt-2"},"(move mouse over the column name in Viewer and use `ScrollWheel`, hold `Ctrl` to increase resize step)",-1))])):L("",!0)]))])])):L("",!0)}const $a=le(Kr,[["render",Ca]]),La=Math.ceil(V*3);function Ma(e,t,l,a,r){const o=[];let n=0;for(const s of l){const d=Ee(s);if(s.type.byteView&&!s.type.byteView.array){let i=n;for(let u=0;u<s.length;++u){const f=d.hasBorder&&u===0,h=V*3+(f?ne:0);if(Math.ceil(i)+h<a){i+=h;continue}const p=s.offset+u;if(o.push({offset:p,selected:e[p],border:f,widthPx:La,leftPx:Math.ceil(i),text:String(p%100).padStart(2,"0"),stat:t[p],key:!1}),i+=h,Math.ceil(i)>=r)return o}}else n+d.borderWidth>=a&&o.push({offset:s.offset,selected:!1,border:d.hasBorder,widthPx:d.paddingWidth,leftPx:n,text:String(s.offset%100).padStart(2,"0"),key:s.type.key!=null});if(n+=d.borderWidth,n>=r)return o}return o}function Ea(e,t){const l=e.map(r=>({max:r.maxValue.toString(16).padStart(2,"0"),array:!1,string:!1,nullable:!1,zero:r.maxValue===0})),{fieldSize:a}=t;for(let r=0;r<e.length;++r){const o=e[r];if(o.refString)for(let n=0;n<a.STRING;++n)l[r+n].string=!0;if(o.refArray)for(let n=0;n<a.ARRAY;++n)l[r+n].array=!0;if(o.nullableMemsize)for(let n=0;n<t.memsize;++n)l[r+n].nullable=!0}return l}const Oa=re({components:{ResizeObserver:Pt,CanvasScroll:zt,ViewerActions:Kn,ViewerHead:Tr,HeaderProps:$a},props:{args:{type:Object,required:!0},kaState:{type:Object,default:void 0},kaScope:{type:Object,required:!0}},emits:["update:kaState"],setup(e,t){const l=W("bundle-index"),a=W("dat-schemas"),r=Vt();let o;e.kaState?o=e.kaState:(o=tn(e.args.fullPath,e.args.fileContent,l,a,e.kaScope),t.emit("update:kaState",o)),Et("viewer",o);const n=U(null),s=U(null);function d($){if(($.ctrlKey||$.metaKey)&&$.key==="c"&&o.selectedRow.value!==null){$.preventDefault();const R=ke(o.headers.value,o.datFile)[o.selectedRow.value];if(R){const K=r.settings.copyFormat;let Ce;if(K==="csv"){const se=Object.keys(R);Ce=se.join(",")+`
`+se.map(Ae=>{const D=R[Ae];return D==null?"":typeof D=="string"?`"${D.replace(/"/g,'""')}"`:Array.isArray(D)?`"${JSON.stringify(D).replace(/"/g,'""')}"`:String(D)}).join(",")}else if(K==="tsv"){const se=Object.keys(R);Ce=se.join("	")+`
`+se.map(Ae=>{const D=R[Ae];return D==null?"":Array.isArray(D)?JSON.stringify(D):String(D)}).join("	")}else Ce=JSON.stringify(R,null,2);navigator.clipboard.writeText(Ce)}}}Te(()=>{s.value.scrollTo(o.scrollPos.x,o.scrollPos.y),window.addEventListener("keydown",d)}),De(()=>{window.removeEventListener("keydown",d)});const i=k(()=>o.rowSorting.value?o.rowSorting.value:Array.from({length:o.datFile.rowCount},($,B)=>B)),u=U(0),f=U(0);function h($){u.value=$.width,f.value=$.height}const{scrollPos:p}=o;function v($){p.x=$.x,p.y=$.y}const g=k(()=>kr(o.headers.value)),S=k(()=>o.datFile.rowCount*H),C=k(()=>hr(o.datFile.rowCount)),b=k(()=>Math.max(0,u.value-C.value)),w=k(()=>Math.max(0,f.value-ae));Se([b,w],()=>{const $=window.devicePixelRatio;n.value.style.width=b.value+"px",n.value.style.height=w.value+"px",n.value.width=b.value*$,n.value.height=w.value*$,n.value.getContext("2d",{alpha:!1}).scale($,$),Y()});const x=k(()=>Ea(o.columnStats.value,o.datFile)),M=k(()=>Ma(o.columnSelection.value,x.value,o.headers.value,p.x,p.x+Math.min(g.value,b.value))),P=k(()=>{for(const $ of o.referencedTables.value.values())$.value});Se([p,M,i,o.selectedRow,P],()=>{Y()});function Y(){const $=n.value.getContext("2d",{alpha:!1});gr({left:p.x,paintWidth:b.value,top:Oe.value.top,rows:Oe.value.ids,columns:M.value,viewer:o,ctx:$})}const Oe=k(()=>{const $=p.y,B=Math.ceil(w.value/H)+1,R=Math.floor($/H);return{top:R*H-$,ids:i.value.slice(R,R+B)}});function St(){const $=o.editHeader.value,R=bt(o.headers.value,null,0,0+1/0).find(K=>K.offset===$.offset);s.value.scrollTo(R.leftPx-b.value*.33,void 0)}function Ct($){const{selectedRow:B}=o,R=Math.floor(($.offsetY+p.y)/H),K=i.value[R];B.value=B.value!==K?K:null}const ie=k(()=>r.settings.showLineNumbers),Ie=k(()=>ie.value?C.value:0);return{headerBlockStyle:k(()=>({height:ae+"px",width:u.value+"px"})),headerOverlayContentStyle:k(()=>({left:Ie.value+"px",height:ae+"px",width:(ie.value?b.value:u.value)+"px"})),scrollableStyle:k(()=>({top:ae+"px",left:Ie.value+"px"})),scrollablePaintSize:k(()=>({width:ie.value?b.value:u.value,height:w.value})),scrollableFullSize:k(()=>({width:g.value,height:S.value})),rowsOverlayStyle:k(()=>({top:ae+"px",width:C.value+"px",height:w.value+"px",fontFamily:te,fontSize:X+"px",lineHeight:H+"px"})),showLineNumbers:ie,handleScroll:v,handleResize:h,renderItems:Oe,canvasRef:n,renderColumns:M,scrollLeft:k(()=>p.x),rowsWidth:k(()=>Math.min(g.value,ie.value?b.value:u.value)),LINE_HEIGHT:H,canvasScroll:s,rowsNumberWidth:gt(o.datFile.rowCount)+"px",focusEditingHeader:St,handleCanvasClick:Ct}}}),Aa="_rowsOverlay_1ab2y_2",_a={rowsOverlay:Aa},Na={class:"flex flex-1"},Ra=["textContent"];function Ta(e,t,l,a,r,o){const n=ue("viewer-actions"),s=ue("viewer-head"),d=ue("canvas-scroll"),i=ue("resize-observer"),u=ue("header-props");return y(),m(O,null,[F(n),c("div",Na,[F(i,{class:"relative min-h-0 flex-1",onResize:e.handleResize},{default:We(()=>[c("div",{class:"absolute bg-dark-800",style:I(e.headerBlockStyle)},[F(s,{style:I(e.headerOverlayContentStyle),left:e.scrollLeft,width:e.rowsWidth,columns:e.renderColumns},null,8,["style","left","width","columns"])],4),F(d,{ref:"canvasScroll",class:"absolute bg-dark-900",style:I(e.scrollableStyle),"paint-size":e.scrollablePaintSize,"full-size":e.scrollableFullSize,onScroll:e.handleScroll},{default:We(()=>[c("canvas",{ref:"canvasRef",onClick:t[0]||(t[0]=(...f)=>e.handleCanvasClick&&e.handleCanvasClick(...f))},null,512)]),_:1},8,["style","paint-size","full-size","onScroll"]),e.showLineNumbers?(y(),m("div",{key:0,class:N(e.$style.rowsOverlay),style:I(e.rowsOverlayStyle)},[c("div",{class:"absolute",style:I({transform:`translate(0, ${e.renderItems.top}px)`})},[(y(!0),m(O,null,z(e.renderItems.ids,(f,h)=>(y(),m("div",{key:f,style:I({transform:`translate(0, ${h*e.LINE_HEIGHT}px)`,width:e.rowsNumberWidth,position:"absolute"}),textContent:E(f)},null,12,Ra))),128))],4)],6)):L("",!0)]),_:1},8,["onResize"]),F(u,{onFocusEditingHeader:e.focusEditingHeader},null,8,["onFocusEditingHeader"])])],64)}const Da={$style:_a},xt=le(Oa,[["render",Ta],["__cssModules",Da]]),Fa={key:0,class:"flex items-center border-b border-dark-700 bg-dark-800/50"},Ha={class:"flex flex-1 items-center gap-1 overflow-x-auto px-2 py-1"},Ia=["onClick"],za={class:"max-w-32 truncate"},Pa=["onClick"],Wa={class:"flex items-center gap-1 border-l border-dark-700 px-2"},Ua=["title"],Va={class:"relative flex-1 overflow-hidden"},Ba={key:0,class:"flex h-full flex-col items-center justify-center p-8"},qa={class:"mb-6 rounded-2xl bg-dark-800 p-6"},ja={class:"mt-8 flex gap-4"},Ga={class:"btn-primary cursor-pointer"},Ja={class:"btn-secondary"},Ya={key:2,class:"absolute inset-0 z-50 flex items-center justify-center bg-dark-900/90 backdrop-blur-sm"},Ka={class:"rounded-xl border-2 border-dashed border-primary-500 bg-primary-600/10 p-12 text-center"},ro=re({__name:"ViewerView",setup(e){const t=_t(),l=Wt(),a=W("bundle-index"),r=U([]),o=U(null),n=U(!1),s=U(!1),d=k(()=>r.value.find(b=>b.id===o.value));Se(()=>t.query.file,async b=>{b&&typeof b=="string"&&await i(b)},{immediate:!0});async function i(b){const w=r.value.find(x=>x.fullPath===b);if(w){o.value=w.id;return}try{l.setLoading(!0,`Loading ${b}...`);const x=await a.loadFileContent(b),M=b.substring(b.lastIndexOf("/")+1),P=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`;r.value.push({id:P,title:M,fullPath:b,fileContent:x,scope:oe()}),o.value=P}catch(x){console.error("Failed to load file:",x)}finally{l.setLoading(!1)}}async function u(b){const w=b.target,x=w.files?.[0];if(!x)return;const M=await x.arrayBuffer(),P=new Uint8Array(M),Y=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`;r.value.push({id:Y,title:x.name,fullPath:`local/${x.name}`,fileContent:P,scope:oe()}),o.value=Y,w.value=""}function f(b){const w=r.value.findIndex(x=>x.id===b);w!==-1&&(r.value[w].scope.stop(),r.value.splice(w,1),o.value===b&&(o.value=r.value[Math.min(w,r.value.length-1)]?.id??null))}function h(){if(!d.value)return;const b=new Blob([d.value.fileContent.buffer],{type:"application/octet-stream"});Re.saveAs(b,d.value.title)}function p(b){b.preventDefault(),s.value=!0}function v(){s.value=!1}async function g(b){b.preventDefault(),s.value=!1;const w=b.dataTransfer?.files[0];if(!w)return;const x=await w.arrayBuffer(),M=new Uint8Array(x),P=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`;r.value.push({id:P,title:w.name,fullPath:`local/${w.name}`,fileContent:M,scope:oe()}),o.value=P}function S(){document.getElementById("file-upload")?.click()}async function C(b){const w=b.detail;if(w?.length)for(const x of Array.from(w)){const M=await x.arrayBuffer(),P=new Uint8Array(M),Y=`file-${Date.now()}-${Math.random().toString(36).slice(2,9)}`;r.value.push({id:Y,title:x.name,fullPath:`local/${x.name}`,fileContent:P,scope:oe()}),o.value=Y}}return Te(()=>{window.addEventListener("open-local-file",S),window.addEventListener("open-local-files",C)}),De(()=>{window.removeEventListener("open-local-file",S),window.removeEventListener("open-local-files",C),r.value.forEach(b=>b.scope.stop())}),(b,w)=>(y(),m("div",{class:"flex h-full flex-col",onDragover:p,onDragleave:v,onDrop:g},[c("input",{id:"file-upload",type:"file",accept:".datc64,.dat",class:"hidden",onChange:u},null,32),r.value.length?(y(),m("div",Fa,[c("div",Ha,[(y(!0),m(O,null,z(r.value,x=>(y(),m("button",{key:x.id,class:N(["group flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm transition-colors",o.value===x.id?"bg-dark-700 text-dark-100":"text-dark-400 hover:bg-dark-700/50 hover:text-dark-200"]),onClick:M=>o.value=x.id},[F(q(jt),{class:"h-4 w-4 shrink-0"}),c("span",za,E(x.title),1),c("button",{class:"ml-1 rounded p-0.5 opacity-0 transition-opacity hover:bg-dark-600 group-hover:opacity-100",onClick:Ot(M=>f(x.id),["stop"])},[F(q(Ut),{class:"h-3 w-3"})],8,Pa)],10,Ia))),128))]),c("div",Wa,[c("button",{class:"btn-icon btn-ghost p-1.5",title:"Export",onClick:h},[F(q(Bt),{class:"h-4 w-4"})]),c("button",{class:"btn-icon btn-ghost p-1.5",title:n.value?"Restore":"Maximize",onClick:w[0]||(w[0]=x=>n.value=!n.value)},[n.value?(y(),Ue(q(Jt),{key:0,class:"h-4 w-4"})):(y(),Ue(q(Gt),{key:1,class:"h-4 w-4"}))],8,Ua)])])):L("",!0),c("div",Va,[r.value.length?(y(!0),m(O,{key:1},z(r.value,x=>G((y(),m("div",{key:x.id,class:"absolute inset-0 flex flex-col bg-dark-900"},[F(xt,{"ka-state":x.state,"onUpdate:kaState":M=>x.state=M,args:{fileContent:x.fileContent,fullPath:x.fullPath},"ka-scope":x.scope},null,8,["ka-state","onUpdate:kaState","args","ka-scope"])])),[[At,o.value===x.id]])),128)):(y(),m("div",Ba,[c("div",qa,[F(q(Yt),{class:"h-16 w-16 text-dark-600"})]),w[3]||(w[3]=c("h2",{class:"text-xl font-semibold text-dark-200"},"No files open",-1)),w[4]||(w[4]=c("p",{class:"mt-2 text-dark-500"},"Open a .datc64 file to start exploring",-1)),c("div",ja,[c("label",Ga,[F(q(qe),{class:"h-4 w-4"}),w[1]||(w[1]=c("span",null,"Open File",-1)),c("input",{type:"file",accept:".datc64,.dat",class:"hidden",onChange:u},null,32)]),c("button",Ja,[F(q(qt),{class:"h-4 w-4"}),w[2]||(w[2]=c("span",null,"Browse Index",-1))])]),w[5]||(w[5]=c("p",{class:"mt-6 text-sm text-dark-500"},"or drag and drop a file here",-1))])),s.value?(y(),m("div",Ya,[c("div",Ka,[F(q(qe),{class:"mx-auto h-12 w-12 text-primary-400"}),w[6]||(w[6]=c("p",{class:"mt-4 text-lg font-medium text-dark-100"},"Drop file to open",-1)),w[7]||(w[7]=c("p",{class:"mt-1 text-sm text-dark-400"},"Supports .datc64 and .dat files",-1))])])):L("",!0)])],32))}});export{ro as default};
